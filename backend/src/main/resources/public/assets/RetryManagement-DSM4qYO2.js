import{j as e}from"./ui-vendor-B4gDKxp2.js";import{r as d}from"./react-vendor-pDgKdaAw.js";import{w as F,F as I,a4 as f,R as A,v as C,o as r,p as i,q as l,r as n,G as z,s as g,A as R,T as H,d as D,B as N,t as Q}from"./index-DseL_RUD.js";import{T as G,a as O,b as v,c as y}from"./tabs-C7kSaJO6.js";import{T as M,a as L,b as m,c as t,d as S,e as a}from"./table-2esKEn88.js";import{T as U}from"./trending-up-eJ29irQ-.js";import{P as V}from"./play-DhZluFya.js";import{f as W}from"./date-vendor-CjcKQu8N.js";import"./chart-vendor-A7Ge_5Hb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=F("FileWarning",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ae=()=>{const[j,P]=d.useState([]),[p,q]=d.useState([]),[b,T]=d.useState(!0),[x,E]=d.useState("policies"),{toast:o}=I(),h=d.useCallback(async()=>{T(!0);try{if(x==="policies"){const s=await f.get("/retry-management/policies");P(s.data)}else if(x==="dlq"){const s=await f.get("/retry-management/dead-letter-queue");q(s.data)}}catch{o({title:"Error",description:"Failed to fetch data",variant:"destructive"})}finally{T(!1)}},[x,o]);d.useEffect(()=>{h()},[x,h]);const k=async s=>{try{await f.post(`/retry-management/dead-letter-queue/${s}/reprocess`),o({title:"Success",description:"Message queued for reprocessing"}),h()}catch{o({title:"Error",description:"Failed to reprocess message",variant:"destructive"})}},B=s=>{const c=[];let u=s.initialDelayMs;for(let w=1;w<=s.maxAttempts;w++)c.push(`${u}ms`),u=Math.min(u*s.multiplier,s.maxDelayMs);return c.join(" â†’ ")};return e.jsxs("div",{className:"p-6 space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(A,{className:"h-8 w-8"}),"Retry Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"Configure retry policies and manage failed messages"})]}),e.jsxs(C,{onClick:h,variant:"outline",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(r,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(l,{className:"text-sm font-medium",children:"Active Policies"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.filter(s=>s.isActive).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total configured"})]})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(l,{className:"text-sm font-medium",children:"Messages in DLQ"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-destructive",children:p.filter(s=>!s.reprocessed).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting resolution"})]})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(l,{className:"text-sm font-medium",children:"Retry Success Rate"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"85%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(l,{className:"text-sm font-medium",children:"Avg Retry Delay"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"2.5s"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all policies"})]})]})]}),e.jsxs(G,{value:x,onValueChange:E,className:"space-y-4",children:[e.jsxs(O,{children:[e.jsxs(v,{value:"policies",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Retry Policies"]}),e.jsxs(v,{value:"dlq",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Dead Letter Queue"]}),e.jsxs(v,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Statistics"]})]}),e.jsx(y,{value:"policies",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Retry Policies"}),e.jsx(g,{children:"Configure how failed messages are retried for each adapter"})]}),e.jsx(n,{children:b?e.jsx("div",{className:"text-center py-4",children:"Loading..."}):j.length===0?e.jsxs(R,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(D,{children:"No retry policies configured. Default policy will be used."})]}):e.jsxs(M,{children:[e.jsx(L,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Adapter"}),e.jsx(t,{children:"Policy Name"}),e.jsx(t,{children:"Max Attempts"}),e.jsx(t,{children:"Delay Pattern"}),e.jsx(t,{children:"Retry On"}),e.jsx(t,{children:"Status"})]})}),e.jsx(S,{children:j.map(s=>e.jsxs(m,{children:[e.jsx(a,{className:"font-medium",children:s.adapterName||"Unknown"}),e.jsx(a,{children:s.name}),e.jsx(a,{children:s.maxAttempts}),e.jsx(a,{className:"text-xs font-mono",children:B(s)}),e.jsx(a,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.retryOnErrors.map(c=>e.jsx(N,{variant:"secondary",className:"text-xs",children:c},c))})}),e.jsx(a,{children:e.jsx(N,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})})]},s.id))})]})})]})}),e.jsx(y,{value:"dlq",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Dead Letter Queue"}),e.jsx(g,{children:"Messages that failed after all retry attempts"})]}),e.jsx(n,{children:b?e.jsx("div",{className:"text-center py-4",children:"Loading..."}):p.length===0?e.jsxs(R,{children:[e.jsx(Q,{className:"h-4 w-4 text-green-600"}),e.jsx(D,{children:"No messages in the dead letter queue. Great job!"})]}):e.jsxs(M,{children:[e.jsx(L,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Message ID"}),e.jsx(t,{children:"Adapter"}),e.jsx(t,{children:"Business Component"}),e.jsx(t,{children:"Error Type"}),e.jsx(t,{children:"Attempts"}),e.jsx(t,{children:"Last Error"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(S,{children:p.map(s=>e.jsxs(m,{children:[e.jsxs(a,{className:"font-mono text-xs",children:[s.originalMessageId.substring(0,8),"..."]}),e.jsx(a,{children:s.adapterName}),e.jsx(a,{children:s.businessComponentName}),e.jsx(a,{children:e.jsx(N,{variant:"destructive",children:s.errorType})}),e.jsx(a,{children:s.totalRetryAttempts}),e.jsx(a,{className:"text-xs",children:W(new Date(s.lastErrorAt),{addSuffix:!0})}),e.jsx(a,{children:e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>k(s.id),disabled:s.reprocessed,children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Reprocess"]})})]},s.id))})]})})]})}),e.jsx(y,{value:"statistics",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Retry Statistics"}),e.jsx(g,{children:"Performance metrics and trends for retry operations"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Statistics visualization coming soon..."})})]})})]})]})};export{ae as RetryManagement};
