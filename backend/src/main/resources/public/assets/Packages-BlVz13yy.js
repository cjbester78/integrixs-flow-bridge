import{j as e}from"./ui-vendor-B4gDKxp2.js";import{r as x,g as kr,R as Nt}from"./react-vendor-pDgKdaAw.js";import{w as xe,c as Y,m as Ot,a6 as q,l as B,L as G,a as H,ao as U,F as Ie,o as $,p as J,q as Z,s as ge,B as M,v as R,C as Me,r as _,z as cr,u as $e,e as ce,A as fe,d as Oe,al as Mr,g as P,S as ue,h as pe,i as he,j as me,k as te,I as X,R as We,G as Ae,b as lr,a9 as st,aa as at,M as He,y as Fr,T as $r,a8 as Lr,ap as Ht,an as wt,x as ie,O as Ut,J as _r,Q as qr,V as Hr,W as Ur,X as Vr,Z as Pe,t as zr,Y as Vt}from"./index-j6L12q1O.js";import{D as Wr,b as Br,c as Gr,d as Xr}from"./dialog-DOGyEP5f.js";import{T as de}from"./textarea-A0zF0cCr.js";import{R as nt,a as Te}from"./radio-group-BWauHEe9.js";import{f as Yr}from"./flowService-CZ5RTZgT.js";import{H as Jr,G as Ue,F as Zr,c as _e}from"./FieldMappingScreen-sWus4qst.js";import{S as dr}from"./switch-CUtIsRNU.js";import{T as Be,a as Ge,b as se,c as ae}from"./tabs-qFpnyz_L.js";import{S as Ee}from"./scroll-area-CfPwVd8N.js";import{F as Et}from"./editor-vendor-CjSHClq6.js";import{P as ur}from"./play-C86psO58.js";import{S as zt}from"./save-ByauNZNE.js";import{D as It}from"./download-xwmUEhhU.js";import{C as je}from"./circle-check-Cc-ocefQ.js";import{U as Qr}from"./upload-CSgSnmNo.js";import{T as Xe}from"./trash-2-UTmHvEBV.js";import{P as ze}from"./plus-SMSlSsiw.js";import{C as Kr}from"./calendar-BhKldtKM.js";import{Z as es}from"./zap-KQwHUiHi.js";import{C as Rt}from"./copy-CAy57Gib.js";import{C as it,a as ot,b as ct}from"./collapsible-DsUrm4CU.js";import{a as pr}from"./index.module-CRoXUVZp.js";import{S as De}from"./server-DQvOWjc-.js";import{F as ke}from"./file-code-CUhIFQDB.js";import{F as ts}from"./file-json-CGMbwqKv.js";import{i as rs}from"./api-response-utils-DzNCoCqu.js";import{G as lt}from"./globe-ZaJJzieo.js";import{W as ss}from"./webhook-DolTKzoX.js";import{T as as,a as ns,b as dt,c as le,d as is,e as oe}from"./table-DMqy019X.js";import{E as os}from"./ellipsis-Be3bY_yJ.js";import{S as cs}from"./square-pen-OlAUrgxR.js";import"./chart-vendor-A7Ge_5Hb.js";import"./useDataStructures-BQuNAF4R.js";import"./structureService-DHD3fE3P.js";import"./search-EIqf-oQo.js";import"./database-XpsIHb-R.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=xe("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=xe("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=xe("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=xe("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=xe("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=xe("TestTubeDiagonal",[["path",{d:"M21 7 6.82 21.18a2.83 2.83 0 0 1-3.99-.01a2.83 2.83 0 0 1 0-4L17 3",key:"1ub6xw"}],["path",{d:"m16 2 6 6",key:"1gw87d"}],["path",{d:"M12 16H4",key:"1cjfip"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=xe("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=xe("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),Ce=({className:r,size:t="md",message:s})=>{const a={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"};return e.jsxs("div",{className:Y("flex items-center gap-2",r),children:[e.jsx(Ot,{className:Y("animate-spin",a[t])}),s&&e.jsx("span",{className:"text-sm text-muted-foreground",children:s})]})},K="/integration-packages",ve={createPackage:async r=>await q.post(K,r),updatePackage:async(r,t)=>await q.put(`${K}/${r}`,t),getPackage:async r=>await q.get(`${K}/${r}`),getAllPackages:async(r=0,t=20,s)=>{const a=new URLSearchParams({page:r.toString(),size:t.toString()});return s&&a.append("sort",s),await q.get(`${K}?${a.toString()}`)},searchPackages:async r=>{const t=new URLSearchParams;return r.searchTerm&&t.append("searchTerm",r.searchTerm),r.status&&t.append("status",r.status),r.syncType&&t.append("syncType",r.syncType),r.transformationRequired!==void 0&&t.append("transformationRequired",r.transformationRequired.toString()),r.isTemplate!==void 0&&t.append("isTemplate",r.isTemplate.toString()),t.append("page",(r.page||0).toString()),t.append("size",(r.size||20).toString()),await q.get(`${K}/search?${t.toString()}`)},addComponent:async(r,t)=>{const s=new URLSearchParams({componentType:t.componentType,componentId:t.componentId});return await q.post(`${K}/${r}/components?${s.toString()}`,t.configuration||{})},removeComponent:async(r,t)=>await q.delete(`${K}/${r}/components/${t}`),validatePackage:async r=>await q.post(`${K}/${r}/validate`),deployPackage:async(r,t,s)=>{const a=new URLSearchParams({environment:t});return s&&a.append("notes",s),await q.post(`${K}/${r}/deploy?${a.toString()}`)},deletePackage:async r=>await q.delete(`${K}/${r}`),exportPackage:async r=>{const t=await fetch(`/api${K}/${r}/export`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to export package");const s=await t.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");return n.href=a,n.download=`package_${r}_export.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a),{success:!0}},importPackage:async r=>{const t=new FormData;t.append("file",r);const s=await fetch(`/api${K}/import`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:t});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to import package")}return await s.json()}},Bt="/adapters",ut={getAllAdapters:async()=>{try{return{success:!0,data:await q.get(Bt)}}catch(r){return B.error(G.API,"Error fetching adapters",{error:r}),{success:!1,message:"Failed to fetch adapters"}}},createAdapter:async r=>{try{return{success:!0,data:await q.post(Bt,r)}}catch(t){return B.error(G.API,"Error creating adapter",{error:t}),{success:!1,message:"Failed to create adapter"}}}},Gt="/flow-structures",Se={getAllStructures:async()=>{try{return{success:!0,data:await q.get(Gt)}}catch(r){return B.error(G.API,"Error fetching structures",{error:r}),{success:!1,message:"Failed to fetch structures"}}},createStructure:async r=>{try{return{success:!0,data:await q.post(Gt,r)}}catch(t){return B.error(G.API,"Error creating structure",{error:t}),{success:!1,message:"Failed to create structure"}}}},Xt="/flows",gs={getAllFlows:async()=>{try{return{success:!0,data:(await q.get(Xt)).data}}catch(r){return B.error(G.API,"Error fetching flows",{error:r}),{success:!1,message:"Failed to fetch flows"}}},createFlow:async r=>({success:!0,data:await q.post(Xt,r)})};class ne{static async getFlowTargets(t){try{const s=await H.get(`/flows/${t}/targets`);if(s.success&&s.data)return s.data;throw new U(s.error||"Failed to fetch flow targets")}catch(s){throw console.error("Error fetching flow targets:",s),s}}static async getTarget(t,s){try{const a=await H.get(`/flows/${t}/targets/${s}`);if(a.success&&a.data)return a.data;throw new U(a.error||"Failed to fetch target")}catch(a){throw console.error("Error fetching target:",a),a}}static async addTarget(t,s){try{const a=await H.post(`/flows/${t}/targets`,s);if(a.success&&a.data)return a.data;throw new U(a.error||"Failed to add target")}catch(a){throw console.error("Error adding target:",a),a}}static async updateTarget(t,s,a){try{const n=await H.put(`/flows/${t}/targets/${s}`,a);if(n.success&&n.data)return n.data;throw new U(n.error||"Failed to update target")}catch(n){throw console.error("Error updating target:",n),n}}static async removeTarget(t,s){try{const a=await H.delete(`/flows/${t}/targets/${s}`);if(!a.success)throw new U(a.error||"Failed to remove target")}catch(a){throw console.error("Error removing target:",a),a}}static async activateTarget(t,s){try{const a=await H.post(`/flows/${t}/targets/${s}/activate`);if(a.success&&a.data)return a.data;throw new U(a.error||"Failed to activate target")}catch(a){throw console.error("Error activating target:",a),a}}static async deactivateTarget(t,s){try{const a=await H.post(`/flows/${t}/targets/${s}/deactivate`);if(a.success&&a.data)return a.data;throw new U(a.error||"Failed to deactivate target")}catch(a){throw console.error("Error deactivating target:",a),a}}static async reorderTargets(t,s){try{const a=await H.put(`/flows/${t}/targets/reorder`,s);if(a.success&&a.data)return a.data;throw new U(a.error||"Failed to reorder targets")}catch(a){throw console.error("Error reordering targets:",a),a}}static getDefaultRetryPolicy(){return{maxAttempts:3,retryDelayMs:1e3,backoffMultiplier:2,maxRetryDelayMs:6e4}}static getDefaultTargetConfig(){return{parallel:!1,conditionType:"ALWAYS",awaitResponse:!1,timeoutMs:3e4,retryPolicy:this.getDefaultRetryPolicy(),errorStrategy:"FAIL_FLOW",active:!0}}}class fs{static async getTargetMappings(t,s,a=!1){try{const n=a?"?activeOnly=true":"",o=await H.get(`/flows/${t}/targets/${s}/mappings${n}`);if(o.success&&o.data)return o.data;throw new U(o.error||"Failed to fetch target mappings")}catch(n){throw console.error("Error fetching target mappings:",n),n}}static async getMapping(t,s,a){try{const n=await H.get(`/flows/${t}/targets/${s}/mappings/${a}`);if(n.success&&n.data)return n.data;throw new U(n.error||"Failed to fetch mapping")}catch(n){throw console.error("Error fetching mapping:",n),n}}static async createMapping(t,s,a){try{const n=await H.post(`/flows/${t}/targets/${s}/mappings`,a);if(n.success&&n.data)return n.data;throw new U(n.error||"Failed to create mapping")}catch(n){throw console.error("Error creating mapping:",n),n}}static async updateMapping(t,s,a,n){try{const o=await H.put(`/flows/${t}/targets/${s}/mappings/${a}`,n);if(o.success&&o.data)return o.data;throw new U(o.error||"Failed to update mapping")}catch(o){throw console.error("Error updating mapping:",o),o}}static async deleteMapping(t,s,a){try{const n=await H.delete(`/flows/${t}/targets/${s}/mappings/${a}`);if(!n.success)throw new U(n.error||"Failed to delete mapping")}catch(n){throw console.error("Error deleting mapping:",n),n}}static async createMappings(t,s,a){try{const n=await H.post(`/flows/${t}/targets/${s}/mappings/batch`,a);if(n.success&&n.data)return n.data;throw new U(n.error||"Failed to create mappings")}catch(n){throw console.error("Error creating mappings:",n),n}}static async deleteAllMappings(t,s){try{const a=await H.delete(`/flows/${t}/targets/${s}/mappings`);if(!a.success)throw new U(a.error||"Failed to delete all mappings")}catch(a){throw console.error("Error deleting all mappings:",a),a}}static async activateMapping(t,s,a){try{const n=await H.post(`/flows/${t}/targets/${s}/mappings/${a}/activate`);if(n.success&&n.data)return n.data;throw new U(n.error||"Failed to activate mapping")}catch(n){throw console.error("Error activating mapping:",n),n}}static async deactivateMapping(t,s,a){try{const n=await H.post(`/flows/${t}/targets/${s}/mappings/${a}/deactivate`);if(n.success&&n.data)return n.data;throw new U(n.error||"Failed to deactivate mapping")}catch(n){throw console.error("Error deactivating mapping:",n),n}}static async reorderMappings(t,s,a){try{const n=await H.put(`/flows/${t}/targets/${s}/mappings/reorder`,a);if(n.success&&n.data)return n.data;throw new U(n.error||"Failed to reorder mappings")}catch(n){throw console.error("Error reordering mappings:",n),n}}static async validateMappings(t,s){try{const a=await H.get(`/flows/${t}/targets/${s}/mappings/validate`);if(a.success&&a.data)return a.data;throw new U(a.error||"Failed to validate mappings")}catch(a){throw console.error("Error validating mappings:",a),a}}static getDefaultMapping(){return{mappingType:"DIRECT",required:!1,active:!0,mappingOrder:0}}static getTransformationTemplates(){return{uppercase:"value.toUpperCase()",lowercase:"value.toLowerCase()",trim:"value.trim()",substring:"value.substring(0, 10)",replace:"value.replace('old', 'new')",concat:"value + ' suffix'",dateFormat:"new Date(value).toISOString()",parseInt:"parseInt(value, 10)",parseFloat:"parseFloat(value)",conditional:"value === 'condition' ? 'true_value' : 'false_value'",jsonParse:"JSON.parse(value)",jsonStringify:"JSON.stringify(value)"}}}const mr=x.createContext({dragDropManager:void 0});function ee(r){return"Minified Redux error #"+r+"; visit https://redux.js.org/Errors?code="+r+" for the full message or use the non-minified dev environment for full errors. "}var Yt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),pt=function(){return Math.random().toString(36).substring(7).split("").join(".")},Jt={INIT:"@@redux/INIT"+pt(),REPLACE:"@@redux/REPLACE"+pt(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+pt()}};function xs(r){if(typeof r!="object"||r===null)return!1;for(var t=r;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t}function gr(r,t,s){var a;if(typeof t=="function"&&typeof s=="function"||typeof s=="function"&&typeof arguments[3]=="function")throw new Error(ee(0));if(typeof t=="function"&&typeof s>"u"&&(s=t,t=void 0),typeof s<"u"){if(typeof s!="function")throw new Error(ee(1));return s(gr)(r,t)}if(typeof r!="function")throw new Error(ee(2));var n=r,o=t,l=[],d=l,T=!1;function j(){d===l&&(d=l.slice())}function N(){if(T)throw new Error(ee(3));return o}function D(i){if(typeof i!="function")throw new Error(ee(4));if(T)throw new Error(ee(5));var w=!0;return j(),d.push(i),function(){if(w){if(T)throw new Error(ee(6));w=!1,j();var A=d.indexOf(i);d.splice(A,1),l=null}}}function g(i){if(!xs(i))throw new Error(ee(7));if(typeof i.type>"u")throw new Error(ee(8));if(T)throw new Error(ee(9));try{T=!0,o=n(o,i)}finally{T=!1}for(var w=l=d,v=0;v<w.length;v++){var A=w[v];A()}return i}function y(i){if(typeof i!="function")throw new Error(ee(10));n=i,g({type:Jt.REPLACE})}function C(){var i,w=D;return i={subscribe:function(A){if(typeof A!="object"||A===null)throw new Error(ee(11));function u(){A.next&&A.next(N())}u();var m=w(u);return{unsubscribe:m}}},i[Yt]=function(){return this},i}return g({type:Jt.INIT}),a={dispatch:g,subscribe:D,getState:N,replaceReducer:y},a[Yt]=C,a}function E(r,t,...s){if(vs()&&t===void 0)throw new Error("invariant requires an error message argument");if(!r){let a;if(t===void 0)a=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let n=0;a=new Error(t.replace(/%s/g,function(){return s[n++]})),a.name="Invariant Violation"}throw a.framesToPop=1,a}}function vs(){return typeof process<"u"&&!0}function js(r,t,s){return t.split(".").reduce((a,n)=>a&&a[n]?a[n]:s||null,r)}function ys(r,t){return r.filter(s=>s!==t)}function fr(r){return typeof r=="object"}function Ns(r,t){const s=new Map,a=o=>{s.set(o,s.has(o)?s.get(o)+1:1)};r.forEach(a),t.forEach(a);const n=[];return s.forEach((o,l)=>{o===1&&n.push(l)}),n}function ws(r,t){return r.filter(s=>t.indexOf(s)>-1)}const Pt="dnd-core/INIT_COORDS",Ye="dnd-core/BEGIN_DRAG",At="dnd-core/PUBLISH_DRAG_SOURCE",Je="dnd-core/HOVER",Ze="dnd-core/DROP",Qe="dnd-core/END_DRAG";function Zt(r,t){return{type:Pt,payload:{sourceClientOffset:t||null,clientOffset:r||null}}}const Ts={type:Pt,payload:{clientOffset:null,sourceClientOffset:null}};function Ss(r){return function(s=[],a={publishSource:!0}){const{publishSource:n=!0,clientOffset:o,getSourceClientOffset:l}=a,d=r.getMonitor(),T=r.getRegistry();r.dispatch(Zt(o)),bs(s,d,T);const j=Os(s,d);if(j==null){r.dispatch(Ts);return}let N=null;if(o){if(!l)throw new Error("getSourceClientOffset must be defined");Ds(l),N=l(j)}r.dispatch(Zt(o,N));const g=T.getSource(j).beginDrag(d,j);if(g==null)return;Cs(g),T.pinSource(j);const y=T.getSourceType(j);return{type:Ye,payload:{itemType:y,item:g,sourceId:j,clientOffset:o||null,sourceClientOffset:N||null,isSourcePublic:!!n}}}}function bs(r,t,s){E(!t.isDragging(),"Cannot call beginDrag while dragging."),r.forEach(function(a){E(s.getSource(a),"Expected sourceIds to be registered.")})}function Ds(r){E(typeof r=="function","When clientOffset is provided, getSourceClientOffset must be a function.")}function Cs(r){E(fr(r),"Item must be an object.")}function Os(r,t){let s=null;for(let a=r.length-1;a>=0;a--)if(t.canDragSource(r[a])){s=r[a];break}return s}function Es(r,t,s){return t in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function Is(r){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{},a=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),a.forEach(function(n){Es(r,n,s[n])})}return r}function Rs(r){return function(s={}){const a=r.getMonitor(),n=r.getRegistry();Ps(a),Ms(a).forEach((l,d)=>{const T=As(l,d,n,a),j={type:Ze,payload:{dropResult:Is({},s,T)}};r.dispatch(j)})}}function Ps(r){E(r.isDragging(),"Cannot call drop while not dragging."),E(!r.didDrop(),"Cannot call drop twice during one drag operation.")}function As(r,t,s,a){const n=s.getTarget(r);let o=n?n.drop(a,r):void 0;return ks(o),typeof o>"u"&&(o=t===0?{}:a.getDropResult()),o}function ks(r){E(typeof r>"u"||fr(r),"Drop result must either be an object or undefined.")}function Ms(r){const t=r.getTargetIds().filter(r.canDropOnTarget,r);return t.reverse(),t}function Fs(r){return function(){const s=r.getMonitor(),a=r.getRegistry();$s(s);const n=s.getSourceId();return n!=null&&(a.getSource(n,!0).endDrag(s,n),a.unpinSource()),{type:Qe}}}function $s(r){E(r.isDragging(),"Cannot call endDrag while not dragging.")}function Tt(r,t){return t===null?r===null:Array.isArray(r)?r.some(s=>s===t):r===t}function Ls(r){return function(s,{clientOffset:a}={}){_s(s);const n=s.slice(0),o=r.getMonitor(),l=r.getRegistry(),d=o.getItemType();return Hs(n,l,d),qs(n,o,l),Us(n,o,l),{type:Je,payload:{targetIds:n,clientOffset:a||null}}}}function _s(r){E(Array.isArray(r),"Expected targetIds to be an array.")}function qs(r,t,s){E(t.isDragging(),"Cannot call hover while not dragging."),E(!t.didDrop(),"Cannot call hover after drop.");for(let a=0;a<r.length;a++){const n=r[a];E(r.lastIndexOf(n)===a,"Expected targetIds to be unique in the passed array.");const o=s.getTarget(n);E(o,"Expected targetIds to be registered.")}}function Hs(r,t,s){for(let a=r.length-1;a>=0;a--){const n=r[a],o=t.getTargetType(n);Tt(o,s)||r.splice(a,1)}}function Us(r,t,s){r.forEach(function(a){s.getTarget(a).hover(t,a)})}function Vs(r){return function(){if(r.getMonitor().isDragging())return{type:At}}}function zs(r){return{beginDrag:Ss(r),publishDragSource:Vs(r),hover:Ls(r),drop:Rs(r),endDrag:Fs(r)}}class Ws{receiveBackend(t){this.backend=t}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){const t=this,{dispatch:s}=this.store;function a(o){return(...l)=>{const d=o.apply(t,l);typeof d<"u"&&s(d)}}const n=zs(this);return Object.keys(n).reduce((o,l)=>{const d=n[l];return o[l]=a(d),o},{})}dispatch(t){this.store.dispatch(t)}constructor(t,s){this.isSetUp=!1,this.handleRefCountChange=()=>{const a=this.store.getState().refCount>0;this.backend&&(a&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!a&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=t,this.monitor=s,t.subscribe(this.handleRefCountChange)}}function Bs(r,t){return{x:r.x+t.x,y:r.y+t.y}}function xr(r,t){return{x:r.x-t.x,y:r.y-t.y}}function Gs(r){const{clientOffset:t,initialClientOffset:s,initialSourceClientOffset:a}=r;return!t||!s||!a?null:xr(Bs(t,a),s)}function Xs(r){const{clientOffset:t,initialClientOffset:s}=r;return!t||!s?null:xr(t,s)}const Fe=[],kt=[];Fe.__IS_NONE__=!0;kt.__IS_ALL__=!0;function Ys(r,t){return r===Fe?!1:r===kt||typeof t>"u"?!0:ws(t,r).length>0}class Js{subscribeToStateChange(t,s={}){const{handlerIds:a}=s;E(typeof t=="function","listener must be a function."),E(typeof a>"u"||Array.isArray(a),"handlerIds, when specified, must be an array of strings.");let n=this.store.getState().stateId;const o=()=>{const l=this.store.getState(),d=l.stateId;try{d===n||d===n+1&&!Ys(l.dirtyHandlerIds,a)||t()}finally{n=d}};return this.store.subscribe(o)}subscribeToOffsetChange(t){E(typeof t=="function","listener must be a function.");let s=this.store.getState().dragOffset;const a=()=>{const n=this.store.getState().dragOffset;n!==s&&(s=n,t())};return this.store.subscribe(a)}canDragSource(t){if(!t)return!1;const s=this.registry.getSource(t);return E(s,`Expected to find a valid source. sourceId=${t}`),this.isDragging()?!1:s.canDrag(this,t)}canDropOnTarget(t){if(!t)return!1;const s=this.registry.getTarget(t);if(E(s,`Expected to find a valid target. targetId=${t}`),!this.isDragging()||this.didDrop())return!1;const a=this.registry.getTargetType(t),n=this.getItemType();return Tt(a,n)&&s.canDrop(this,t)}isDragging(){return!!this.getItemType()}isDraggingSource(t){if(!t)return!1;const s=this.registry.getSource(t,!0);if(E(s,`Expected to find a valid source. sourceId=${t}`),!this.isDragging()||!this.isSourcePublic())return!1;const a=this.registry.getSourceType(t),n=this.getItemType();return a!==n?!1:s.isDragging(this,t)}isOverTarget(t,s={shallow:!1}){if(!t)return!1;const{shallow:a}=s;if(!this.isDragging())return!1;const n=this.registry.getTargetType(t),o=this.getItemType();if(o&&!Tt(n,o))return!1;const l=this.getTargetIds();if(!l.length)return!1;const d=l.indexOf(t);return a?d===l.length-1:d>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return!!this.store.getState().dragOperation.isSourcePublic}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return Gs(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return Xs(this.store.getState().dragOffset)}constructor(t,s){this.store=t,this.registry=s}}const Qt=typeof globalThis<"u"?globalThis:self,vr=Qt.MutationObserver||Qt.WebKitMutationObserver;function jr(r){return function(){const s=setTimeout(n,0),a=setInterval(n,50);function n(){clearTimeout(s),clearInterval(a),r()}}}function Zs(r){let t=1;const s=new vr(r),a=document.createTextNode("");return s.observe(a,{characterData:!0}),function(){t=-t,a.data=t}}const Qs=typeof vr=="function"?Zs:jr;class Ks{enqueueTask(t){const{queue:s,requestFlush:a}=this;s.length||(a(),this.flushing=!0),s[s.length]=t}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{const{queue:t}=this;for(;this.index<t.length;){const s=this.index;if(this.index++,t[s].call(),this.index>this.capacity){for(let a=0,n=t.length-this.index;a<n;a++)t[a]=t[a+this.index];t.length-=this.index,this.index=0}}t.length=0,this.index=0,this.flushing=!1},this.registerPendingError=t=>{this.pendingErrors.push(t),this.requestErrorThrow()},this.requestFlush=Qs(this.flush),this.requestErrorThrow=jr(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}}class ea{call(){try{this.task&&this.task()}catch(t){this.onError(t)}finally{this.task=null,this.release(this)}}constructor(t,s){this.onError=t,this.release=s,this.task=null}}class ta{create(t){const s=this.freeTasks,a=s.length?s.pop():new ea(this.onError,n=>s[s.length]=n);return a.task=t,a}constructor(t){this.onError=t,this.freeTasks=[]}}const yr=new Ks,ra=new ta(yr.registerPendingError);function sa(r){yr.enqueueTask(ra.create(r))}const Mt="dnd-core/ADD_SOURCE",Ft="dnd-core/ADD_TARGET",$t="dnd-core/REMOVE_SOURCE",Ke="dnd-core/REMOVE_TARGET";function aa(r){return{type:Mt,payload:{sourceId:r}}}function na(r){return{type:Ft,payload:{targetId:r}}}function ia(r){return{type:$t,payload:{sourceId:r}}}function oa(r){return{type:Ke,payload:{targetId:r}}}function ca(r){E(typeof r.canDrag=="function","Expected canDrag to be a function."),E(typeof r.beginDrag=="function","Expected beginDrag to be a function."),E(typeof r.endDrag=="function","Expected endDrag to be a function.")}function la(r){E(typeof r.canDrop=="function","Expected canDrop to be a function."),E(typeof r.hover=="function","Expected hover to be a function."),E(typeof r.drop=="function","Expected beginDrag to be a function.")}function St(r,t){if(t&&Array.isArray(r)){r.forEach(s=>St(s,!1));return}E(typeof r=="string"||typeof r=="symbol",t?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}var re;(function(r){r.SOURCE="SOURCE",r.TARGET="TARGET"})(re||(re={}));let da=0;function ua(){return da++}function pa(r){const t=ua().toString();switch(r){case re.SOURCE:return`S${t}`;case re.TARGET:return`T${t}`;default:throw new Error(`Unknown Handler Role: ${r}`)}}function Kt(r){switch(r[0]){case"S":return re.SOURCE;case"T":return re.TARGET;default:throw new Error(`Cannot parse handler ID: ${r}`)}}function er(r,t){const s=r.entries();let a=!1;do{const{done:n,value:[,o]}=s.next();if(o===t)return!0;a=!!n}while(!a);return!1}class ha{addSource(t,s){St(t),ca(s);const a=this.addHandler(re.SOURCE,t,s);return this.store.dispatch(aa(a)),a}addTarget(t,s){St(t,!0),la(s);const a=this.addHandler(re.TARGET,t,s);return this.store.dispatch(na(a)),a}containsHandler(t){return er(this.dragSources,t)||er(this.dropTargets,t)}getSource(t,s=!1){return E(this.isSourceId(t),"Expected a valid source ID."),s&&t===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(t)}getTarget(t){return E(this.isTargetId(t),"Expected a valid target ID."),this.dropTargets.get(t)}getSourceType(t){return E(this.isSourceId(t),"Expected a valid source ID."),this.types.get(t)}getTargetType(t){return E(this.isTargetId(t),"Expected a valid target ID."),this.types.get(t)}isSourceId(t){return Kt(t)===re.SOURCE}isTargetId(t){return Kt(t)===re.TARGET}removeSource(t){E(this.getSource(t),"Expected an existing source."),this.store.dispatch(ia(t)),sa(()=>{this.dragSources.delete(t),this.types.delete(t)})}removeTarget(t){E(this.getTarget(t),"Expected an existing target."),this.store.dispatch(oa(t)),this.dropTargets.delete(t),this.types.delete(t)}pinSource(t){const s=this.getSource(t);E(s,"Expected an existing source."),this.pinnedSourceId=t,this.pinnedSource=s}unpinSource(){E(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(t,s,a){const n=pa(t);return this.types.set(n,s),t===re.SOURCE?this.dragSources.set(n,a):t===re.TARGET&&this.dropTargets.set(n,a),n}constructor(t){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=t}}const ma=(r,t)=>r===t;function ga(r,t){return!r&&!t?!0:!r||!t?!1:r.x===t.x&&r.y===t.y}function fa(r,t,s=ma){if(r.length!==t.length)return!1;for(let a=0;a<r.length;++a)if(!s(r[a],t[a]))return!1;return!0}function xa(r=Fe,t){switch(t.type){case Je:break;case Mt:case Ft:case Ke:case $t:return Fe;case Ye:case At:case Qe:case Ze:default:return kt}const{targetIds:s=[],prevTargetIds:a=[]}=t.payload,n=Ns(s,a);if(!(n.length>0||!fa(s,a)))return Fe;const l=a[a.length-1],d=s[s.length-1];return l!==d&&(l&&n.push(l),d&&n.push(d)),n}function va(r,t,s){return t in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function ja(r){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{},a=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),a.forEach(function(n){va(r,n,s[n])})}return r}const tr={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function ya(r=tr,t){const{payload:s}=t;switch(t.type){case Pt:case Ye:return{initialSourceClientOffset:s.sourceClientOffset,initialClientOffset:s.clientOffset,clientOffset:s.clientOffset};case Je:return ga(r.clientOffset,s.clientOffset)?r:ja({},r,{clientOffset:s.clientOffset});case Qe:case Ze:return tr;default:return r}}function Na(r,t,s){return t in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function be(r){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{},a=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),a.forEach(function(n){Na(r,n,s[n])})}return r}const wa={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function Ta(r=wa,t){const{payload:s}=t;switch(t.type){case Ye:return be({},r,{itemType:s.itemType,item:s.item,sourceId:s.sourceId,isSourcePublic:s.isSourcePublic,dropResult:null,didDrop:!1});case At:return be({},r,{isSourcePublic:!0});case Je:return be({},r,{targetIds:s.targetIds});case Ke:return r.targetIds.indexOf(s.targetId)===-1?r:be({},r,{targetIds:ys(r.targetIds,s.targetId)});case Ze:return be({},r,{dropResult:s.dropResult,didDrop:!0,targetIds:[]});case Qe:return be({},r,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return r}}function Sa(r=0,t){switch(t.type){case Mt:case Ft:return r+1;case $t:case Ke:return r-1;default:return r}}function ba(r=0){return r+1}function Da(r,t,s){return t in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function Ca(r){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{},a=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),a.forEach(function(n){Da(r,n,s[n])})}return r}function Oa(r={},t){return{dirtyHandlerIds:xa(r.dirtyHandlerIds,{type:t.type,payload:Ca({},t.payload,{prevTargetIds:js(r,"dragOperation.targetIds",[])})}),dragOffset:ya(r.dragOffset,t),refCount:Sa(r.refCount,t),dragOperation:Ta(r.dragOperation,t),stateId:ba(r.stateId)}}function Ea(r,t=void 0,s={},a=!1){const n=Ia(a),o=new Js(n,new ha(n)),l=new Ws(n,o),d=r(l,t,s);return l.receiveBackend(d),l}function Ia(r){const t=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__;return gr(Oa,r&&t&&t({name:"dnd-core",instanceId:"dnd-core"}))}function Ra(r,t){if(r==null)return{};var s=Pa(r,t),a,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(n=0;n<o.length;n++)a=o[n],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(r,a)&&(s[a]=r[a])}return s}function Pa(r,t){if(r==null)return{};var s={},a=Object.keys(r),n,o;for(o=0;o<a.length;o++)n=a[o],!(t.indexOf(n)>=0)&&(s[n]=r[n]);return s}let rr=0;const Ve=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var Aa=x.memo(function(t){var{children:s}=t,a=Ra(t,["children"]);const[n,o]=ka(a);return x.useEffect(()=>{if(o){const l=Nr();return++rr,()=>{--rr===0&&(l[Ve]=null)}}},[]),e.jsx(mr.Provider,{value:n,children:s})});function ka(r){if("manager"in r)return[{dragDropManager:r.manager},!1];const t=Ma(r.backend,r.context,r.options,r.debugMode),s=!r.context;return[t,s]}function Ma(r,t=Nr(),s,a){const n=t;return n[Ve]||(n[Ve]={dragDropManager:Ea(r,t,s,a)}),n[Ve]}function Nr(){return typeof globalThis<"u"?globalThis:window}var Fa=function r(t,s){if(t===s)return!0;if(t&&s&&typeof t=="object"&&typeof s=="object"){if(t.constructor!==s.constructor)return!1;var a,n,o;if(Array.isArray(t)){if(a=t.length,a!=s.length)return!1;for(n=a;n--!==0;)if(!r(t[n],s[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===s.source&&t.flags===s.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===s.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===s.toString();if(o=Object.keys(t),a=o.length,a!==Object.keys(s).length)return!1;for(n=a;n--!==0;)if(!Object.prototype.hasOwnProperty.call(s,o[n]))return!1;for(n=a;n--!==0;){var l=o[n];if(!r(t[l],s[l]))return!1}return!0}return t!==t&&s!==s};const $a=kr(Fa),ye=typeof window<"u"?x.useLayoutEffect:x.useEffect;function La(r,t,s){const[a,n]=x.useState(()=>t(r)),o=x.useCallback(()=>{const l=t(r);$a(a,l)||(n(l),s&&s())},[a,r,s]);return ye(o),[a,o]}function _a(r,t,s){const[a,n]=La(r,t,s);return ye(function(){const l=r.getHandlerId();if(l!=null)return r.subscribeToStateChange(n,{handlerIds:[l]})},[r,n]),a}function wr(r,t,s){return _a(t,r||(()=>({})),()=>s.reconnect())}function Tr(r,t){const s=[];return typeof r!="function"&&s.push(r),x.useMemo(()=>typeof r=="function"?r():r,s)}function qa(r){return x.useMemo(()=>r.hooks.dragSource(),[r])}function Ha(r){return x.useMemo(()=>r.hooks.dragPreview(),[r])}let ht=!1,mt=!1;class Ua{receiveHandlerId(t){this.sourceId=t}getHandlerId(){return this.sourceId}canDrag(){E(!ht,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return ht=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{ht=!1}}isDragging(){if(!this.sourceId)return!1;E(!mt,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return mt=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{mt=!1}}subscribeToStateChange(t,s){return this.internalMonitor.subscribeToStateChange(t,s)}isDraggingSource(t){return this.internalMonitor.isDraggingSource(t)}isOverTarget(t,s){return this.internalMonitor.isOverTarget(t,s)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(t){return this.internalMonitor.subscribeToOffsetChange(t)}canDragSource(t){return this.internalMonitor.canDragSource(t)}canDropOnTarget(t){return this.internalMonitor.canDropOnTarget(t)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(t){this.sourceId=null,this.internalMonitor=t.getMonitor()}}let gt=!1;class Va{receiveHandlerId(t){this.targetId=t}getHandlerId(){return this.targetId}subscribeToStateChange(t,s){return this.internalMonitor.subscribeToStateChange(t,s)}canDrop(){if(!this.targetId)return!1;E(!gt,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return gt=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{gt=!1}}isOver(t){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,t):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(t){this.targetId=null,this.internalMonitor=t.getMonitor()}}function za(r,t,s){const a=s.getRegistry(),n=a.addTarget(r,t);return[n,()=>a.removeTarget(n)]}function Wa(r,t,s){const a=s.getRegistry(),n=a.addSource(r,t);return[n,()=>a.removeSource(n)]}function bt(r,t,s,a){let n;if(n!==void 0)return!!n;if(r===t)return!0;if(typeof r!="object"||!r||typeof t!="object"||!t)return!1;const o=Object.keys(r),l=Object.keys(t);if(o.length!==l.length)return!1;const d=Object.prototype.hasOwnProperty.bind(t);for(let T=0;T<o.length;T++){const j=o[T];if(!d(j))return!1;const N=r[j],D=t[j];if(n=void 0,n===!1||n===void 0&&N!==D)return!1}return!0}function Dt(r){return r!==null&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function Ba(r){if(typeof r.type=="string")return;const t=r.type.displayName||r.type.name||"the component";throw new Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${t} into a <div>, or turn it into a drag source or a drop target itself.`)}function Ga(r){return(t=null,s=null)=>{if(!x.isValidElement(t)){const o=t;return r(o,s),o}const a=t;return Ba(a),Xa(a,s?o=>r(o,s):r)}}function Sr(r){const t={};return Object.keys(r).forEach(s=>{const a=r[s];if(s.endsWith("Ref"))t[s]=r[s];else{const n=Ga(a);t[s]=()=>n}}),t}function sr(r,t){typeof r=="function"?r(t):r.current=t}function Xa(r,t){const s=r.ref;return E(typeof s!="string","Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),s?x.cloneElement(r,{ref:a=>{sr(s,a),sr(t,a)}}):x.cloneElement(r,{ref:t})}class Ya{receiveHandlerId(t){this.handlerId!==t&&(this.handlerId=t,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(t){this.dragSourceOptionsInternal=t}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(t){this.dragPreviewOptionsInternal=t}reconnect(){const t=this.reconnectDragSource();this.reconnectDragPreview(t)}reconnectDragSource(){const t=this.dragSource,s=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return s&&this.disconnectDragSource(),this.handlerId?t?(s&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=t,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,t,this.dragSourceOptions)),s):(this.lastConnectedDragSource=t,s):s}reconnectDragPreview(t=!1){const s=this.dragPreview,a=t||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(a&&this.disconnectDragPreview(),!!this.handlerId){if(!s){this.lastConnectedDragPreview=s;return}a&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=s,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,s,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!bt(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!bt(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(t){this.hooks=Sr({dragSource:(s,a)=>{this.clearDragSource(),this.dragSourceOptions=a||null,Dt(s)?this.dragSourceRef=s:this.dragSourceNode=s,this.reconnectDragSource()},dragPreview:(s,a)=>{this.clearDragPreview(),this.dragPreviewOptions=a||null,Dt(s)?this.dragPreviewRef=s:this.dragPreviewNode=s,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=t}}class Ja{get connectTarget(){return this.dropTarget}reconnect(){const t=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();t&&this.disconnectDropTarget();const s=this.dropTarget;if(this.handlerId){if(!s){this.lastConnectedDropTarget=s;return}t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=s,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,s,this.dropTargetOptions))}}receiveHandlerId(t){t!==this.handlerId&&(this.handlerId=t,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(t){this.dropTargetOptionsInternal=t}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!bt(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(t){this.hooks=Sr({dropTarget:(s,a)=>{this.clearDropTarget(),this.dropTargetOptions=a,Dt(s)?this.dropTargetRef=s:this.dropTargetNode=s,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=t}}function Re(){const{dragDropManager:r}=x.useContext(mr);return E(r!=null,"Expected drag drop context"),r}function Za(r,t){const s=Re(),a=x.useMemo(()=>new Ya(s.getBackend()),[s]);return ye(()=>(a.dragSourceOptions=r||null,a.reconnect(),()=>a.disconnectDragSource()),[a,r]),ye(()=>(a.dragPreviewOptions=t||null,a.reconnect(),()=>a.disconnectDragPreview()),[a,t]),a}function Qa(){const r=Re();return x.useMemo(()=>new Ua(r),[r])}class Ka{beginDrag(){const t=this.spec,s=this.monitor;let a=null;return typeof t.item=="object"?a=t.item:typeof t.item=="function"?a=t.item(s):a={},a??null}canDrag(){const t=this.spec,s=this.monitor;return typeof t.canDrag=="boolean"?t.canDrag:typeof t.canDrag=="function"?t.canDrag(s):!0}isDragging(t,s){const a=this.spec,n=this.monitor,{isDragging:o}=a;return o?o(n):s===t.getSourceId()}endDrag(){const t=this.spec,s=this.monitor,a=this.connector,{end:n}=t;n&&n(s.getItem(),s),a.reconnect()}constructor(t,s,a){this.spec=t,this.monitor=s,this.connector=a}}function en(r,t,s){const a=x.useMemo(()=>new Ka(r,t,s),[t,s]);return x.useEffect(()=>{a.spec=r},[r]),a}function tn(r){return x.useMemo(()=>{const t=r.type;return E(t!=null,"spec.type must be defined"),t},[r])}function rn(r,t,s){const a=Re(),n=en(r,t,s),o=tn(r);ye(function(){if(o!=null){const[d,T]=Wa(o,n,a);return t.receiveHandlerId(d),s.receiveHandlerId(d),T}},[a,t,s,n,o])}function sn(r,t){const s=Tr(r);E(!s.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const a=Qa(),n=Za(s.options,s.previewOptions);return rn(s,a,n),[wr(s.collect,a,n),qa(n),Ha(n)]}function an(r){return x.useMemo(()=>r.hooks.dropTarget(),[r])}function nn(r){const t=Re(),s=x.useMemo(()=>new Ja(t.getBackend()),[t]);return ye(()=>(s.dropTargetOptions=r||null,s.reconnect(),()=>s.disconnectDropTarget()),[r]),s}function on(){const r=Re();return x.useMemo(()=>new Va(r),[r])}function cn(r){const{accept:t}=r;return x.useMemo(()=>(E(r.accept!=null,"accept must be defined"),Array.isArray(t)?t:[t]),[t])}class ln{canDrop(){const t=this.spec,s=this.monitor;return t.canDrop?t.canDrop(s.getItem(),s):!0}hover(){const t=this.spec,s=this.monitor;t.hover&&t.hover(s.getItem(),s)}drop(){const t=this.spec,s=this.monitor;if(t.drop)return t.drop(s.getItem(),s)}constructor(t,s){this.spec=t,this.monitor=s}}function dn(r,t){const s=x.useMemo(()=>new ln(r,t),[t]);return x.useEffect(()=>{s.spec=r},[r]),s}function un(r,t,s){const a=Re(),n=dn(r,t),o=cn(r);ye(function(){const[d,T]=za(o,n,a);return t.receiveHandlerId(d),s.receiveHandlerId(d),T},[a,t,n,s,o.map(l=>l.toString()).join("|")])}function pn(r,t){const s=Tr(r),a=on(),n=nn(s.options);return un(s,a,n),[wr(s.collect,a,n),an(n)]}function br(r){let t=null;return()=>(t==null&&(t=r()),t)}function hn(r,t){return r.filter(s=>s!==t)}function mn(r,t){const s=new Set,a=o=>s.add(o);r.forEach(a),t.forEach(a);const n=[];return s.forEach(o=>n.push(o)),n}class gn{enter(t){const s=this.entered.length,a=n=>this.isNodeInDocument(n)&&(!n.contains||n.contains(t));return this.entered=mn(this.entered.filter(a),[t]),s===0&&this.entered.length>0}leave(t){const s=this.entered.length;return this.entered=hn(this.entered.filter(this.isNodeInDocument),t),s>0&&this.entered.length===0}reset(){this.entered=[]}constructor(t){this.entered=[],this.isNodeInDocument=t}}class fn{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(t=>{Object.defineProperty(this.item,t,{configurable:!0,enumerable:!0,get(){return console.warn(`Browser doesn't allow reading "${t}" until the drop event.`),null}})})}loadDataTransfer(t){if(t){const s={};Object.keys(this.config.exposeProperties).forEach(a=>{const n=this.config.exposeProperties[a];n!=null&&(s[a]={value:n(t,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,s)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(t,s){return s===t.getSourceId()}endDrag(){}constructor(t){this.config=t,this.item={},this.initializeExposedProperties()}}const Dr="__NATIVE_FILE__",Cr="__NATIVE_URL__",Or="__NATIVE_TEXT__",Er="__NATIVE_HTML__",ar=Object.freeze(Object.defineProperty({__proto__:null,FILE:Dr,HTML:Er,TEXT:Or,URL:Cr},Symbol.toStringTag,{value:"Module"}));function ft(r,t,s){const a=t.reduce((n,o)=>n||r.getData(o),"");return a??s}const Ct={[Dr]:{exposeProperties:{files:r=>Array.prototype.slice.call(r.files),items:r=>r.items,dataTransfer:r=>r},matchesTypes:["Files"]},[Er]:{exposeProperties:{html:(r,t)=>ft(r,t,""),dataTransfer:r=>r},matchesTypes:["Html","text/html"]},[Cr]:{exposeProperties:{urls:(r,t)=>ft(r,t,"").split(`
`),dataTransfer:r=>r},matchesTypes:["Url","text/uri-list"]},[Or]:{exposeProperties:{text:(r,t)=>ft(r,t,""),dataTransfer:r=>r},matchesTypes:["Text","text/plain"]}};function xn(r,t){const s=Ct[r];if(!s)throw new Error(`native type ${r} has no configuration`);const a=new fn(s);return a.loadDataTransfer(t),a}function xt(r){if(!r)return null;const t=Array.prototype.slice.call(r.types||[]);return Object.keys(Ct).filter(s=>{const a=Ct[s];return a?.matchesTypes?a.matchesTypes.some(n=>t.indexOf(n)>-1):!1})[0]||null}const vn=br(()=>/firefox/i.test(navigator.userAgent)),Ir=br(()=>!!window.safari);class nr{interpolate(t){const{xs:s,ys:a,c1s:n,c2s:o,c3s:l}=this;let d=s.length-1;if(t===s[d])return a[d];let T=0,j=l.length-1,N;for(;T<=j;){N=Math.floor(.5*(T+j));const y=s[N];if(y<t)T=N+1;else if(y>t)j=N-1;else return a[N]}d=Math.max(0,j);const D=t-s[d],g=D*D;return a[d]+n[d]*D+o[d]*g+l[d]*D*g}constructor(t,s){const{length:a}=t,n=[];for(let y=0;y<a;y++)n.push(y);n.sort((y,C)=>t[y]<t[C]?-1:1);const o=[],l=[];let d,T;for(let y=0;y<a-1;y++)d=t[y+1]-t[y],T=s[y+1]-s[y],o.push(d),l.push(T/d);const j=[l[0]];for(let y=0;y<o.length-1;y++){const C=l[y],i=l[y+1];if(C*i<=0)j.push(0);else{d=o[y];const w=o[y+1],v=d+w;j.push(3*v/((v+w)/C+(v+d)/i))}}j.push(l[l.length-1]);const N=[],D=[];let g;for(let y=0;y<j.length-1;y++){g=l[y];const C=j[y],i=1/o[y],w=C+j[y+1]-g-g;N.push((g-C-w)*i),D.push(w*i*i)}this.xs=t,this.ys=s,this.c1s=j,this.c2s=N,this.c3s=D}}const jn=1;function Rr(r){const t=r.nodeType===jn?r:r.parentElement;if(!t)return null;const{top:s,left:a}=t.getBoundingClientRect();return{x:a,y:s}}function qe(r){return{x:r.clientX,y:r.clientY}}function yn(r){var t;return r.nodeName==="IMG"&&(vn()||!(!((t=document.documentElement)===null||t===void 0)&&t.contains(r)))}function Nn(r,t,s,a){let n=r?t.width:s,o=r?t.height:a;return Ir()&&r&&(o/=window.devicePixelRatio,n/=window.devicePixelRatio),{dragPreviewWidth:n,dragPreviewHeight:o}}function wn(r,t,s,a,n){const o=yn(t),d=Rr(o?r:t),T={x:s.x-d.x,y:s.y-d.y},{offsetWidth:j,offsetHeight:N}=r,{anchorX:D,anchorY:g}=a,{dragPreviewWidth:y,dragPreviewHeight:C}=Nn(o,t,j,N),i=()=>{let O=new nr([0,.5,1],[T.y,T.y/N*C,T.y+C-N]).interpolate(g);return Ir()&&o&&(O+=(window.devicePixelRatio-1)*C),O},w=()=>new nr([0,.5,1],[T.x,T.x/j*y,T.x+y-j]).interpolate(D),{offsetX:v,offsetY:A}=n,u=v===0||v,m=A===0||A;return{x:u?v:w(),y:m?A:i()}}class Tn{get window(){if(this.globalContext)return this.globalContext;if(typeof window<"u")return window}get document(){var t;return!((t=this.globalContext)===null||t===void 0)&&t.document?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var t;return((t=this.optionsArgs)===null||t===void 0?void 0:t.rootElement)||this.window}constructor(t,s){this.ownerDocument=null,this.globalContext=t,this.optionsArgs=s}}function Sn(r,t,s){return t in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function ir(r){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{},a=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),a.forEach(function(n){Sn(r,n,s[n])})}return r}class bn{profile(){var t,s;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:((t=this.dragStartSourceIds)===null||t===void 0?void 0:t.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:((s=this.dragOverTargetIds)===null||s===void 0?void 0:s.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){const t=this.rootElement;if(t!==void 0){if(t.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");t.__isReactDndBackendSetUp=!0,this.addEventListeners(t)}}teardown(){const t=this.rootElement;if(t!==void 0&&(t.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId)){var s;(s=this.window)===null||s===void 0||s.cancelAnimationFrame(this.asyncEndDragFrameId)}}connectDragPreview(t,s,a){return this.sourcePreviewNodeOptions.set(t,a),this.sourcePreviewNodes.set(t,s),()=>{this.sourcePreviewNodes.delete(t),this.sourcePreviewNodeOptions.delete(t)}}connectDragSource(t,s,a){this.sourceNodes.set(t,s),this.sourceNodeOptions.set(t,a);const n=l=>this.handleDragStart(l,t),o=l=>this.handleSelectStart(l);return s.setAttribute("draggable","true"),s.addEventListener("dragstart",n),s.addEventListener("selectstart",o),()=>{this.sourceNodes.delete(t),this.sourceNodeOptions.delete(t),s.removeEventListener("dragstart",n),s.removeEventListener("selectstart",o),s.setAttribute("draggable","false")}}connectDropTarget(t,s){const a=l=>this.handleDragEnter(l,t),n=l=>this.handleDragOver(l,t),o=l=>this.handleDrop(l,t);return s.addEventListener("dragenter",a),s.addEventListener("dragover",n),s.addEventListener("drop",o),()=>{s.removeEventListener("dragenter",a),s.removeEventListener("dragover",n),s.removeEventListener("drop",o)}}addEventListeners(t){t.addEventListener&&(t.addEventListener("dragstart",this.handleTopDragStart),t.addEventListener("dragstart",this.handleTopDragStartCapture,!0),t.addEventListener("dragend",this.handleTopDragEndCapture,!0),t.addEventListener("dragenter",this.handleTopDragEnter),t.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),t.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),t.addEventListener("dragover",this.handleTopDragOver),t.addEventListener("dragover",this.handleTopDragOverCapture,!0),t.addEventListener("drop",this.handleTopDrop),t.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(t){t.removeEventListener&&(t.removeEventListener("dragstart",this.handleTopDragStart),t.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),t.removeEventListener("dragend",this.handleTopDragEndCapture,!0),t.removeEventListener("dragenter",this.handleTopDragEnter),t.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),t.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),t.removeEventListener("dragover",this.handleTopDragOver),t.removeEventListener("dragover",this.handleTopDragOverCapture,!0),t.removeEventListener("drop",this.handleTopDrop),t.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const t=this.monitor.getSourceId(),s=this.sourceNodeOptions.get(t);return ir({dropEffect:this.altKeyPressed?"copy":"move"},s||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const t=this.monitor.getSourceId(),s=this.sourcePreviewNodeOptions.get(t);return ir({anchorX:.5,anchorY:.5,captureDraggingState:!1},s||{})}isDraggingNativeItem(){const t=this.monitor.getItemType();return Object.keys(ar).some(s=>ar[s]===t)}beginDragNativeItem(t,s){this.clearCurrentDragSourceNode(),this.currentNativeSource=xn(t,s),this.currentNativeHandle=this.registry.addSource(t,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(t){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=t;const s=1e3;this.mouseMoveTimeoutTimer=setTimeout(()=>{var a;return(a=this.rootElement)===null||a===void 0?void 0:a.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},s)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){if(this.currentDragSourceNode=null,this.rootElement){var t;(t=this.window)===null||t===void 0||t.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)}return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(t,s){t.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(s))}handleDragEnter(t,s){this.dragEnterTargetIds.unshift(s)}handleDragOver(t,s){this.dragOverTargetIds===null&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(s)}handleDrop(t,s){this.dropTargetIds.unshift(s)}constructor(t,s,a){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=n=>{const o=this.sourceNodes.get(n);return o&&Rr(o)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=n=>!!(n&&this.document&&this.document.body&&this.document.body.contains(n)),this.endDragIfSourceWasRemovedFromDOM=()=>{const n=this.currentDragSourceNode;n==null||this.isNodeInDocument(n)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=n=>{this.hoverRafId===null&&typeof requestAnimationFrame<"u"&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(n||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{this.hoverRafId!==null&&typeof cancelAnimationFrame<"u"&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=n=>{if(n.defaultPrevented)return;const{dragStartSourceIds:o}=this;this.dragStartSourceIds=null;const l=qe(n);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(o||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:l});const{dataTransfer:d}=n,T=xt(d);if(this.monitor.isDragging()){if(d&&typeof d.setDragImage=="function"){const N=this.monitor.getSourceId(),D=this.sourceNodes.get(N),g=this.sourcePreviewNodes.get(N)||D;if(g){const{anchorX:y,anchorY:C,offsetX:i,offsetY:w}=this.getCurrentSourcePreviewNodeOptions(),u=wn(D,g,l,{anchorX:y,anchorY:C},{offsetX:i,offsetY:w});d.setDragImage(g,u.x,u.y)}}try{d?.setData("application/json",{})}catch{}this.setCurrentDragSourceNode(n.target);const{captureDraggingState:j}=this.getCurrentSourcePreviewNodeOptions();j?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(T)this.beginDragNativeItem(T);else{if(d&&!d.types&&(n.target&&!n.target.hasAttribute||!n.target.hasAttribute("draggable")))return;n.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=n=>{if(this.dragEnterTargetIds=[],this.isDraggingNativeItem()){var o;(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(n.dataTransfer)}if(!this.enterLeaveCounter.enter(n.target)||this.monitor.isDragging())return;const{dataTransfer:d}=n,T=xt(d);T&&this.beginDragNativeItem(T,d)},this.handleTopDragEnter=n=>{const{dragEnterTargetIds:o}=this;if(this.dragEnterTargetIds=[],!this.monitor.isDragging())return;this.altKeyPressed=n.altKey,o.length>0&&this.actions.hover(o,{clientOffset:qe(n)}),o.some(d=>this.monitor.canDropOnTarget(d))&&(n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect=this.getCurrentDropEffect()))},this.handleTopDragOverCapture=n=>{if(this.dragOverTargetIds=[],this.isDraggingNativeItem()){var o;(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(n.dataTransfer)}},this.handleTopDragOver=n=>{const{dragOverTargetIds:o}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging()){n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect="none");return}this.altKeyPressed=n.altKey,this.lastClientOffset=qe(n),this.scheduleHover(o),(o||[]).some(d=>this.monitor.canDropOnTarget(d))?(n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?n.preventDefault():(n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=n=>{this.isDraggingNativeItem()&&n.preventDefault(),this.enterLeaveCounter.leave(n.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=n=>{if(this.dropTargetIds=[],this.isDraggingNativeItem()){var o;n.preventDefault(),(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(n.dataTransfer)}else xt(n.dataTransfer)&&n.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=n=>{const{dropTargetIds:o}=this;this.dropTargetIds=[],this.actions.hover(o,{clientOffset:qe(n)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=n=>{const o=n.target;typeof o.dragDrop=="function"&&(o.tagName==="INPUT"||o.tagName==="SELECT"||o.tagName==="TEXTAREA"||o.isContentEditable||(n.preventDefault(),o.dragDrop()))},this.options=new Tn(s,a),this.actions=t.getActions(),this.monitor=t.getMonitor(),this.registry=t.getRegistry(),this.enterLeaveCounter=new gn(this.isNodeInDocument)}}const Dn=function(t,s,a){return new bn(t,s,a)};class Cn{static async testCondition(t){return(await q.post("/conditions/test",t)).data}static async validateCondition(t){return(await q.post("/conditions/validate",t)).data}}function On({condition:r,conditionType:t,onClose:s,className:a}){const{toast:n}=Ie(),[o,l]=x.useState(`{
  "type": "ORDER",
  "amount": 1500,
  "customer": {
    "id": "12345",
    "name": "John Doe"
  },
  "items": [
    {
      "sku": "ABC123",
      "quantity": 2
    }
  ]
}`),[d,T]=x.useState([]),[j,N]=x.useState([]),[D,g]=x.useState(!1),[y,C]=x.useState(null),[i,w]=x.useState(""),[v,A]=x.useState(null),u=x.useCallback(h=>{if(h){l(h);try{JSON.parse(h),A(null)}catch{A("Invalid JSON format")}}},[]),m=x.useCallback(async()=>{if(!r||t==="ALWAYS"){n({title:"Info",description:"No condition to test (ALWAYS type)"});return}try{const h=JSON.parse(o);g(!0);const f=await Cn.testCondition({condition:r,conditionType:t,payload:h,headers:h.headers||{}}),c={id:f.id,timestamp:new Date(f.timestamp),payload:h,condition:f.condition,conditionType:f.conditionType,result:f.result,executionTime:f.executionTimeMs,error:f.error,details:f.details};T(p=>[c,...p]),C(c)}catch(h){n({title:"Test Error",description:h instanceof Error?h.message:"Failed to run test",variant:"destructive"})}finally{g(!1)}},[r,t,o,n]),S=x.useCallback(()=>{if(!i.trim()){n({title:"Error",description:"Please enter a test case name",variant:"destructive"});return}try{const h=JSON.parse(o),f=d.find(p=>JSON.stringify(p.payload)===JSON.stringify(h)),c={id:Date.now().toString(),name:i,payload:h,expectedResult:f?.result||!1,tags:[t]};N(p=>[...p,c]),w(""),n({title:"Success",description:"Test case saved"})}catch{n({title:"Error",description:"Invalid payload",variant:"destructive"})}},[i,o,d,t,n]),O=x.useCallback(h=>{l(JSON.stringify(h.payload,null,2)),n({title:"Test Case Loaded",description:`Loaded: ${h.name}`})},[n]),L=x.useCallback(()=>{const h={condition:r,conditionType:t,testResults:d,savedTestCases:j,exportedAt:new Date().toISOString()},f=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),c=URL.createObjectURL(f),p=document.createElement("a");p.href=c,p.download=`condition-tests-${Date.now()}.json`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(c),n({title:"Exported",description:"Test results exported successfully"})},[r,t,d,j,n]);return e.jsx("div",{className:Y("space-y-4",a),children:e.jsxs($,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Z,{children:"Condition Tester"}),e.jsx(ge,{children:"Test your routing conditions with sample payloads"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{variant:"outline",children:t}),s&&e.jsx(R,{variant:"ghost",size:"icon",onClick:s,children:e.jsx(Me,{className:"h-4 w-4"})})]})]})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-md font-mono text-sm",children:r||"No condition defined"}),e.jsx(cr,{}),e.jsxs(Be,{defaultValue:"payload",className:"w-full",children:[e.jsxs(Ge,{className:"grid w-full grid-cols-3",children:[e.jsx(se,{value:"payload",children:"Test Payload"}),e.jsx(se,{value:"results",children:"Results"}),e.jsx(se,{value:"saved",children:"Saved Tests"})]}),e.jsxs(ae,{value:"payload",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Test Payload (JSON)"}),v&&e.jsx("span",{className:"text-xs text-destructive",children:v})]}),e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsx(Et,{height:"300px",defaultLanguage:"json",value:o,onChange:u,theme:"vs-dark",options:{minimap:{enabled:!1},fontSize:12,formatOnPaste:!0,formatOnType:!0}})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{onClick:m,disabled:D||!!v||t==="ALWAYS",className:"gap-2",children:D?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4 animate-spin"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ur,{className:"h-4 w-4"}),"Run Test"]})}),e.jsx("div",{className:"flex-1"}),e.jsx("input",{type:"text",placeholder:"Test case name...",value:i,onChange:h=>w(h.target.value),className:"px-3 py-2 text-sm border rounded-md"}),e.jsxs(R,{variant:"outline",size:"sm",onClick:S,disabled:!i.trim()||!!v,className:"gap-2",children:[e.jsx(zt,{className:"h-4 w-4"}),"Save Test"]})]})]}),e.jsx(ae,{value:"results",className:"space-y-4 mt-4",children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No test results yet"}),e.jsx("p",{className:"text-sm",children:"Run a test to see results here"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.length," test(s) run"]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:L,className:"gap-2",children:[e.jsx(It,{className:"h-4 w-4"}),"Export"]})]}),e.jsx(Ee,{className:"h-[300px] pr-4",children:e.jsx("div",{className:"space-y-2",children:d.map(h=>e.jsx($,{className:Y("cursor-pointer transition-colors",y?.id===h.id&&"border-primary"),onClick:()=>C(h),children:e.jsxs(_,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h.result?e.jsx(je,{className:"h-4 w-4 text-green-500"}):h.error?e.jsx(Me,{className:"h-4 w-4 text-red-500"}):e.jsx(Me,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium",children:h.result?"Matched":"No Match"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx($e,{className:"h-3 w-3"}),h.executionTime.toFixed(2),"ms",e.jsx("span",{children:"•"}),h.timestamp.toLocaleTimeString()]})]}),h.error&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:h.error})]})},h.id))})}),y&&y.details&&e.jsxs($,{children:[e.jsx(J,{children:e.jsx(Z,{className:"text-sm",children:"Test Details"})}),e.jsxs(_,{className:"space-y-3",children:[y.details.steps&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Execution Steps:"}),e.jsx("div",{className:"space-y-1",children:y.details.steps.map((h,f)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[f+1,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{children:h.description}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:JSON.stringify(h.result)})]})]},f))})]}),y.details.variables&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Variables:"}),e.jsx("pre",{className:"text-xs bg-muted p-2 rounded-md overflow-x-auto",children:JSON.stringify(y.details.variables,null,2)})]})]})]})]})}),e.jsx(ae,{value:"saved",className:"space-y-4 mt-4",children:j.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(zt,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No saved test cases"}),e.jsx("p",{className:"text-sm",children:"Save test cases for quick reuse"})]}):e.jsx(Ee,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-2 pr-4",children:j.map(h=>e.jsx($,{children:e.jsx(_,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:h.name}),h.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:h.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[h.tags?.map(f=>e.jsx(M,{variant:"secondary",className:"text-xs",children:f},f)),e.jsxs(M,{variant:h.expectedResult?"success":"destructive",className:"text-xs",children:["Expects: ",h.expectedResult?"Match":"No Match"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>O(h),title:"Load test case",children:e.jsx(Qr,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>{N(f=>f.filter(c=>c.id!==h.id))},title:"Delete test case",className:"text-destructive",children:e.jsx(Xe,{className:"h-4 w-4"})})]})]})})},h.id))})})})]})]})})]})})}const En={string:["equals","not equals","contains","starts with","ends with","matches regex"],number:["equals","not equals","greater than","less than","greater or equal","less or equal"],boolean:["is true","is false"],date:["equals","before","after","between"]},In=[{value:"string",label:"String",icon:ms},{value:"number",label:"Number",icon:Jr},{value:"boolean",label:"Boolean",icon:hs},{value:"date",label:"Date",icon:Kr}];function Rn({conditionType:r,routingCondition:t,onChange:s,availableFields:a=[],testPayload:n,className:o}){const[l,d]=x.useState([]),[T,j]=x.useState(t||"");x.useState(null);const[N,D]=x.useState(!1);Nt.useEffect(()=>{if(t&&r==="EXPRESSION")try{const v=g(t);v.length>0&&d(v)}catch(v){console.warn("Could not parse expression to rules:",v)}},[t,r]);const g=v=>[],y=x.useCallback(()=>{const v={id:Date.now().toString(),field:a[0]||"",operator:"equals",value:"",dataType:"string",logicalOperator:l.length>0?"AND":void 0};d([...l,v])},[l,a]),C=x.useCallback((v,A)=>{d(l.map(u=>u.id===v?{...u,...A}:u))},[l]),i=x.useCallback(v=>{d(l.filter(A=>A.id!==v))},[l]),w=x.useCallback(()=>l.length===0?"":l.map((v,A)=>{const u=v.field,m=v.operator,S=v.dataType==="string"?`"${v.value}"`:v.value;let O="";switch(m){case"equals":O=`${u} == ${S}`;break;case"not equals":O=`${u} != ${S}`;break;case"contains":O=`${u}.contains(${S})`;break;case"starts with":O=`${u}.startsWith(${S})`;break;case"ends with":O=`${u}.endsWith(${S})`;break;case"matches regex":O=`${u}.matches(${S})`;break;case"greater than":O=`${u} > ${S}`;break;case"less than":O=`${u} < ${S}`;break;case"greater or equal":O=`${u} >= ${S}`;break;case"less or equal":O=`${u} <= ${S}`;break;case"is true":O=`${u} == true`;break;case"is false":O=`${u} == false`;break;default:O=`${u} ${m} ${S}`}return A>0&&v.logicalOperator?` ${v.logicalOperator} ${O}`:O}).join(""),[l]);return Nt.useEffect(()=>{if(r==="EXPRESSION"&&l.length>0){const v=w();j(v),s(v,r)}},[l,r,w,s]),r==="ALWAYS"?e.jsxs(fe,{className:o,children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(Oe,{children:"This target will always receive messages (no routing condition)."})]}):r==="CUSTOM"?e.jsxs("div",{className:Y("space-y-4",o),children:[e.jsxs(fe,{children:[e.jsx(Mr,{className:"h-4 w-4"}),e.jsx(Oe,{children:"Enter a custom routing expression. This will be evaluated by your custom routing engine."})]}),e.jsx(de,{value:T,onChange:v=>{j(v.target.value),s(v.target.value,r)},placeholder:"Enter custom routing expression...",className:"font-mono text-sm",rows:4})]}):e.jsxs("div",{className:Y("space-y-4",o),children:[r==="EXPRESSION"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{children:"Visual Rule Builder"}),e.jsxs(R,{variant:"outline",size:"sm",onClick:y,className:"gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),"Add Rule"]})]}),l.length===0?e.jsx($,{children:e.jsx(_,{className:"pt-6 text-center text-muted-foreground",children:'No rules defined. Click "Add Rule" to start building your condition.'})}):e.jsx("div",{className:"space-y-2",children:l.map((v,A)=>e.jsx($,{children:e.jsx(_,{className:"pt-4",children:e.jsxs("div",{className:"grid gap-4",children:[A>0&&e.jsxs(ue,{value:v.logicalOperator,onValueChange:u=>C(v.id,{logicalOperator:u}),children:[e.jsx(pe,{className:"w-24",children:e.jsx(he,{})}),e.jsxs(me,{children:[e.jsx(te,{value:"AND",children:"AND"}),e.jsx(te,{value:"OR",children:"OR"})]})]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(P,{className:"text-xs",children:"Field"}),e.jsxs(ue,{value:v.field,onValueChange:u=>C(v.id,{field:u}),children:[e.jsx(pe,{children:e.jsx(he,{placeholder:"Select field"})}),e.jsxs(me,{children:[a.map(u=>e.jsx(te,{value:u,children:u},u)),e.jsx(te,{value:"custom",children:"Custom field..."})]})]}),v.field==="custom"&&e.jsx(X,{className:"mt-2",placeholder:"Enter field path (e.g., payload.order.type)",onChange:u=>C(v.id,{field:u.target.value})})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(P,{className:"text-xs",children:"Type"}),e.jsxs(ue,{value:v.dataType,onValueChange:u=>C(v.id,{dataType:u}),children:[e.jsx(pe,{children:e.jsx(he,{})}),e.jsx(me,{children:In.map(u=>e.jsx(te,{value:u.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u.icon,{className:"h-3 w-3"}),u.label]})},u.value))})]})]}),e.jsxs("div",{className:"w-40",children:[e.jsx(P,{className:"text-xs",children:"Operator"}),e.jsxs(ue,{value:v.operator,onValueChange:u=>C(v.id,{operator:u}),children:[e.jsx(pe,{children:e.jsx(he,{})}),e.jsx(me,{children:En[v.dataType]?.map(u=>e.jsx(te,{value:u,children:u},u))})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(P,{className:"text-xs",children:"Value"}),v.dataType==="boolean"?e.jsxs(ue,{value:v.value,onValueChange:u=>C(v.id,{value:u}),children:[e.jsx(pe,{children:e.jsx(he,{})}),e.jsxs(me,{children:[e.jsx(te,{value:"true",children:"True"}),e.jsx(te,{value:"false",children:"False"})]})]}):e.jsx(X,{value:v.value,onChange:u=>C(v.id,{value:u.target.value}),placeholder:v.dataType==="date"?"YYYY-MM-DD":"Enter value",type:v.dataType==="number"?"number":"text"})]}),e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>i(v.id),className:"text-destructive",children:e.jsx(Xe,{className:"h-4 w-4"})})]})]})})},v.id))}),l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Generated Expression"}),e.jsx("div",{className:"p-3 bg-muted rounded-md font-mono text-sm",children:w()||"No expression generated"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{children:r==="EXPRESSION"?"Edit Expression Directly":r==="XPATH"?"XPath Expression":r==="JSONPATH"?"JSONPath Expression":r==="REGEX"?"Regular Expression":r==="HEADER_MATCH"?"Header Match Expression":r==="CONTENT_TYPE"?"Content Type Pattern":"Expression"}),r==="EXPRESSION"&&l.length>0&&e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>d([]),children:"Clear Visual Rules"})]}),e.jsx(de,{value:T,onChange:v=>{j(v.target.value),s(v.target.value,r)},placeholder:r==="XPATH"?'//order[@type="urgent"]':r==="JSONPATH"?'$.order[?(@.type=="urgent")]':r==="REGEX"?"^ORDER-\\d{6}$":r==="HEADER_MATCH"?"Content-Type: application/json":r==="CONTENT_TYPE"?"application/json":'payload.type == "ORDER" && payload.amount > 1000',className:"font-mono text-sm",rows:3})]}),r!=="ALWAYS"&&T&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>D(!0),className:"gap-2",children:[e.jsx(ps,{className:"h-4 w-4"}),"Test Condition"]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50",children:e.jsx("div",{className:"fixed left-[50%] top-[50%] z-50 w-full max-w-4xl max-h-[90vh] overflow-y-auto translate-x-[-50%] translate-y-[-50%]",children:e.jsx(On,{condition:T,conditionType:r,onClose:()=>D(!1)})})})]})}const Pn=({target:r,index:t,onMove:s,onEdit:a,onDelete:n,onToggleActive:o,onDuplicate:l})=>{const d=Nt.useRef(null),[{handlerId:T},j]=pn({accept:"target",collect(y){return{handlerId:y.getHandlerId()}},hover(y,C){if(!d.current)return;const i=y.index,w=t;if(i===w)return;const v=d.current?.getBoundingClientRect(),A=(v.bottom-v.top)/2,m=C.getClientOffset().y-v.top;i<w&&m<A||i>w&&m>A||(s(i,w),y.index=w)}}),[{isDragging:N},D]=sn({type:"target",item:()=>({id:r.id,index:t}),collect:y=>({isDragging:y.isDragging()})});D(j(d));const g=()=>{switch(r.conditionType){case"ALWAYS":return e.jsx(je,{className:"h-4 w-4"});case"EXPRESSION":return e.jsx(Ue,{className:"h-4 w-4"});case"XPATH":return e.jsx(e.Fragment,{});case"JSONPATH":return e.jsx(e.Fragment,{});case"REGEX":return e.jsx(e.Fragment,{});default:return e.jsx(ce,{className:"h-4 w-4"})}};return e.jsx("div",{ref:d,className:Y("transition-opacity",N&&"opacity-50"),"data-handler-id":T,children:e.jsx($,{className:Y("relative",!r.active&&"opacity-60"),children:e.jsxs(_,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"cursor-move",children:e.jsx(ds,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"font-medium text-lg",children:["#",r.executionOrder+1]}),e.jsx("h4",{className:"font-semibold",children:r.adapterName||"Unknown Adapter"}),r.parallel&&e.jsxs(M,{variant:"secondary",className:"gap-1",children:[e.jsx(es,{className:"h-3 w-3"}),"Parallel"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[g(),e.jsx("span",{children:r.conditionType})]}),r.retryAttempts&&r.retryAttempts>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),e.jsxs("span",{children:[r.retryAttempts," retries"]})]}),r.timeoutMs&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-3 w-3"}),e.jsxs("span",{children:[r.timeoutMs/1e3,"s timeout"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dr,{checked:r.active,onCheckedChange:y=>o(r.id,y)}),e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>l(r),title:"Duplicate target",children:e.jsx(Rt,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>a(r),children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>n(r.id),className:"text-destructive",children:e.jsx(Xe,{className:"h-4 w-4"})})]})]}),r.routingCondition&&r.conditionType!=="ALWAYS"&&e.jsx("div",{className:"mt-3 p-2 bg-muted rounded-md font-mono text-xs",children:r.routingCondition})]})})})};function An({flowId:r,availableAdapters:t,onTargetsChange:s,className:a}){const{toast:n}=Ie(),[o,l]=x.useState([]),[d,T]=x.useState(!0),[j,N]=x.useState(null),[D,g]=x.useState(!1),y=x.useCallback(async()=>{try{T(!0);const m=await ne.getTargets(r);l(m),s?.(m)}catch(m){console.error("Failed to load targets:",m),n({title:"Error",description:"Failed to load orchestration targets",variant:"destructive"})}finally{T(!1)}},[r,s,n]);x.useEffect(()=>{y()},[y]);const C=x.useCallback(async(m,S)=>{const O=o[m],L=[...o];L.splice(m,1),L.splice(S,0,O);const h=L.map((f,c)=>({...f,executionOrder:c}));l(h);try{const f=h.map(c=>c.id);await ne.reorderTargets(r,f),s?.(h)}catch(f){console.error("Failed to reorder targets:",f),n({title:"Error",description:"Failed to save new order",variant:"destructive"}),y()}},[o,r,n,s,y]),i=async m=>{try{const S=t.find(c=>c.id===m);if(!S)return;const O={targetAdapterId:m,executionOrder:o.length,parallel:!1,conditionType:"ALWAYS",active:!0,retryAttempts:0,timeoutMs:3e4,errorStrategy:"FAIL"},h={...await ne.addTarget(r,O),adapterName:S.name,adapterType:S.type},f=[...o,h];l(f),s?.(f),n({title:"Success",description:"Target adapter added successfully"}),g(!1)}catch(S){console.error("Failed to add target:",S),n({title:"Error",description:"Failed to add target adapter",variant:"destructive"})}},w=async m=>{try{const S=await ne.updateTarget(r,m.id,m),O=o.map(L=>L.id===m.id?{...S,adapterName:L.adapterName,adapterType:L.adapterType}:L);l(O),s?.(O),n({title:"Success",description:"Target updated successfully"}),N(null)}catch(S){console.error("Failed to update target:",S),n({title:"Error",description:"Failed to update target",variant:"destructive"})}},v=async m=>{if(confirm("Are you sure you want to delete this target?"))try{await ne.deleteTarget(r,m);const S=o.filter(O=>O.id!==m).map((O,L)=>({...O,executionOrder:L}));l(S),s?.(S),n({title:"Success",description:"Target deleted successfully"})}catch(S){console.error("Failed to delete target:",S),n({title:"Error",description:"Failed to delete target",variant:"destructive"})}},A=async(m,S)=>{try{S?await ne.activateTarget(r,m):await ne.deactivateTarget(r,m);const O=o.map(L=>L.id===m?{...L,active:S}:L);l(O),s?.(O),n({title:"Success",description:`Target ${S?"activated":"deactivated"} successfully`})}catch(O){console.error("Failed to toggle target:",O),n({title:"Error",description:`Failed to ${S?"activate":"deactivate"} target`,variant:"destructive"})}},u=async m=>{try{const S={...m,id:void 0,executionOrder:o.length,active:!1},L={...await ne.addTarget(r,S),adapterName:m.adapterName,adapterType:m.adapterType},h=[...o,L];l(h),s?.(h),n({title:"Success",description:"Target duplicated successfully"})}catch(S){console.error("Failed to duplicate target:",S),n({title:"Error",description:"Failed to duplicate target",variant:"destructive"})}};return d?e.jsx("div",{className:Y("flex items-center justify-center py-8",a),children:e.jsx(We,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsx(Aa,{backend:Dn,children:e.jsxs("div",{className:Y("space-y-6",a),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Orchestration Targets"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag to reorder execution sequence. Targets execute in order unless marked as parallel."})]}),e.jsxs(R,{onClick:()=>g(!0),className:"gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),"Add Target"]})]}),o.length===0?e.jsx($,{children:e.jsxs(_,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(ce,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"No Targets Configured"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Add target adapters to define where messages should be routed."}),e.jsxs(R,{onClick:()=>g(!0),className:"gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),"Add First Target"]})]})}):e.jsx("div",{className:"space-y-3",children:o.map((m,S)=>e.jsx(Pn,{target:m,index:S,onMove:C,onEdit:N,onDelete:v,onToggleActive:A,onDuplicate:u},m.id))}),D&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50",children:e.jsx("div",{className:"fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%]",children:e.jsxs($,{children:[e.jsxs(J,{children:[e.jsx(Z,{children:"Add Target Adapter"}),e.jsx(ge,{children:"Select an adapter to add as a target for this orchestration flow."})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-2",children:t.map(m=>e.jsxs(R,{variant:"outline",className:"justify-start",onClick:()=>i(m.id),children:[e.jsx(M,{variant:"secondary",className:"mr-2",children:m.type}),m.name]},m.id))}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(R,{variant:"outline",onClick:()=>g(!1),children:"Cancel"})})]})]})})}),j&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50",children:e.jsx("div",{className:"fixed left-[50%] top-[50%] z-50 w-full max-w-3xl max-h-[90vh] overflow-y-auto translate-x-[-50%] translate-y-[-50%]",children:e.jsxs($,{children:[e.jsxs(J,{children:[e.jsxs(Z,{children:["Edit Target: ",j.adapterName]}),e.jsx(ge,{children:"Configure routing conditions, retry policies, and error handling."})]}),e.jsxs(_,{children:[e.jsxs(Be,{defaultValue:"routing",className:"w-full",children:[e.jsxs(Ge,{className:"grid w-full grid-cols-3",children:[e.jsx(se,{value:"routing",children:"Routing"}),e.jsx(se,{value:"resilience",children:"Resilience"}),e.jsx(se,{value:"advanced",children:"Advanced"})]}),e.jsx(ae,{value:"routing",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{htmlFor:"parallel",children:"Parallel Execution"}),e.jsx(dr,{id:"parallel",checked:j.parallel,onCheckedChange:m=>N({...j,parallel:m})})]}),e.jsx(cr,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Routing Condition"}),e.jsx(Rn,{conditionType:j.conditionType,routingCondition:j.routingCondition,onChange:(m,S)=>N({...j,routingCondition:m,conditionType:S})})]})]})}),e.jsx(ae,{value:"resilience",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"retryAttempts",children:"Retry Attempts"}),e.jsx(X,{id:"retryAttempts",type:"number",min:"0",max:"10",value:j.retryAttempts||0,onChange:m=>N({...j,retryAttempts:parseInt(m.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"retryDelayMs",children:"Retry Delay (ms)"}),e.jsx(X,{id:"retryDelayMs",type:"number",min:"0",value:j.retryDelayMs||1e3,onChange:m=>N({...j,retryDelayMs:parseInt(m.target.value)||1e3})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"timeoutMs",children:"Timeout (ms)"}),e.jsx(X,{id:"timeoutMs",type:"number",min:"1000",value:j.timeoutMs||3e4,onChange:m=>N({...j,timeoutMs:parseInt(m.target.value)||3e4})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"errorStrategy",children:"Error Strategy"}),e.jsxs("select",{id:"errorStrategy",className:"w-full p-2 border rounded-md",value:j.errorStrategy||"FAIL",onChange:m=>N({...j,errorStrategy:m.target.value}),children:[e.jsx("option",{value:"FAIL",children:"Fail Flow"}),e.jsx("option",{value:"CONTINUE",children:"Continue to Next"}),e.jsx("option",{value:"COMPENSATE",children:"Run Compensation"}),e.jsx("option",{value:"RETRY",children:"Retry with Backoff"})]})]})]})}),e.jsxs(ae,{value:"advanced",className:"space-y-4 mt-4",children:[e.jsxs(fe,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(Oe,{children:"Advanced settings for structure mappings and metadata."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"structureId",children:"Structure ID"}),e.jsx(X,{id:"structureId",value:j.structureId||"",onChange:m=>N({...j,structureId:m.target.value}),placeholder:"Optional: Override default structure"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"responseStructureId",children:"Response Structure ID"}),e.jsx(X,{id:"responseStructureId",value:j.responseStructureId||"",onChange:m=>N({...j,responseStructureId:m.target.value}),placeholder:"Optional: For synchronous targets"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(R,{variant:"outline",onClick:()=>N(null),children:"Cancel"}),e.jsx(R,{onClick:()=>w(j),children:"Save Changes"})]})]})]})})})]})})}class kn{static async validateStructure(t){return(await q.post("/structures/validate",t)).data}static async extractWsdlOperations(t){return(await q.post("/structures/wsdl/extract-operations",t)).data}}function or({initialContent:r="",onChange:t,onValidationComplete:s,autoValidate:a=!0,className:n,height:o="400px"}){const{toast:l}=Ie(),[d,T]=x.useState(r),[j]=pr(d,500),[N,D]=x.useState(!1),[g,y]=x.useState(null),[C,i]=x.useState({services:!0,portTypes:!0,messages:!1,namespaces:!1}),w=x.useCallback(async h=>{if(!h.trim()){y(null);return}D(!0);try{const f=await kn.validateStructure({content:h,structureType:"WSDL",strictMode:!1,extractMetadata:!0}),c={valid:f.valid,message:f.message,issues:f.issues||[],metadata:f.wsdlMetadata};y(c),t?.(h,f.valid),s?.(c)}catch(f){console.error("WSDL validation error:",f);const c={valid:!1,message:"Validation service error",issues:[{type:"ERROR",message:f instanceof Error?f.message:"Unknown error"}]};y(c),t?.(h,!1)}finally{D(!1)}},[t,s]);x.useEffect(()=>{a&&j.trim()&&w(j)},[j,a,w]);const v=x.useCallback(h=>{h!==void 0&&T(h)},[]),A=x.useCallback(()=>{w(d)},[d,w]),u=x.useCallback(h=>{i(f=>({...f,[h]:!f[h]}))},[]),m=h=>{switch(h){case"ERROR":return e.jsx(Me,{className:"h-4 w-4 text-destructive"});case"WARNING":return e.jsx($r,{className:"h-4 w-4 text-yellow-500"});case"INFO":return e.jsx(Fr,{className:"h-4 w-4 text-blue-500"})}},S=()=>g?{errors:g.issues.filter(h=>h.type==="ERROR").length,warnings:g.issues.filter(h=>h.type==="WARNING").length,infos:g.issues.filter(h=>h.type==="INFO").length}:{errors:0,warnings:0,infos:0},O=x.useCallback(()=>{if(!g)return;const h={timestamp:new Date().toISOString(),wsdl:{content:d,length:d.length},validation:g,exportedBy:"WSDL Validator"},f=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),c=URL.createObjectURL(f),p=document.createElement("a");p.href=c,p.download=`wsdl-validation-report-${Date.now()}.json`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(c),l({title:"Report Exported",description:"Validation report has been downloaded"})},[d,g,l]),L=x.useCallback((h,f)=>{navigator.clipboard.writeText(h).then(()=>{l({title:"Copied",description:`${f} copied to clipboard`})})},[l]);return e.jsx("div",{className:Y("space-y-4",n),children:e.jsxs($,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Z,{children:"WSDL Validator"}),e.jsx(ge,{children:"Real-time WSDL validation with syntax checking and metadata extraction"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsx(R,{size:"sm",onClick:A,disabled:N||!d.trim(),children:N?e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Validate"]})}),g&&e.jsxs(R,{size:"sm",variant:"outline",onClick:O,children:[e.jsx(It,{className:"mr-2 h-4 w-4"}),"Export Report"]})]})]})}),e.jsx(_,{className:"p-0",children:e.jsxs(Be,{defaultValue:"editor",className:"w-full",children:[e.jsxs(Ge,{className:"w-full justify-start rounded-none border-b px-4",children:[e.jsxs(se,{value:"editor",children:["Editor",g&&e.jsx(M,{variant:g.valid?"success":"destructive",className:"ml-2",children:g.valid?"Valid":"Invalid"})]}),e.jsxs(se,{value:"issues",children:["Issues",g&&g.issues.length>0&&e.jsx(M,{variant:"outline",className:"ml-2",children:g.issues.length})]}),e.jsx(se,{value:"metadata",disabled:!g?.metadata,children:"Metadata"})]}),e.jsx(ae,{value:"editor",className:"m-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Et,{height:o,defaultLanguage:"xml",value:d,onChange:v,theme:"vs-dark",options:{minimap:{enabled:!1},fontSize:12,formatOnPaste:!0,formatOnType:!0,automaticLayout:!0}}),g&&e.jsxs("div",{className:"absolute bottom-4 right-4 flex gap-2",children:[S().errors>0&&e.jsxs(M,{variant:"destructive",children:[S().errors," error(s)"]}),S().warnings>0&&e.jsxs(M,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[S().warnings," warning(s)"]}),S().infos>0&&e.jsxs(M,{variant:"secondary",children:[S().infos," info(s)"]})]})]})}),e.jsx(ae,{value:"issues",className:"m-0 p-4",children:g?g.issues.length===0?e.jsxs(fe,{className:"border-green-200 bg-green-50",children:[e.jsx(je,{className:"h-4 w-4 text-green-600"}),e.jsx(lr,{className:"text-green-800",children:"No issues found"}),e.jsx(Oe,{className:"text-green-700",children:"Your WSDL is valid and follows best practices."})]}):e.jsx(Ee,{className:"h-[350px]",children:e.jsx("div",{className:"space-y-2",children:g.issues.map((h,f)=>e.jsx(fe,{className:Y("py-2",h.type==="ERROR"&&"border-red-200 bg-red-50",h.type==="WARNING"&&"border-yellow-200 bg-yellow-50",h.type==="INFO"&&"border-blue-200 bg-blue-50"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[m(h.type),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:h.message}),(h.line||h.column)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Line ",h.line||"?",", Column ",h.column||"?"]})]})]})},f))})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No validation results yet"}),e.jsx("p",{className:"text-sm",children:"Enter WSDL content to see validation issues"})]})}),e.jsx(ae,{value:"metadata",className:"m-0 p-4",children:g?.metadata&&e.jsx(Ee,{className:"h-[350px]",children:e.jsxs("div",{className:"space-y-4",children:[g.metadata.targetNamespace&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Target Namespace"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded flex-1",children:g.metadata.targetNamespace}),e.jsx(R,{size:"icon",variant:"ghost",onClick:()=>L(g.metadata.targetNamespace,"Target namespace"),children:e.jsx(Rt,{className:"h-4 w-4"})})]})]}),g.metadata.services&&g.metadata.services.length>0&&e.jsxs(it,{open:C.services,onOpenChange:()=>u("services"),children:[e.jsxs(ot,{className:"flex items-center gap-2 font-medium cursor-pointer hover:text-primary",children:[C.services?e.jsx(st,{className:"h-4 w-4"}):e.jsx(at,{className:"h-4 w-4"}),e.jsx(De,{className:"h-4 w-4"}),"Services (",g.metadata.services.length,")"]}),e.jsx(ct,{className:"mt-2",children:e.jsx("div",{className:"space-y-2 pl-6",children:g.metadata.services.map((h,f)=>e.jsxs($,{className:"p-3",children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:h.name}),h.ports.map((c,p)=>e.jsxs("div",{className:"text-sm space-y-1 ml-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Port:"}),e.jsx("code",{className:"text-xs",children:c.name})]}),c.address&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Address:"}),e.jsx("code",{className:"text-xs",children:c.address})]})]},p))]},f))})})]}),g.metadata.portTypes&&g.metadata.portTypes.length>0&&e.jsxs(it,{open:C.portTypes,onOpenChange:()=>u("portTypes"),children:[e.jsxs(ot,{className:"flex items-center gap-2 font-medium cursor-pointer hover:text-primary",children:[C.portTypes?e.jsx(st,{className:"h-4 w-4"}):e.jsx(at,{className:"h-4 w-4"}),e.jsx(ke,{className:"h-4 w-4"}),"Port Types (",g.metadata.portTypes.length,")"]}),e.jsx(ct,{className:"mt-2",children:e.jsx("div",{className:"space-y-2 pl-6",children:g.metadata.portTypes.map((h,f)=>e.jsxs($,{className:"p-3",children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:h.name}),e.jsx("div",{className:"space-y-1 ml-4",children:h.operations.map((c,p)=>e.jsx("div",{className:"text-sm",children:e.jsx(M,{variant:"outline",className:"text-xs",children:c.name})},p))})]},f))})})]}),g.metadata.messages&&g.metadata.messages.length>0&&e.jsxs(it,{open:C.messages,onOpenChange:()=>u("messages"),children:[e.jsxs(ot,{className:"flex items-center gap-2 font-medium cursor-pointer hover:text-primary",children:[C.messages?e.jsx(st,{className:"h-4 w-4"}):e.jsx(at,{className:"h-4 w-4"}),e.jsx(He,{className:"h-4 w-4"}),"Messages (",g.metadata.messages.length,")"]}),e.jsx(ct,{className:"mt-2",children:e.jsx("div",{className:"space-y-2 pl-6",children:g.metadata.messages.map((h,f)=>e.jsxs($,{className:"p-3",children:[e.jsx("h5",{className:"font-medium text-sm",children:h.name}),h.parts.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[h.parts.length," part(s)"]})]},f))})})]})]})})})]})})]})})}const vt={basic:{name:"Basic Object",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",title:"Example Schema",description:"A basic JSON schema example",properties:{name:{type:"string",description:"The name of the item"},age:{type:"integer",minimum:0,description:"Age in years"}},required:["name"]}},api_response:{name:"API Response",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",title:"API Response Schema",properties:{success:{type:"boolean"},data:{type:"object",properties:{id:{type:"string"},timestamp:{type:"string",format:"date-time"}}},error:{type:["object","null"],properties:{code:{type:"string"},message:{type:"string"}}}},required:["success"]}},array_items:{name:"Array of Items",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"array",title:"Items List",items:{type:"object",properties:{id:{type:"string"},name:{type:"string"},quantity:{type:"integer",minimum:1}},required:["id","name"]}}}};function jt({initialContent:r="",onChange:t,onValidationComplete:s,autoValidate:a=!0,className:n,height:o="400px"}){const{toast:l}=Ie(),[d,T]=x.useState(r),[j]=pr(d,500),[N,D]=x.useState(!1),[g,y]=x.useState(null),[C,i]=x.useState(""),w=x.useRef(null),v=x.useRef(null),A=f=>{w.current=f,f.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{uri:"http://json-schema.org/draft-07/schema#",fileMatch:["*"],schema:{$ref:"http://json-schema.org/draft-07/schema#"}}]})},u=(f,c)=>{v.current=f,c.languages.registerCompletionItemProvider("json",{provideCompletionItems:(p,b)=>{const F=p.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:b.lineNumber,endColumn:b.column});return/"[^"]*"\s*:\s*{\s*$/.test(F)?{suggestions:[{label:"type",insertText:'"type": "${1:string}"',detail:"Defines the data type"},{label:"enum",insertText:'"enum": [${1}]',detail:"Restricts values to a fixed set"},{label:"const",insertText:'"const": ${1}',detail:"Requires exact value match"},{label:"minLength",insertText:'"minLength": ${1:1}',detail:"Minimum string length"},{label:"maxLength",insertText:'"maxLength": ${1:100}',detail:"Maximum string length"},{label:"pattern",insertText:'"pattern": "${1:^[a-zA-Z]+$}"',detail:"Regular expression pattern"},{label:"format",insertText:'"format": "${1:email}"',detail:"String format (email, date, etc.)"},{label:"minimum",insertText:'"minimum": ${1:0}',detail:"Minimum numeric value"},{label:"maximum",insertText:'"maximum": ${1:100}',detail:"Maximum numeric value"},{label:"exclusiveMinimum",insertText:'"exclusiveMinimum": ${1:0}',detail:"Exclusive minimum value"},{label:"exclusiveMaximum",insertText:'"exclusiveMaximum": ${1:100}',detail:"Exclusive maximum value"},{label:"multipleOf",insertText:'"multipleOf": ${1:1}',detail:"Value must be multiple of"},{label:"properties",insertText:`"properties": {
	\${1}
}`,detail:"Object properties schema"},{label:"required",insertText:'"required": [${1:"fieldName"}]',detail:"Required properties"},{label:"additionalProperties",insertText:'"additionalProperties": ${1:false}',detail:"Allow additional properties"},{label:"minProperties",insertText:'"minProperties": ${1:1}',detail:"Minimum number of properties"},{label:"maxProperties",insertText:'"maxProperties": ${1:10}',detail:"Maximum number of properties"},{label:"items",insertText:`"items": {
	\${1}
}`,detail:"Array items schema"},{label:"minItems",insertText:'"minItems": ${1:1}',detail:"Minimum array length"},{label:"maxItems",insertText:'"maxItems": ${1:10}',detail:"Maximum array length"},{label:"uniqueItems",insertText:'"uniqueItems": ${1:true}',detail:"Require unique array items"},{label:"description",insertText:'"description": "${1}"',detail:"Schema description"},{label:"default",insertText:'"default": ${1}',detail:"Default value"},{label:"examples",insertText:'"examples": [${1}]',detail:"Example values"},{label:"$ref",insertText:'"$ref": "${1:#/definitions/}"',detail:"Reference another schema"}].map((V,Ne)=>({label:V.label,kind:c.languages.CompletionItemKind.Property,insertText:V.insertText,insertTextRules:c.languages.CompletionItemInsertTextRule.InsertAsSnippet,detail:V.detail,sortText:String(Ne).padStart(3,"0")}))}:{suggestions:[]}}})},m=x.useCallback(f=>{if(!f.trim()){y(null);return}D(!0);const c=[];let p={},b=!1;try{const I=JSON.parse(f);b=!0,p={schema:I.$schema,title:I.title,description:I.description,type:I.type,properties:I.properties,required:I.required},I.$schema||c.push({type:"WARNING",message:'Missing $schema declaration. Consider adding "$schema": "http://json-schema.org/draft-07/schema#"'}),!I.type&&!I.$ref&&!I.oneOf&&!I.anyOf&&!I.allOf&&c.push({type:"WARNING",message:"Schema should define a type or use composition keywords (oneOf, anyOf, allOf)"}),I.type==="object"&&!I.properties&&c.push({type:"INFO",message:"Object type without properties definition"}),I.required&&!Array.isArray(I.required)&&(c.push({type:"ERROR",message:'"required" must be an array of property names'}),b=!1),I.properties&&Object.entries(I.properties).forEach(([z,V])=>{!V.type&&!V.$ref&&!V.oneOf&&!V.anyOf&&!V.allOf&&c.push({type:"WARNING",message:`Property "${z}" is missing a type definition`,path:`properties.${z}`})})}catch(I){if(b=!1,I instanceof SyntaxError){const z=I.message.match(/position (\d+)/),V=z?parseInt(z[1]):void 0;c.push({type:"ERROR",message:`JSON Syntax Error: ${I.message}`,column:V})}else c.push({type:"ERROR",message:I instanceof Error?I.message:"Unknown validation error"})}const F={valid:b,issues:c,metadata:p,message:b?"Valid JSON Schema":"Invalid JSON Schema"};y(F),t?.(f,b),s?.(F),D(!1)},[t,s]);x.useEffect(()=>{a&&j&&m(j)},[j,a,m]);const S=x.useCallback(f=>{f!==void 0&&T(f)},[]),O=x.useCallback(f=>{if(f&&vt[f]){const c=vt[f],p=JSON.stringify(c.schema,null,2);T(p),i(f),l({title:"Template Applied",description:`Applied ${c.name} template`})}},[l]),L=x.useCallback(()=>{const f=new Blob([d],{type:"application/json"}),c=URL.createObjectURL(f),p=document.createElement("a");p.href=c,p.download="schema.json",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(c),l({title:"Schema Exported",description:"JSON Schema has been downloaded"})},[d,l]),h=x.useCallback(()=>{navigator.clipboard.writeText(d).then(()=>{l({title:"Copied",description:"Schema copied to clipboard"})})},[d,l]);return e.jsx("div",{className:Y("space-y-4",n),children:e.jsxs($,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5"}),"JSON Schema Editor"]}),e.jsx(ge,{children:"Create and validate JSON schemas with intelligent autocomplete"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ue,{value:C,onValueChange:O,children:[e.jsx(pe,{className:"w-[180px]",children:e.jsx(he,{placeholder:"Select template"})}),e.jsxs(me,{children:[e.jsx(te,{value:"",children:"None"}),Object.entries(vt).map(([f,c])=>e.jsx(te,{value:f,children:c.name},f))]})]}),e.jsxs(R,{size:"sm",variant:"outline",onClick:h,children:[e.jsx(Rt,{className:"h-4 w-4 mr-2"}),"Copy"]}),e.jsxs(R,{size:"sm",variant:"outline",onClick:L,children:[e.jsx(It,{className:"h-4 w-4 mr-2"}),"Export"]}),!a&&e.jsx(R,{size:"sm",onClick:()=>m(d),disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Validate"]})})]})]})}),e.jsx(_,{className:"p-0",children:e.jsxs(Be,{defaultValue:"editor",className:"w-full",children:[e.jsxs(Ge,{className:"w-full justify-start rounded-none border-b px-4",children:[e.jsxs(se,{value:"editor",className:"gap-2",children:["Editor",g&&e.jsx(M,{variant:g.valid?"success":"destructive",children:g.valid?"Valid":"Invalid"})]}),e.jsx(se,{value:"preview",children:"Preview"}),e.jsxs(se,{value:"issues",children:["Issues",g&&g.issues.length>0&&e.jsx(M,{variant:"outline",children:g.issues.length})]})]}),e.jsx(ae,{value:"editor",className:"m-0",children:e.jsx(Et,{height:o,defaultLanguage:"json",value:d,onChange:S,theme:"vs-dark",beforeMount:A,onMount:u,options:{minimap:{enabled:!1},fontSize:13,formatOnPaste:!0,formatOnType:!0,automaticLayout:!0,suggestOnTriggerCharacters:!0,quickSuggestions:{other:!0,comments:!1,strings:!0},wordBasedSuggestions:!1}})}),e.jsx(ae,{value:"preview",className:"m-0 p-4",children:g?.metadata?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Schema Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[g.metadata.title&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Title:"})," ",e.jsx("span",{className:"font-medium",children:g.metadata.title})]}),g.metadata.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Description:"})," ",e.jsx("span",{children:g.metadata.description})]}),g.metadata.type&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",e.jsx(M,{variant:"secondary",children:g.metadata.type})]}),g.metadata.required&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Required fields:"})," ",g.metadata.required.map(f=>e.jsx(M,{variant:"outline",className:"ml-1",children:f},f))]})]})]}),g.metadata.properties&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Properties"}),e.jsx(Ee,{className:"h-[300px]",children:e.jsx("div",{className:"space-y-2",children:Object.entries(g.metadata.properties).map(([f,c])=>e.jsx($,{className:"p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:f}),c.type&&e.jsx(M,{variant:"secondary",className:"text-xs",children:c.type}),c.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:c.description})]}),g.metadata.required?.includes(f)&&e.jsx(M,{variant:"destructive",className:"ml-2",children:"Required"})]})},f))})})]})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(us,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Enter a valid JSON Schema to see the preview"})]})}),e.jsx(ae,{value:"issues",className:"m-0 p-4",children:g?g.issues.length===0?e.jsxs(fe,{className:"border-green-200 bg-green-50",children:[e.jsx(je,{className:"h-4 w-4 text-green-600"}),e.jsx(lr,{className:"text-green-800",children:"No issues found"}),e.jsx(Oe,{className:"text-green-700",children:"Your JSON Schema is valid and follows best practices."})]}):e.jsx(Ee,{className:"h-[350px]",children:e.jsx("div",{className:"space-y-2",children:g.issues.map((f,c)=>e.jsx(fe,{className:Y("py-2",f.type==="ERROR"&&"border-red-200 bg-red-50",f.type==="WARNING"&&"border-yellow-200 bg-yellow-50",f.type==="INFO"&&"border-blue-200 bg-blue-50"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[f.type==="ERROR"&&e.jsx(Me,{className:"h-4 w-4 text-destructive"}),f.type==="WARNING"&&e.jsx(ce,{className:"h-4 w-4 text-yellow-500"}),f.type==="INFO"&&e.jsx(ce,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:f.message}),f.path&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Path: ",f.path]})]})]})},c))})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No validation results yet"}),e.jsx("p",{className:"text-sm",children:"Enter JSON Schema content to see validation issues"})]})})]})})]})})}const yt=[{value:"FILE",label:"File"},{value:"FTP",label:"FTP"},{value:"SFTP",label:"SFTP"},{value:"HTTP",label:"HTTP"},{value:"REST",label:"REST"},{value:"SOAP",label:"SOAP"},{value:"IBMMQ",label:"IBM MQ"},{value:"JDBC",label:"JDBC"},{value:"IDOC",label:"IDoc"},{value:"ODATA",label:"OData"},{value:"MAIL",label:"Mail"},{value:"RFC",label:"RFC"}];function Mn({isOpen:r,onClose:t,onSuccess:s,existingPackage:a}){const{toast:n}=Ie(),[o,l]=x.useState("package-info");x.useState(!1);const[d,T]=x.useState(!1),[j,N]=x.useState(!1),[D,g]=x.useState(!1),[y,C]=x.useState(null),[i,w]=x.useState({packageName:"",packageDescription:"",transformationRequired:!0,syncType:"ASYNCHRONOUS",sourceNamespace:"",targetNamespace:"",flowType:"",inboundAdapterName:"",inboundAdapterType:"",inboundAdapterConfig:{},outboundAdapterName:"",outboundAdapterType:"",outboundAdapterConfig:{},flowName:"",flowDescription:"",orchestrationTargets:[]}),v=x.useCallback(()=>{const c=["package-info","flow-type-selection"];return i.flowType&&(i.flowType==="DIRECT_INTEGRATION"?(c.push("source-adapter"),i.inboundAdapterType==="SOAP"?c.push("source-flow-structure"):i.transformationRequired&&c.push("source-message-structure"),c.push("target-adapter"),i.outboundAdapterType==="SOAP"?c.push("target-flow-structure"):i.transformationRequired&&c.push("target-message-structure"),i.syncType==="SYNCHRONOUS"&&i.transformationRequired&&c.push("response-structure"),i.transformationRequired&&c.push("field-mapping")):i.flowType==="ORCHESTRATION"&&(c.push("source-adapter"),i.inboundAdapterType==="SOAP"?c.push("source-flow-structure"):i.transformationRequired&&c.push("source-message-structure"),c.push("orchestration-targets"),c.push("orchestration-structures"),i.transformationRequired&&c.push("orchestration-mappings")),c.push("integration-flow"),c.push("review")),c},[i]),A=()=>{const c=v(),p=c.indexOf(o);p<c.length-1&&l(c[p+1])},u=()=>{const c=v(),p=c.indexOf(o);p>0&&l(c[p-1])},m=()=>{const c=v();return{current:c.indexOf(o)+1,total:c.length}},S=async()=>{try{T(!0);const c={name:i.packageName,description:i.packageDescription,transformationRequired:i.transformationRequired,syncType:i.syncType,sourceNamespace:i.sourceNamespace,targetNamespace:i.targetNamespace},p=await ve.createPackage(c);let b;if(rs(p)){if(!p.success||!p.data)throw new Error("Failed to create package");b=p.data.id}else b=p.id;const F=await ut.createAdapter({name:i.inboundAdapterName,type:i.inboundAdapterType,mode:"INBOUND",configuration:i.inboundAdapterConfig,isActive:!0,packageId:b});if(!F.success||!F.data)throw new Error("Failed to create source adapter");let I;const z=[];if(i.flowType==="ORCHESTRATION")for(const k of i.orchestrationTargets||[]){const W=await ut.createAdapter({name:k.adapterName,type:k.adapterType,mode:"OUTBOUND",configuration:k.adapterConfig,isActive:!0,packageId:b});if(!W.success||!W.data)throw new Error(`Failed to create target adapter: ${k.adapterName}`);z.push(W.data.id),I||(I=W)}else if(I=await ut.createAdapter({name:i.outboundAdapterName,type:i.outboundAdapterType,mode:"OUTBOUND",configuration:i.outboundAdapterConfig,isActive:!0,packageId:b}),!I.success||!I.data)throw new Error("Failed to create target adapter");let V,Ne,Lt;if(i.inboundAdapterType==="SOAP"&&i.sourceFlowStructure){const k=await Se.createStructure({name:`${i.packageName}_Source_Flow`,type:"wsdl",content:i.sourceFlowStructure,packageId:b});k.success&&k.data&&(V=k.data.id)}else if(i.transformationRequired&&i.sourceMessageStructure){const k=await Se.createStructure({name:`${i.packageName}_Source_Message`,type:"json",content:i.sourceMessageStructure,packageId:b});k.success&&k.data&&(V=k.data.id)}const _t={};if(i.flowType==="ORCHESTRATION")for(let k=0;k<(i.orchestrationTargets?.length||0);k++){const W=i.orchestrationTargets[k],Le=z[k];if(W.structure){const rt=W.adapterType==="SOAP"?"wsdl":"json",we=await Se.createStructure({name:`${i.packageName}_${W.adapterName}_Structure`,type:rt,content:W.structure,packageId:b});we.success&&we.data&&(_t[Le]=we.data.id,k===0&&(Ne=we.data.id))}}else if(i.outboundAdapterType==="SOAP"&&i.targetFlowStructure){const k=await Se.createStructure({name:`${i.packageName}_Target_Flow`,type:"wsdl",content:i.targetFlowStructure,packageId:b});k.success&&k.data&&(Ne=k.data.id)}else if(i.transformationRequired&&i.targetMessageStructure){const k=await Se.createStructure({name:`${i.packageName}_Target_Message`,type:"json",content:i.targetMessageStructure,packageId:b});k.success&&k.data&&(Ne=k.data.id)}if(i.syncType==="SYNCHRONOUS"&&i.transformationRequired&&i.responseStructure){const k=await Se.createStructure({name:`${i.packageName}_Response`,type:"json",content:i.responseStructure,packageId:b});k.success&&k.data&&(Lt=k.data.id)}const Pr=i.flowType==="ORCHESTRATION"?"ORCHESTRATION":"DIRECT_MAPPING",et=await gs.createFlow({name:i.flowName,description:i.flowDescription,type:Pr,isActive:!0,inboundAdapterId:F.data.id,outboundAdapterId:I?.data?.id||"",sourceStructureId:V,targetStructureId:Ne,responseStructureId:Lt,packageId:b});if(!et.success||!et.data)throw new Error("Failed to create integration flow");const tt=et.data.id;if(i.flowType==="ORCHESTRATION")for(let k=0;k<i.orchestrationTargets.length;k++){const W=i.orchestrationTargets[k],Le=z[k],rt=_t[Le],we=await ne.addTarget(tt,{targetAdapterId:Le,executionOrder:k,parallel:!1,conditionType:"ALWAYS",structureId:rt,awaitResponse:!1,timeoutMs:3e4,retryPolicy:ne.getDefaultRetryPolicy(),errorStrategy:"FAIL_FLOW",active:!0,description:`Target adapter: ${W.adapterName}`});if(i.transformationRequired&&W.mapping&&W.mapping.length>0){const Ar=W.mapping.map((Q,qt)=>({sourceFieldPath:Q.sourcePaths?.[0]||Q.sourceFields?.[0]||"",targetFieldPath:Q.targetPath||Q.targetField||"",mappingType:Q.functionNode?"FUNCTION":"DIRECT",transformationExpression:Q.javaFunction||Q.functionNode?JSON.stringify(Q.functionNode):void 0,required:Q.required||!1,mappingOrder:qt,active:!0,description:Q.name||`Mapping ${qt+1}`,visualFlowData:Q.visualFlowData?JSON.stringify(Q.visualFlowData):void 0}));await fs.createMappings(tt,we.id,Ar)}}else i.transformationRequired&&i.fieldMappings&&i.fieldMappings.length>0&&await Yr.saveFieldMappings(tt,i.fieldMappings);n({title:"Success",description:"Package created successfully with all components"}),s()}catch(c){B.error(G.UI,"Error creating package",{error:c}),n({title:"Error",description:c instanceof Error?c.message:"Failed to create package",variant:"destructive"})}finally{T(!1)}},O=()=>{switch(o){case"package-info":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"packageName",children:"Package Name *"}),e.jsx(X,{id:"packageName",value:i.packageName,onChange:c=>w({...i,packageName:c.target.value}),placeholder:"Enter package name",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"packageDescription",children:"Description"}),e.jsx(de,{id:"packageDescription",value:i.packageDescription,onChange:c=>w({...i,packageDescription:c.target.value}),placeholder:"Enter package description",className:"mt-1",rows:3})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{children:"Transformation Required?"}),e.jsxs(nt,{value:i.transformationRequired.toString(),onValueChange:c=>w({...i,transformationRequired:c==="true"}),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{value:"true",id:"transform-yes"}),e.jsx(P,{htmlFor:"transform-yes",children:"Yes - Data transformation needed"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{value:"false",id:"transform-no"}),e.jsx(P,{htmlFor:"transform-no",children:"No - Pass through only"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{children:"Integration Type"}),e.jsxs(nt,{value:i.syncType,onValueChange:c=>w({...i,syncType:c}),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{value:"SYNCHRONOUS",id:"sync"}),e.jsx(P,{htmlFor:"sync",children:"Synchronous - Response required"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{value:"ASYNCHRONOUS",id:"async"}),e.jsx(P,{htmlFor:"async",children:"Asynchronous - Fire and forget"})]})]})]}),i.transformationRequired&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium",children:"Namespace Configuration"}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"sourceNamespace",children:"Source Namespace"}),e.jsx(X,{id:"sourceNamespace",value:i.sourceNamespace,onChange:c=>w({...i,sourceNamespace:c.target.value}),placeholder:"http://example.com/source",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"targetNamespace",children:"Target Namespace"}),e.jsx(X,{id:"targetNamespace",value:i.targetNamespace,onChange:c=>w({...i,targetNamespace:c.target.value}),placeholder:"http://example.com/target",className:"mt-1"})]})]})]})});case"flow-type-selection":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Select Flow Type"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose the type of integration flow for this package"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{children:"Flow Type *"}),e.jsxs(nt,{value:i.flowType,onValueChange:c=>w({...i,flowType:c}),children:[e.jsx($,{className:`cursor-pointer transition-all hover:shadow-md ${i.flowType==="DIRECT_INTEGRATION"?"ring-2 ring-primary shadow-md":""}`,children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(Te,{value:"DIRECT_INTEGRATION",id:"direct-integration",className:"mt-1"}),e.jsx("div",{className:"flex-1",children:e.jsxs(P,{htmlFor:"direct-integration",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ht,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-semibold text-lg",children:"Direct Integration Flow"})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:"Simple point-to-point integration with one source adapter, one target adapter, and optional field mapping"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(lt,{className:"w-3 h-3"}),e.jsx("span",{children:"1 Source"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),e.jsx("span",{children:"1 Target"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),e.jsx("span",{children:"1 Mapping"})]})]})]})})]})})}),e.jsx($,{className:`cursor-pointer transition-all hover:shadow-md ${i.flowType==="ORCHESTRATION"?"ring-2 ring-primary shadow-md":""}`,children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(Te,{value:"ORCHESTRATION",id:"orchestration",className:"mt-1"}),e.jsx("div",{className:"flex-1",children:e.jsxs(P,{htmlFor:"orchestration",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-semibold text-lg",children:"Orchestration Flow"})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:"Complex integration with one source adapter, multiple target adapters, and multiple field mappings"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(lt,{className:"w-3 h-3"}),e.jsx("span",{children:"1 Source"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),e.jsx("span",{children:"N Targets"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),e.jsx("span",{children:"N Mappings"})]})]})]})})]})})})]})]})]});case"source-adapter":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Source Adapter (Inbound)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This adapter receives data FROM external systems (outbound/receiver in traditional terms)"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"inboundAdapterName",children:"Adapter Name *"}),e.jsx(X,{id:"inboundAdapterName",value:i.inboundAdapterName,onChange:c=>w({...i,inboundAdapterName:c.target.value}),placeholder:"Enter source adapter name",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"inboundAdapterType",children:"Adapter Type *"}),e.jsxs(ue,{value:i.inboundAdapterType,onValueChange:c=>w({...i,inboundAdapterType:c}),children:[e.jsx(pe,{className:"mt-1",children:e.jsx(he,{placeholder:"Select adapter type"})}),e.jsx(me,{children:yt.map(c=>e.jsx(te,{value:c.value,children:c.label},c.value))})]}),i.inboundAdapterType==="SOAP"&&e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"ℹ️ SOAP adapter selected - Flow Structure (WSDL) will be required in the next step"})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Basic Configuration"}),e.jsx(de,{value:JSON.stringify(i.inboundAdapterConfig,null,2),onChange:c=>{try{const p=JSON.parse(c.target.value);w({...i,inboundAdapterConfig:p})}catch{}},placeholder:`{
 "endpoint": "http://example.com"
}`,className:"mt-1 font-mono text-sm",rows:6})]})]})]});case"source-flow-structure":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Source Flow Structure (WSDL)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define the WSDL structure for the SOAP source adapter"})]}),e.jsx(or,{initialContent:i.sourceFlowStructure||"",onChange:(c,p)=>{w({...i,sourceFlowStructure:c})},height:"500px",autoValidate:!0})]});case"source-message-structure":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Source Message Structure"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define the structure for incoming messages"})]}),e.jsx(jt,{initialContent:i.sourceMessageStructure||"",onChange:(c,p)=>{w({...i,sourceMessageStructure:c})},height:"500px",autoValidate:!0})]});case"target-adapter":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Target Adapter (Outbound)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This adapter sends data TO external systems (inbound/sender in traditional terms)"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"outboundAdapterName",children:"Adapter Name *"}),e.jsx(X,{id:"outboundAdapterName",value:i.outboundAdapterName,onChange:c=>w({...i,outboundAdapterName:c.target.value}),placeholder:"Enter target adapter name",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"outboundAdapterType",children:"Adapter Type *"}),e.jsxs(ue,{value:i.outboundAdapterType,onValueChange:c=>w({...i,outboundAdapterType:c}),children:[e.jsx(pe,{className:"mt-1",children:e.jsx(he,{placeholder:"Select adapter type"})}),e.jsx(me,{children:yt.map(c=>e.jsx(te,{value:c.value,children:c.label},c.value))})]}),i.outboundAdapterType==="SOAP"&&e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"ℹ️ SOAP adapter selected - Flow Structure (WSDL) will be required in the next step"})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Basic Configuration"}),e.jsx(de,{value:JSON.stringify(i.outboundAdapterConfig,null,2),onChange:c=>{try{const p=JSON.parse(c.target.value);w({...i,outboundAdapterConfig:p})}catch{}},placeholder:`{
 "endpoint": "http://example.com"
}`,className:"mt-1 font-mono text-sm",rows:6})]})]})]});case"target-flow-structure":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Target Flow Structure (WSDL)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define the WSDL structure for the SOAP target adapter"})]}),e.jsx(or,{initialContent:i.targetFlowStructure||"",onChange:(c,p)=>{w({...i,targetFlowStructure:c})},height:"500px",autoValidate:!0})]});case"target-message-structure":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Target Message Structure"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define the structure for outgoing messages"})]}),e.jsx(jt,{initialContent:i.targetMessageStructure||"",onChange:(c,p)=>{w({...i,targetMessageStructure:c})},height:"500px",autoValidate:!0})]});case"response-structure":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Response Structure"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define the structure for synchronous response messages"})]}),e.jsx(jt,{initialContent:i.responseStructure||"",onChange:(c,p)=>{w({...i,responseStructure:c})},height:"500px",autoValidate:!0})]});case"field-mapping":{const c=async()=>{try{N(!0);let p="",b="";i.inboundAdapterType==="SOAP"&&i.sourceFlowStructure?p=i.sourceFlowStructure:i.sourceMessageStructure&&(p=i.sourceMessageStructure),i.outboundAdapterType==="SOAP"&&i.targetFlowStructure?b=i.targetFlowStructure:i.targetMessageStructure&&(b=i.targetMessageStructure);const[F,I]=await Promise.all([_e(p,{rootElementName:"SourceMessage",includeXmlDeclaration:!0,prettyPrint:!0,convertPropertyNames:!0}),_e(b,{rootElementName:"TargetMessage",includeXmlDeclaration:!0,prettyPrint:!0,convertPropertyNames:!0})]);w({...i,sourceXml:F.xmlContent,targetXml:I.xmlContent}),g(!0)}catch(p){B.error(G.UI,"Error converting structures",{error:p}),n({title:"Conversion Failed",description:"Failed to convert structures for field mapping",variant:"destructive"})}finally{N(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Field Mapping"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Map fields between source and target structures for data transformation"})]}),i.fieldMappings&&i.fieldMappings.length>0?e.jsxs($,{children:[e.jsx(J,{children:e.jsx(Z,{className:"text-lg",children:"Current Mappings"})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.fieldMappings.length," field mapping(s) configured"]}),e.jsx(R,{variant:"outline",onClick:c,disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:"sm",className:"mr-2"}),"Preparing..."]}):"Edit Mappings"})]})})]}):e.jsx($,{children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(He,{className:"w-12 h-12 mx-auto text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"No Field Mappings Configured"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Click below to create field mappings between source and target"})]}),e.jsx(R,{onClick:c,disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:"sm",className:"mr-2"}),"Preparing..."]}):"Create Field Mappings"})]})})}),!i.transformationRequired&&e.jsxs(fe,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(Oe,{children:"Field mapping is only available when transformation is required. Go back to Package Information to enable transformation."})]})]})}case"orchestration-targets":{const c="temp-flow-"+Date.now(),p=yt.map((b,F)=>({id:`new-adapter-${b.value}-${F}`,name:`New ${b.label} Adapter`,type:b.value}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Target Adapters Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure multiple target adapters for orchestration flow with drag-and-drop reordering"})]}),e.jsx(An,{flowId:c,availableAdapters:p,onTargetsChange:b=>{const F=b.map(I=>({adapterName:I.adapterName||"",adapterType:I.adapterType||"",adapterConfig:{},structure:null,mapping:[]}));w({...i,orchestrationTargets:F})}})]})}case"orchestration-structures":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Target Structures Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define data structures for each target adapter"})]}),e.jsx("div",{className:"space-y-4",children:i.orchestrationTargets?.map((c,p)=>e.jsxs($,{children:[e.jsxs(J,{children:[e.jsx(Z,{className:"text-base",children:c.adapterName}),e.jsxs(ge,{children:["Configure structure for ",c.adapterType," adapter"]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:c.structure?e.jsxs(M,{variant:"outline",className:"text-green-600 border-green-600",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),"Structure Configured"]}):e.jsxs(M,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Pending Configuration"]})})]}),e.jsx(_,{children:c.adapterType==="SOAP"?e.jsxs("div",{children:[e.jsx(P,{htmlFor:`wsdl-${p}`,children:"WSDL Content"}),e.jsx(de,{id:`wsdl-${p}`,value:c.structure||"",onChange:b=>{const F=[...i.orchestrationTargets||[]];F[p]={...F[p],structure:b.target.value},w({...i,orchestrationTargets:F})},placeholder:"Paste WSDL content here...",className:"mt-1 font-mono text-sm",rows:8})]}):i.transformationRequired?e.jsxs("div",{children:[e.jsx(P,{htmlFor:`json-${p}`,children:"JSON Schema"}),e.jsx(de,{id:`json-${p}`,value:c.structure||"",onChange:b=>{const F=[...i.orchestrationTargets||[]];F[p]={...F[p],structure:b.target.value},w({...i,orchestrationTargets:F})},placeholder:`{
 "type": "object",
 "properties": {
 
 }
}`,className:"mt-1 font-mono text-sm",rows:8})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No structure needed for pass-through mode"})})]},p))})]});case"orchestration-mappings":{const c=async p=>{try{N(!0),C(p);const b=i.orchestrationTargets?.[p];if(!b)return;let F="";i.inboundAdapterType==="SOAP"&&i.sourceFlowStructure?F=i.sourceFlowStructure:i.sourceMessageStructure&&(F=i.sourceMessageStructure);const[I,z]=await Promise.all([_e(F,{rootElementName:"SourceMessage",includeXmlDeclaration:!0,prettyPrint:!0,convertPropertyNames:!0}),_e(b.structure||"",{rootElementName:"TargetMessage",includeXmlDeclaration:!0,prettyPrint:!0,convertPropertyNames:!0})]);w({...i,sourceXml:I.xmlContent,targetXml:z.xmlContent}),g(!0)}catch(b){B.error(G.UI,"Error converting structures",{error:b}),n({title:"Conversion Failed",description:"Failed to convert structures for field mapping",variant:"destructive"})}finally{N(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Field Mappings Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure field mappings for each target adapter"}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{children:"Configured"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),e.jsx("span",{children:"Pending"})]})]})]}),e.jsx("div",{className:"space-y-4",children:i.orchestrationTargets?.map((p,b)=>e.jsxs($,{children:[e.jsxs(J,{children:[e.jsxs(Z,{className:"text-base flex items-center justify-between",children:[e.jsx("span",{children:p.adapterName}),e.jsx("div",{className:`w-2 h-2 rounded-full ${p.mapping&&p.mapping.length>0?"bg-green-500":"bg-yellow-500"}`})]}),e.jsxs(ge,{children:["Field mapping from source to ",p.adapterType]})]}),e.jsx(_,{children:p.mapping&&p.mapping.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[p.mapping.length," mapping(s) configured"]}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>c(b),disabled:j,children:"Edit Mappings"})]}):e.jsx(R,{size:"sm",onClick:()=>c(b),disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:"sm",className:"mr-2"}),"Preparing..."]}):"Configure Mappings"})})]},b))}),D&&y!==null&&e.jsx("script",{dangerouslySetInnerHTML:{__html:"window.__selectedTargetIndex = "+y}})]})}case"integration-flow":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Integration Flow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define the integration flow that orchestrates the adapters and transformations"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"flowName",children:"Flow Name *"}),e.jsx(X,{id:"flowName",value:i.flowName,onChange:c=>w({...i,flowName:c.target.value}),placeholder:"Enter flow name",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"flowDescription",children:"Flow Description"}),e.jsx(de,{id:"flowDescription",value:i.flowDescription,onChange:c=>w({...i,flowDescription:c.target.value}),placeholder:"Describe what this flow does...",className:"mt-1",rows:4})]}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Flow Type:"})," ",i.flowType==="ORCHESTRATION"?"Orchestration":"Direct Integration"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Source Adapter:"})," ",i.inboundAdapterName," (",i.inboundAdapterType,")"]}),i.flowType==="DIRECT_INTEGRATION"?e.jsxs("p",{children:[e.jsx("strong",{children:"Target Adapter:"})," ",i.outboundAdapterName," (",i.outboundAdapterType,")"]}):e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Target Adapters:"})}),e.jsx("ul",{className:"ml-4 list-disc",children:i.orchestrationTargets?.map((c,p)=>e.jsxs("li",{children:[c.adapterName," (",c.adapterType,")"]},p))})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Transformation:"})," ",i.transformationRequired?"Enabled":"Disabled"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",i.syncType]})]})})]})]});case"review":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Ready to Create Package"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Review your configuration below. Click "Create Package" to proceed.'})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs($,{children:[e.jsx(J,{className:"pb-3",children:e.jsxs(Z,{className:"text-base flex items-center gap-2",children:[e.jsx(wt,{className:"w-4 h-4"}),"Package Details"]})}),e.jsx(_,{className:"space-y-2",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"}),e.jsx("span",{className:"font-medium",children:i.packageName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Description:"}),e.jsx("span",{className:"font-medium text-right max-w-[200px]",children:i.packageDescription||"None"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Flow Type:"}),e.jsx(M,{variant:i.flowType==="ORCHESTRATION"?"default":"secondary",children:i.flowType==="ORCHESTRATION"?"Orchestration":"Direct Integration"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Sync Type:"}),e.jsx("span",{className:"font-medium",children:i.syncType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Transformation:"}),e.jsx(M,{variant:i.transformationRequired?"default":"outline",children:i.transformationRequired?"Enabled":"Disabled"})]})]})})]}),e.jsxs($,{children:[e.jsx(J,{className:"pb-3",children:e.jsxs(Z,{className:"text-base flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Adapters Configuration"]})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"outline",children:[e.jsx(lt,{className:"w-3 h-3 mr-1"}),"Source"]}),e.jsxs("span",{className:"text-sm",children:[i.inboundAdapterName," (",i.inboundAdapterType,")"]})]}),i.flowType==="DIRECT_INTEGRATION"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"outline",children:[e.jsx(De,{className:"w-3 h-3 mr-1"}),"Target"]}),e.jsxs("span",{className:"text-sm",children:[i.outboundAdapterName," (",i.outboundAdapterType,")"]})]}):i.orchestrationTargets?.map((c,p)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"outline",children:[e.jsx(De,{className:"w-3 h-3 mr-1"}),"Target ",p+1]}),e.jsxs("span",{className:"text-sm",children:[c.adapterName," (",c.adapterType,")"]})]},p))]})})]})]}),e.jsxs($,{children:[e.jsx(J,{className:"pb-3",children:e.jsxs(Z,{className:"text-base flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"Configuration Status"]})}),e.jsx(_,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-sm",children:"Structures"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[i.inboundAdapterType==="SOAP"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Source Flow Structure (WSDL)"})]}),i.transformationRequired&&i.inboundAdapterType!=="SOAP"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Source Message Structure"})]}),i.flowType==="DIRECT_INTEGRATION"&&e.jsxs(e.Fragment,{children:[i.outboundAdapterType==="SOAP"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Target Flow Structure (WSDL)"})]}),i.transformationRequired&&i.outboundAdapterType!=="SOAP"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Target Message Structure"})]})]}),i.syncType==="SYNCHRONOUS"&&i.transformationRequired&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Response Structure"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-sm",children:"Mappings & Flow"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[i.flowType==="DIRECT_INTEGRATION"&&i.transformationRequired&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Field Mappings Configured"})]}),i.flowType==="ORCHESTRATION"&&i.orchestrationTargets?.map((c,p)=>e.jsxs("div",{className:"flex items-center gap-2",children:[c.mapping&&c.mapping.length>0?e.jsx(ie,{className:"w-4 h-4 text-green-600"}):e.jsx($e,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("span",{children:["Target ",p+1," Mappings"]})]},p)),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:["Integration Flow: ",i.flowName]})]})]})]})]})})]})]});default:return null}},L=c=>{switch(c){case"package-info":return e.jsx(wt,{className:"w-4 h-4"});case"flow-type-selection":return e.jsx(Ue,{className:"w-4 h-4"});case"source-adapter":return e.jsx(ss,{className:"w-4 h-4"});case"source-flow-structure":return e.jsx(ke,{className:"w-4 h-4"});case"source-message-structure":return e.jsx(He,{className:"w-4 h-4"});case"target-adapter":return e.jsx(Ut,{className:"w-4 h-4"});case"target-flow-structure":return e.jsx(ke,{className:"w-4 h-4"});case"target-message-structure":return e.jsx(He,{className:"w-4 h-4"});case"response-structure":return e.jsx(_r,{className:"w-4 h-4"});case"field-mapping":return e.jsx(Ae,{className:"w-4 h-4"});case"orchestration-targets":return e.jsx(Ut,{className:"w-4 h-4"});case"orchestration-structures":return e.jsx(ke,{className:"w-4 h-4"});case"orchestration-mappings":return e.jsx(Ae,{className:"w-4 h-4"});case"integration-flow":return e.jsx(Ue,{className:"w-4 h-4"});case"review":return e.jsx(je,{className:"w-4 h-4"})}},h=c=>{switch(c){case"package-info":return"Package Information";case"flow-type-selection":return"Flow Type";case"source-adapter":return"Source Adapter";case"source-flow-structure":return"Source Flow Structure";case"source-message-structure":return"Source Message Structure";case"target-adapter":return"Target Adapter";case"target-flow-structure":return"Target Flow Structure";case"target-message-structure":return"Target Message Structure";case"response-structure":return"Response Structure";case"field-mapping":return"Field Mapping";case"orchestration-targets":return"Target Adapters";case"orchestration-structures":return"Target Structures";case"orchestration-mappings":return"Target Mappings";case"integration-flow":return"Integration Flow";case"review":return"Review & Create"}};if(!r)return null;const f=m();return D&&i.sourceXml&&i.targetXml?e.jsxs("div",{className:"fixed inset-0 bg-background z-50 overflow-hidden",children:[e.jsx("div",{className:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsx("div",{className:"w-full px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>g(!1),className:"gap-2",children:[e.jsx(Wt,{className:"h-4 w-4"}),"Back to Package Creation"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight",children:["Field Mapping - ",i.packageName]}),e.jsxs("p",{className:"text-muted-foreground",children:["Map fields between ",i.inboundAdapterName," and ",i.outboundAdapterName]})]})]})})}),e.jsx(Zr,{onClose:()=>g(!1),onSave:c=>{if(i.flowType==="ORCHESTRATION"&&y!==null){const p=[...i.orchestrationTargets||[]];p[y]={...p[y],mapping:c},w({...i,orchestrationTargets:p}),n({title:"Mappings Saved",description:c.length+" mappings configured for "+p[y].adapterName+"."})}else w({...i,fieldMappings:c}),n({title:"Mappings Saved",description:c.length+" field mappings have been configured."});g(!1),C(null)},initialMappingName:(()=>{if(i.flowType==="ORCHESTRATION"&&y!==null){const c=i.orchestrationTargets?.[y];return i.packageName+" - "+(c?.adapterName||"Target")+" Mapping"}return i.packageName+" Mapping"})(),initialMappings:i.flowType==="ORCHESTRATION"&&y!==null?i.orchestrationTargets?.[y]?.mapping||[]:i.fieldMappings||[],inboundAdapterType:i.inboundAdapterType,outboundAdapterType:i.flowType==="ORCHESTRATION"&&y!==null?i.orchestrationTargets?.[y]?.adapterType||"":i.outboundAdapterType,sourceXml:i.sourceXml,targetXml:i.targetXml,preConverted:!0})]}):e.jsxs("div",{className:"fixed inset-0 bg-background z-50 overflow-hidden",children:[e.jsxs("div",{className:"h-16 border-b flex items-center justify-between px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Create Integration Package"}),e.jsxs(M,{variant:"outline",children:["Step ",f.current," of ",f.total]})]}),e.jsx(R,{variant:"ghost",size:"icon",onClick:t,children:e.jsx(Lr,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"h-[calc(100vh-4rem-5rem)] overflow-y-auto",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:v().map((c,p)=>{const b=o===c,F=v().indexOf(o)>p,I=b?"bg-primary text-primary-foreground":F?"bg-primary/20 text-primary":"bg-muted text-muted-foreground",z=b?"text-primary":"text-muted-foreground",V=F?"bg-primary/20":"bg-muted";return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full ${I}`,children:L(c)}),e.jsx("div",{className:"ml-2",children:e.jsx("p",{className:`text-sm font-medium ${z}`,children:h(c)})})]}),p<v().length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-4 ${V}`})]},c)})})}),e.jsx("div",{className:"animate-in fade-in-0 slide-in-from-right-4 duration-300",children:O()},o)]})}),e.jsxs("div",{className:"h-20 border-t flex items-center justify-between px-6",children:[e.jsxs(R,{variant:"outline",onClick:u,disabled:o==="package-info",children:[e.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{variant:"outline",onClick:t,children:"Cancel"}),o==="review"?e.jsx(R,{onClick:S,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:"sm",className:"mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Create Package"]})}):e.jsxs(R,{onClick:A,disabled:o==="package-info"&&!i.packageName||o==="flow-type-selection"&&!i.flowType||o==="source-adapter"&&(!i.inboundAdapterName||!i.inboundAdapterType)||o==="target-adapter"&&(!i.outboundAdapterName||!i.outboundAdapterType)||o==="orchestration-targets"&&(!i.orchestrationTargets||i.orchestrationTargets.length===0||i.orchestrationTargets.some(c=>!c.adapterName||!c.adapterType))||o==="integration-flow"&&!i.flowName,children:["Next",e.jsx(Ht,{className:"w-4 h-4 ml-2"})]})]})]})]})}function Fn(){const[r,t]=x.useState([]),[s,a]=x.useState(!0),[n,o]=x.useState(!1),[l,d]=x.useState(!1),[T,j]=x.useState(null),{toast:N}=Ie(),D=x.useCallback(async()=>{try{a(!0);const u=await ve.getAllPackages();u&&typeof u=="object"&&"success"in u&&u.success&&"data"in u&&u.data&&t(u.data.content||[])}catch(u){B.error(G.UI,"Error loading packages",{error:u}),N({title:"Error",description:"Failed to load packages",variant:"destructive"})}finally{a(!1)}},[N]);x.useEffect(()=>{D()},[D]);const g=async u=>{try{const m=await ve.validatePackage(u);m.isValid?N({title:"Package Valid",description:"The package passed all validation checks"}):N({title:"Validation Failed",description:m.errors.join(", "),variant:"destructive"})}catch(m){B.error(G.UI,"Error validating package",{error:m}),N({title:"Error",description:"Failed to validate package",variant:"destructive"})}},y=async u=>{try{const m=await ve.deployPackage(u,"DEVELOPMENT");m&&typeof m=="object"&&"success"in m&&m.success&&(N({title:"Deployment Started",description:"Package deployment has been initiated"}),await D())}catch(m){B.error(G.UI,"Error deploying package",{error:m}),N({title:"Error",description:"Failed to deploy package",variant:"destructive"})}},C=async u=>{if(confirm("Are you sure you want to delete this package?"))try{const m=await ve.deletePackage(u);m&&typeof m=="object"&&"success"in m&&m.success&&(N({title:"Success",description:"Package deleted successfully"}),await D())}catch(m){B.error(G.UI,"Error deleting package",{error:m}),N({title:"Error",description:"Failed to delete package",variant:"destructive"})}},i=async u=>{try{await ve.exportPackage(u),N({title:"Success",description:"Package exported successfully"})}catch(m){B.error(G.UI,"Error exporting package",{error:m}),N({title:"Error",description:"Failed to export package",variant:"destructive"})}},w=async u=>{try{const m=await ve.importPackage(u);m&&typeof m=="object"&&"success"in m&&m.success&&(N({title:"Success",description:"Package imported successfully"}),d(!1),await D())}catch(m){B.error(G.UI,"Error importing package",{error:m}),N({title:"Error",description:m instanceof Error?m.message:"Failed to import package",variant:"destructive"})}},v=u=>{const S={DRAFT:{variant:"secondary",label:"Draft"},CONFIGURED:{variant:"default",label:"Configured"},DEPLOYED:{variant:"default",label:"Deployed"},INACTIVE:{variant:"outline",label:"Inactive"}}[u];return e.jsx(M,{variant:S.variant,children:S.label})},A=u=>e.jsx(M,{variant:"outline",children:u==="SYNCHRONOUS"?"Sync":"Async"});return s?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Ce,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Integration Packages"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage integration packages with all their components in one place"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsxs(R,{variant:"outline",onClick:()=>d(!0),children:[e.jsx(hr,{className:"mr-2 h-4 w-4"}),"Import"]}),e.jsxs(R,{onClick:()=>o(!0),children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Create Package"]})]})]}),e.jsxs($,{children:[e.jsxs(J,{children:[e.jsx(Z,{children:"Packages"}),e.jsx(ge,{children:"View and manage all integration packages"})]}),e.jsx(_,{children:e.jsxs(as,{children:[e.jsx(ns,{children:e.jsxs(dt,{children:[e.jsx(le,{children:"Name"}),e.jsx(le,{children:"Description"}),e.jsx(le,{children:"Type"}),e.jsx(le,{children:"Transformation"}),e.jsx(le,{children:"Status"}),e.jsx(le,{children:"Components"}),e.jsx(le,{children:"Created"}),e.jsx(le,{className:"text-right",children:"Actions"})]})}),e.jsx(is,{children:r.length===0?e.jsx(dt,{children:e.jsxs(oe,{colSpan:8,className:"text-center py-8",children:[e.jsx(wt,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No packages found"}),e.jsx(R,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>o(!0),children:"Create your first package"})]})}):r.map(u=>e.jsxs(dt,{children:[e.jsx(oe,{className:"font-medium",children:u.name}),e.jsx(oe,{className:"max-w-xs truncate",children:u.description||"-"}),e.jsx(oe,{children:A(u.syncType)}),e.jsx(oe,{children:u.transformationRequired?e.jsx(M,{variant:"default",children:"Required"}):e.jsx(M,{variant:"secondary",children:"Not Required"})}),e.jsx(oe,{children:v(u.status)}),e.jsx(oe,{children:e.jsxs(M,{variant:"outline",children:[u.componentCount||0," components"]})}),e.jsx(oe,{children:new Date(u.createdAt).toLocaleDateString()}),e.jsx(oe,{className:"text-right",children:e.jsxs(qr,{children:[e.jsx(Hr,{asChild:!0,children:e.jsxs(R,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(os,{className:"h-4 w-4"})]})}),e.jsxs(Ur,{align:"end",children:[e.jsx(Vr,{children:"Actions"}),e.jsxs(Pe,{onClick:()=>{j(u),o(!0)},children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(Pe,{onClick:()=>g(u.id),children:[e.jsx(zr,{className:"mr-2 h-4 w-4"}),"Validate"]}),e.jsxs(Pe,{onClick:()=>y(u.id),disabled:u.status==="DEPLOYED",children:[e.jsx(ur,{className:"mr-2 h-4 w-4"}),"Deploy"]}),e.jsx(Vt,{}),e.jsxs(Pe,{onClick:()=>i(u.id),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Export"]}),e.jsx(Vt,{}),e.jsxs(Pe,{onClick:()=>C(u.id),className:"text-destructive",disabled:u.status==="DEPLOYED",children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},u.id))})]})})]}),n&&e.jsx(Mn,{isOpen:n,onClose:()=>{o(!1),j(null)},onSuccess:()=>{o(!1),j(null),D()},existingPackage:T}),l&&e.jsx($n,{isOpen:l,onClose:()=>d(!1),onImport:w})]})}function $n({isOpen:r,onClose:t,onImport:s}){const[a,n]=x.useState(null),[o,l]=x.useState(!1),d=async()=>{if(a){l(!0);try{await s(a),n(null)}finally{l(!1)}}};return e.jsx(Wr,{open:r,onOpenChange:t,children:e.jsxs(Br,{children:[e.jsx(Gr,{children:e.jsx(Xr,{children:"Import Package"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"file",children:"Select Package File"}),e.jsx(X,{id:"file",type:"file",accept:".json",onChange:T=>n(T.target.files?.[0]||null),disabled:o}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a JSON file exported from another package"})]}),a&&e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Selected file:"})," ",a.name]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Size: ",(a.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(R,{variant:"outline",onClick:t,disabled:o,children:"Cancel"}),e.jsx(R,{onClick:d,disabled:!a||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:"sm",className:"mr-2"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"mr-2 h-4 w-4"}),"Import Package"]})})]})]})})}function wi(){return e.jsx(Fn,{})}export{wi as Packages};
