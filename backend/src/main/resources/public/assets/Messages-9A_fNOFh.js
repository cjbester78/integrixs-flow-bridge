import{j as e}from"./ui-vendor-B4gDKxp2.js";import{r as j}from"./react-vendor-pDgKdaAw.js";import{w as E,a as A,l as c,L as d,F as P,o as C,p as k,D,r as L,q as F,S as B,h as W,i as z,j as _,k as g,y as q,u as X,C as G,t as J,T as K,v as R,B as H,a9 as Q,aa as Z,R as V,a6 as ee,U as se,s as te,g as ae,M as re}from"./index-j6L12q1O.js";import{u as ne,a as ie,P as oe}from"./useMetaDescription-zJPAZaDV.js";import{P as ce}from"./PageHeader-BNV6VWD3.js";import{u as de}from"./useBusinessComponentAdapters-BJDCMe7s.js";import{E as le}from"./empty-state-D2xduzt4.js";import{C as me,a as ge,b as ue}from"./collapsible-DsUrm4CU.js";import{F as Y}from"./file-text-BbOOV-Ct.js";import{D as he}from"./database-XpsIHb-R.js";import"./chart-vendor-A7Ge_5Hb.js";import"./businessComponentService-DQG-cBFt.js";import"./structureService-DHD3fE3P.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=E("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=E("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);class fe{websocket=null;reconnectAttempts=0;maxReconnectAttempts=5;reconnectInterval=3e3;messageListeners=[];statsListeners=[];async getMessages(a){const t=new URLSearchParams;a&&Object.entries(a).forEach(([r,n])=>{n!==void 0&&(Array.isArray(n)?t.append(r,n.join(",")):t.append(r,n.toString()))});const l=`/messages${t.toString()?`?${t.toString()}`:""}`;return A.get(l)}async getMessage(a){return A.get(`/messages/${a}`)}async getMessageStats(a){const t=new URLSearchParams;a&&Object.entries(a).forEach(([r,n])=>{n!==void 0&&(Array.isArray(n)?t.append(r,n.join(",")):t.append(r,n.toString()))});const l=`/messages/stats${t.toString()?`?${t.toString()}`:""}`;return A.get(l)}async reprocessMessage(a){return A.post(`/messages/${a}/reprocess`)}async getBusinessComponentMessages(a,t){const l=new URLSearchParams;t&&Object.entries(t).forEach(([n,m])=>{m!==void 0&&(Array.isArray(m)?l.append(n,m.join(",")):l.append(n,m.toString()))});const r=`/business-components/${a}/messages${l.toString()?`?${l.toString()}`:""}`;return A.get(r)}connectWebSocket(a,t){if(this.websocket?.readyState===WebSocket.OPEN)return;const l=window.location.protocol==="https:"?"wss:":"ws:",r=window.location.hostname,n=window.location.port||"8080",m=new URLSearchParams;a&&m.append("businessComponentId",a),t&&Object.entries(t).forEach(([x,p])=>{p!=null&&m.append(x,String(p))});const o=m.toString(),u=`${`${l}//${r}:${n}`}/ws/messages${o?`?${o}`:""}`;try{this.websocket=new WebSocket(u),this.websocket.onopen=()=>{c.info(d.API,"WebSocket connected for message monitoring"),this.reconnectAttempts=0},this.websocket.onmessage=x=>{try{const p=JSON.parse(x.data);p.type==="message_update"?this.messageListeners.forEach(S=>S(p.message)):p.type==="stats_update"&&this.statsListeners.forEach(S=>S(p.stats))}catch(p){c.error(d.API,"Error parsing WebSocket message",{error:p})}},this.websocket.onclose=()=>{c.info(d.API,"WebSocket connection closed"),this.attemptReconnect(a,t)},this.websocket.onerror=x=>{c.error(d.API,"WebSocket error",{error:x})}}catch(x){c.error(d.API,"Failed to create WebSocket connection",{error:x})}}attemptReconnect(a,t){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,c.info(d.API,`Attempting to reconnect WebSocket (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connectWebSocket(a,t)},this.reconnectInterval*this.reconnectAttempts)):c.error(d.API,"Max reconnection attempts reached")}disconnectWebSocket(){this.websocket&&(this.websocket.close(),this.websocket=null),this.messageListeners=[],this.statsListeners=[],this.reconnectAttempts=0}onMessageUpdate(a){return this.messageListeners.push(a),()=>{const t=this.messageListeners.indexOf(a);t>-1&&this.messageListeners.splice(t,1)}}onStatsUpdate(a){return this.statsListeners.push(a),()=>{const t=this.statsListeners.indexOf(a);t>-1&&this.statsListeners.splice(t,1)}}sendCommand(a,t){this.websocket?.readyState===WebSocket.OPEN&&this.websocket.send(JSON.stringify({command:a,data:t}))}}const T=new fe,ye=s=>{const[a,t]=j.useState([]),[l,r]=j.useState(null),[n,m]=j.useState(!1),[o,h]=j.useState(!1),[u,x]=j.useState(),{toast:p}=P(),S=j.useCallback(async f=>{m(!0),x(f);try{const i=s?await T.getBusinessComponentMessages(s,f):await T.getMessages(f);i.success&&i.data?(c.info(d.BUSINESS_LOGIC,"[useMessageMonitoring] Messages data:",{data:i.data.messages}),i.data.messages&&i.data.messages.length>0&&(c.info(d.BUSINESS_LOGIC,"[useMessageMonitoring] First message:",{data:i.data.messages[0]}),c.info(d.BUSINESS_LOGIC,"[useMessageMonitoring] First message timestamp:",{data:i.data.messages[0].timestamp}),c.info(d.BUSINESS_LOGIC,"[useMessageMonitoring] Timestamp type:",{data:typeof i.data.messages[0].timestamp})),t(i.data.messages||[])):t([])}catch{p({title:"Error",description:"Failed to load messages",variant:"destructive"})}finally{m(!1)}},[s,p]),w=j.useCallback(async f=>{try{const i=s?{...f,source:s}:f,y=await T.getMessageStats(i);y.success&&y.data&&r(y.data)}catch(i){c.error(d.BUSINESS_LOGIC,"Failed to load message stats",{error:i})}},[s]);j.useEffect(()=>{const f={businessComponentId:s,...u&&{flowId:u.flowId,status:u.status,startDate:u.startDate,endDate:u.endDate}};T.connectWebSocket(s,f),h(!0);const i=T.onMessageUpdate(v=>{t(N=>{const O=N.findIndex($=>$.id===v.id);if(O>=0){const $=[...N];return $[O]=v,$}else return[v,...N]}),v.status==="failed"&&p({title:"Message Failed",description:`Message ${v.id} failed processing`,variant:"destructive"})}),y=T.onStatsUpdate(v=>{r(v)});return()=>{i(),y(),T.disconnectWebSocket(),h(!1)}},[s,S,w,p,u]);const I=j.useCallback(async f=>{try{const i=await T.reprocessMessage(f);if(i.success)p({title:"Success",description:"Message queued for reprocessing"});else throw new Error(i.error||"Failed to reprocess message")}catch{p({title:"Error",description:"Failed to reprocess message",variant:"destructive"})}},[p]),b=j.useCallback(f=>{S(f),w(f)},[S,w]),M=j.useCallback(f=>{T.sendCommand("subscribe",{messageType:f})},[]),U=j.useCallback(f=>{T.sendCommand("unsubscribe",{messageType:f})},[]);return{messages:a,stats:l,loading:n,connected:o,loadMessages:S,loadStats:w,reprocessMessage:I,refreshData:b,subscribeToMessageType:M,unsubscribeFromMessageType:U}},je=({messages:s,stats:a,isBusinessComponentSelected:t,onStatusFilter:l,statusFilter:r,loading:n=!1})=>{const m=s||[],o=a?.successful??m.filter(b=>b.status==="success").length,h=a?.processing??m.filter(b=>b.status==="processing").length,u=a?.failed??m.filter(b=>b.status==="failed").length,x=a?.total??m.length,p=a?.successRate??(x>0?o/x*100:0),S=a?.avgProcessingTime??(()=>{const b=m.filter(M=>M.status!=="processing"&&M.processingTime!=="-");return b.length>0?Math.round(b.reduce((M,U)=>{const f=parseFloat(U.processingTime.replace(/[^\d.]/g,""));return M+(isNaN(f)?0:f)},0)/b.length):0})(),w=()=>t?`of ${x} business component messages`:"across all messages",I=b=>{l&&l(b)};return n?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Array.from({length:5}).map((b,M)=>e.jsxs(C,{className:"bg-gradient-secondary border-border/50",children:[e.jsx(k,{className:"pb-2",children:e.jsx(D,{className:"h-4 w-32"})}),e.jsxs(L,{children:[e.jsx(D,{className:"h-8 w-16 mb-2"}),e.jsx(D,{className:"h-3 w-24"})]})]},M))}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs(C,{className:`bg-gradient-secondary border-border/50 cursor-pointer transition-all hover-scale animate-scale-in ${r==="success"?"ring-2 ring-success":""}`,onClick:()=>I("success"),children:[e.jsx(k,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Successful Messages"})}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:String(o)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w()})]})]}),e.jsxs(C,{className:`bg-gradient-secondary border-border/50 cursor-pointer transition-all hover-scale animate-scale-in ${r==="processing"?"ring-2 ring-warning":""}`,onClick:()=>I("processing"),children:[e.jsx(k,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Processing Messages"})}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:String(h)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w()})]})]}),e.jsxs(C,{className:`bg-gradient-secondary border-border/50 cursor-pointer transition-all hover-scale animate-scale-in ${r==="failed"?"ring-2 ring-destructive":""}`,onClick:()=>I("failed"),children:[e.jsx(k,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Failed Messages"})}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold text-destructive",children:String(u)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w()})]})]}),e.jsxs(C,{className:"bg-gradient-secondary border-border/50 animate-scale-in",children:[e.jsx(k,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Success Rate"})}),e.jsxs(L,{children:[e.jsxs("div",{className:"text-2xl font-bold text-success",children:[p?p.toFixed(1):"0","%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w()})]})]}),e.jsxs(C,{className:"bg-gradient-secondary border-border/50 animate-scale-in",children:[e.jsx(k,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Avg Processing"})}),e.jsxs(L,{children:[e.jsxs("div",{className:"text-2xl font-bold text-info",children:[String(S),"ms"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w()})]})]})]})},Se=(s,a)=>{if(!s||!Array.isArray(s))return[];const t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate());switch(a){case"today":return s.filter(r=>new Date(r.timestamp)>=l);case"yesterday":{const r=new Date(l.getTime()-864e5);return s.filter(n=>{const m=new Date(n.timestamp);return m>=r&&m<l})}case"last-7-days":{const r=new Date(t.getTime()-6048e5);return s.filter(n=>new Date(n.timestamp)>=r)}case"last-30-days":{const r=new Date(t.getTime()-2592e6);return s.filter(n=>new Date(n.timestamp)>=r)}case"all":default:return s}},be=(s,a)=>s==="today"?`${a} messages today`:s==="yesterday"?`${a} messages yesterday`:s==="last-7-days"?`${a} messages in last 7 days`:s==="last-30-days"?`${a} messages in last 30 days`:`${a} messages total`,Ne=({value:s,onValueChange:a})=>e.jsxs(B,{value:s,onValueChange:a,children:[e.jsx(W,{className:"w-48",children:e.jsx(z,{})}),e.jsxs(_,{children:[e.jsx(g,{value:"today",children:"Today"}),e.jsx(g,{value:"today-00",children:"Today 00:00 - 00:59"}),e.jsx(g,{value:"today-01",children:"Today 01:00 - 01:59"}),e.jsx(g,{value:"today-02",children:"Today 02:00 - 02:59"}),e.jsx(g,{value:"today-03",children:"Today 03:00 - 03:59"}),e.jsx(g,{value:"today-04",children:"Today 04:00 - 04:59"}),e.jsx(g,{value:"today-05",children:"Today 05:00 - 05:59"}),e.jsx(g,{value:"today-06",children:"Today 06:00 - 06:59"}),e.jsx(g,{value:"today-07",children:"Today 07:00 - 07:59"}),e.jsx(g,{value:"today-08",children:"Today 08:00 - 08:59"}),e.jsx(g,{value:"today-09",children:"Today 09:00 - 09:59"}),e.jsx(g,{value:"today-10",children:"Today 10:00 - 10:59"}),e.jsx(g,{value:"today-11",children:"Today 11:00 - 11:59"}),e.jsx(g,{value:"today-12",children:"Today 12:00 - 12:59"}),e.jsx(g,{value:"today-13",children:"Today 13:00 - 13:59"}),e.jsx(g,{value:"today-14",children:"Today 14:00 - 14:59"}),e.jsx(g,{value:"today-15",children:"Today 15:00 - 15:59"}),e.jsx(g,{value:"today-16",children:"Today 16:00 - 16:59"}),e.jsx(g,{value:"today-17",children:"Today 17:00 - 17:59"}),e.jsx(g,{value:"today-18",children:"Today 18:00 - 18:59"}),e.jsx(g,{value:"today-19",children:"Today 19:00 - 19:59"}),e.jsx(g,{value:"today-20",children:"Today 20:00 - 20:59"}),e.jsx(g,{value:"today-21",children:"Today 21:00 - 21:59"}),e.jsx(g,{value:"today-22",children:"Today 22:00 - 22:59"}),e.jsx(g,{value:"today-23",children:"Today 23:00 - 23:59"}),e.jsx(g,{value:"yesterday",children:"Yesterday"}),e.jsx(g,{value:"last-7-days",children:"Past 7 Days"}),e.jsx(g,{value:"last-30-days",children:"Past 30 Days"}),e.jsx(g,{value:"all",children:"All Messages"})]})]}),ve=s=>{switch(s){case"success":return e.jsx(J,{className:"h-4 w-4 text-success"});case"failed":return e.jsx(G,{className:"h-4 w-4 text-destructive"});case"processing":return e.jsx(X,{className:"h-4 w-4 text-warning animate-spin"});default:return e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})}},we=s=>{switch(String(s||"INFO").toUpperCase()){case"SUCCESS":return e.jsx(J,{className:"h-3 w-3 text-success"});case"ERROR":return e.jsx(G,{className:"h-3 w-3 text-destructive"});case"WARN":return e.jsx(K,{className:"h-3 w-3 text-warning"});default:return e.jsx(q,{className:"h-3 w-3 text-info"})}},Me=({message:s})=>{const[a,t]=j.useState(!1),[l,r]=j.useState(!1),{toast:n}=P();c.debug(d.UI,"[MessageCard] Rendering message",{messageId:s.id,hasLogs:!!s.logs,logsCount:s.logs?.length||0});const m=async o=>{o.stopPropagation(),r(!0);try{const h=await ee.post(`/messages/${s.id}/reprocess`);n(h?{title:"Success",description:"Message reprocessing initiated"}:{title:"Error",description:(h&&typeof h=="object"&&"error"in h?h.error:void 0)||"Failed to reprocess message",variant:"destructive"})}catch{n({title:"Error",description:"Failed to reprocess message",variant:"destructive"})}finally{r(!1)}};return e.jsx(C,{className:"bg-gradient-secondary border-border/50 hover-scale",children:e.jsxs(me,{open:a,onOpenChange:t,children:[e.jsx(ge,{asChild:!0,children:e.jsx(R,{variant:"ghost",className:"w-full p-0 h-auto hover:bg-transparent",children:e.jsx(k,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ve(s.status),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.id}),e.jsx(H,{variant:"outline",className:"text-xs",children:s.type})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.source," → ",s.target]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-right",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:(()=>{if(typeof s.timestamp=="string")return s.timestamp;if(s.timestamp&&typeof s.timestamp=="object")try{if(Array.isArray(s.timestamp)){const[o,h,u,x,p,S]=s.timestamp;return`${o}-${String(h).padStart(2,"0")}-${String(u).padStart(2,"0")} ${String(x).padStart(2,"0")}:${String(p).padStart(2,"0")}:${String(S).padStart(2,"0")}`}return JSON.stringify(s.timestamp)}catch(o){return c.error(d.UI,"Error formatting timestamp:",{data:s.timestamp,extra:o}),"Invalid timestamp"}return"Unknown time"})()}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.processingTime," • ",s.size]})]}),a?e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]})]})})})}),e.jsx(ue,{children:e.jsx(L,{className:"pt-0",children:e.jsxs("div",{className:"border-t border-border/50 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Processing Steps (",s.logs?s.logs.length:0,")"]}),s.status==="failed"&&e.jsxs(R,{size:"sm",variant:"outline",onClick:m,disabled:l,children:[e.jsx(V,{className:`h-4 w-4 mr-2 ${l?"animate-spin":""}`}),l?"Reprocessing...":"Retry Message"]})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.logs&&s.logs.length>0?s.logs.map((o,h)=>(c.debug(d.UI,"[MessageCard] Rendering log",{index:h,logLevel:o.level}),e.jsxs("div",{className:"flex items-start gap-3 text-xs",children:[we(o.level),e.jsx("span",{className:"text-muted-foreground min-w-[120px] font-mono",children:(()=>{try{return o.timestamp?typeof o.timestamp=="string"?o.timestamp.includes(" ")?o.timestamp.split(" ")[1]:o.timestamp.includes("T")?new Date(o.timestamp).toLocaleTimeString():o.timestamp:typeof o.timestamp=="object"&&o.timestamp!==null&&o.timestamp instanceof Date?o.timestamp.toLocaleTimeString():o.timestamp&&typeof o.timestamp=="object"?JSON.stringify(o.timestamp):"Invalid timestamp":"No timestamp"}catch(u){return c.error(d.UI,"Error formatting log timestamp:",{data:o.timestamp,extra:u}),"Invalid timestamp"}})()}),e.jsx("span",{className:"text-foreground",children:String(o.message||"")})]},h))):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No processing steps available"})})]})})})]})})},Te=({messages:s,isBusinessComponentSelected:a,statusFilter:t,loading:l=!1,onTimeFilterChange:r})=>{const[n,m]=j.useState("today"),o=u=>{m(u),r?.(u)};c.info(d.UI,"[MessageList] Received messages:",{data:s}),c.info(d.UI,"[MessageList] Messages type:",{data:typeof s}),c.info(d.UI,"[MessageList] Is array:",{data:Array.isArray(s)}),s&&s.length>0&&(c.info(d.UI,"[MessageList] First message:",{data:s[0]}),c.info(d.UI,"[MessageList] First message keys:",{data:Object.keys(s[0])}),c.info(d.UI,"[MessageList] First message logs:",{data:s[0].logs}),s[0].logs&&s[0].logs.length>0&&(c.info(d.UI,"[MessageList] First log entry:",{data:s[0].logs[0]}),c.info(d.UI,"[MessageList] First log type:",{data:typeof s[0].logs[0]}),c.info(d.UI,"[MessageList] First log keys:",{data:Object.keys(s[0].logs[0])}),c.info(d.UI,"[MessageList] Log timestamp:",{data:s[0].logs[0].timestamp}),c.info(d.UI,"[MessageList] Log timestamp type:",{data:typeof s[0].logs[0].timestamp}),c.info(d.UI,"[MessageList] Log level:",{data:s[0].logs[0].level}),c.info(d.UI,"[MessageList] Log message:",{data:s[0].logs[0].message})));let h=Se(s||[],n);return t&&(h=h.filter(u=>u.status===t)),h.sort((u,x)=>new Date(x.timestamp).getTime()-new Date(u.timestamp).getTime()),c.info(d.UI,"[MessageList] Filtered messages:",{data:h}),c.info(d.UI,"[MessageList] Filtered messages length:",{data:h.length}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{className:"bg-gradient-secondary border-border/50",children:e.jsxs(k,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(F,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Message History"]}),e.jsx(Ne,{value:n,onValueChange:o})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:be(n,h.length)})]})}),e.jsx("div",{className:"space-y-3",children:l?Array.from({length:5}).map((u,x)=>e.jsx(C,{className:"bg-gradient-secondary border-border/50",children:e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"h-6 w-6 rounded-full"}),e.jsxs("div",{children:[e.jsx(D,{className:"h-4 w-32 mb-2"}),e.jsx(D,{className:"h-3 w-48"})]})]}),e.jsxs("div",{children:[e.jsx(D,{className:"h-3 w-24 mb-1"}),e.jsx(D,{className:"h-3 w-16"})]})]})})},x)):h.length===0?e.jsx(le,{icon:he,title:"No Messages Found",description:t?`No ${String(t)} messages found for the selected time period.`:"No messages found for the selected time period."}):h.map(u=>(c.info(d.UI,"[MessageList] Rendering message:",{messageId:u.id,messageType:typeof u}),e.jsx(Me,{message:u},u.id)))})]})},Ce=({selectedBusinessComponent:s,businessComponents:a,loading:t,onBusinessComponentChange:l})=>e.jsxs(C,{className:"animate-scale-in",children:[e.jsxs(k,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Business Component Filter"]}),e.jsx(te,{children:"Filter channels by business component"})]}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"businessComponent",children:"Business Component"}),e.jsxs(B,{value:s?.id||"",onValueChange:r=>{const n=a.find(m=>m.id===r)||null;l(n)},disabled:t,children:[e.jsx(W,{children:e.jsx(z,{placeholder:"Select a business component to filter channels"})}),e.jsx(_,{children:a.map(r=>e.jsx(g,{value:r.id,children:r.name},r.id))})]})]})})]}),We=()=>{ne("Messages"),ie("Track and monitor all integration messages, view processing status, and analyze message flow through your Integrix Flow Bridge system.");const[s,a]=j.useState(null),[t,l]=j.useState(null),[r,n]=j.useState("today"),{businessComponents:m,loading:o}=de(),{messages:h,stats:u,loading:x,connected:p,refreshData:S,loadStats:w}=ye(s?.id),I=h,b=()=>{const i={};t&&(i.status=[t]);const y=f(r);y.dateFrom&&(i.dateFrom=y.dateFrom,i.dateTo=y.dateTo),S(i)},M=i=>{l(t===i?null:i)},U=i=>{a(i),l(null)},f=i=>{const y=new Date,v=new Date(y.getFullYear(),y.getMonth(),y.getDate());switch(i){case"today":return{dateFrom:v.toISOString(),dateTo:y.toISOString()};case"yesterday":{const N=new Date(v);return N.setDate(N.getDate()-1),{dateFrom:N.toISOString(),dateTo:v.toISOString()}}case"last7days":{const N=new Date(v);return N.setDate(N.getDate()-7),{dateFrom:N.toISOString(),dateTo:y.toISOString()}}case"last30days":{const N=new Date(v);return N.setDate(N.getDate()-30),{dateFrom:N.toISOString(),dateTo:y.toISOString()}}case"all":default:return{}}};return j.useEffect(()=>{const i={};t&&(i.status=[t]);const y=f(r);y.dateFrom&&(i.dateFrom=y.dateFrom,i.dateTo=y.dateTo),S(i)},[t,r,S]),e.jsxs(oe,{children:[e.jsx(ce,{title:"Message Monitor",description:"Track and analyze integration message flows",icon:e.jsx(re,{}),actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(H,{variant:p?"success":"destructive",className:"flex items-center gap-1",children:[p?e.jsx(xe,{className:"h-3 w-3"}):e.jsx(pe,{className:"h-3 w-3"}),p?"Live":"Disconnected"]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:b,disabled:x,children:[e.jsx(V,{className:`h-4 w-4 mr-2 ${x?"animate-spin":""}`}),"Refresh"]})]})}),e.jsx(je,{messages:I,stats:u,isBusinessComponentSelected:!!s,onStatusFilter:M,statusFilter:t,loading:x}),e.jsx(Ce,{selectedBusinessComponent:s,businessComponents:m,loading:o,onBusinessComponentChange:U}),e.jsx(Te,{messages:I,isBusinessComponentSelected:!!s,statusFilter:t,loading:x,onTimeFilterChange:n})]})};export{We as Messages};
