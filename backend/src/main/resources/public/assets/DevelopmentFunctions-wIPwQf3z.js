import{j as e}from"./ui-vendor-B4gDKxp2.js";import{r as j}from"./react-vendor-pDgKdaAw.js";import{u as de}from"./useQuery-CFSB81hy.js";import{o as k,p as X,q as Z,al as ie,v as F,m as ee,r as _,A as V,e as W,d as R,l as H,L as Q,g as w,I as G,S as J,h as q,i as z,j as B,k as p,a8 as be,t as we,C as ue,y as Ce,B as I,F as Se,am as Fe,b as Te,s as me,a7 as xe,a6 as $,u as Pe}from"./index-BgQC9CM8.js";import{u as re}from"./useMutation-LHkZKiek.js";import{T as fe,a as ve,b as U,c as D}from"./tabs-CYHCjqpK.js";import{S as le}from"./scroll-area-C-DwBH_w.js";import{D as Ae,b as Ie,c as Le,d as $e,e as Ee,f as ke}from"./dialog-Y0RrrX5c.js";import{T as Ve}from"./textarea-BHEIvuLF.js";import{F as Re}from"./editor-vendor-CjSHClq6.js";import{P as Ne}from"./play-BtGvvKDg.js";import{S as Me}from"./save-ByutG-nw.js";import{C as ce}from"./circle-check-BBRJE4nr.js";import{P as ye}from"./plus-DX1aRrf7.js";import{S as Oe}from"./search-JfXMCu6I.js";import{S as he}from"./square-pen-BzsyvcIC.js";import{L as Je}from"./lock-open-Bl6Y0Idn.js";import{L as qe}from"./lock-weotqWMQ.js";import{T as ze}from"./trash-2-BpPlwinj.js";import{Z as Be}from"./zap-CM85Vbc2.js";import"./chart-vendor-A7Ge_5Hb.js";function Ue({functionName:a,code:u,language:n,onChange:r,onSave:g,onCompile:h,onTest:x,readOnly:c=!1,errors:l=[],warnings:t=[],isCompiling:m=!1,isSaving:C=!1}){const T=f=>{switch(f){case"JAVA":return"java";case"JAVASCRIPT":return"javascript";case"GROOVY":return"java";case"PYTHON":return"python";default:return"plaintext"}};return e.jsxs(k,{className:"h-full flex flex-col",children:[e.jsx(X,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),";",a]}),e.jsxs("div",{className:"flex gap-2",children:[n==="JAVA"&&h&&e.jsx(F,{variant:"outline",size:"sm",onClick:h,disabled:m||c,children:m?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Compiling..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Compile"]})}),x&&e.jsxs(F,{variant:"outline",size:"sm",onClick:x,disabled:c||l.length>0,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Test"]}),g&&e.jsx(F,{size:"sm",onClick:g,disabled:C||c||l.length>0,children:C?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Save"]})})]})]})}),e.jsxs(_,{className:"flex-1 flex flex-col p-0",children:[l.length>0&&e.jsxs(V,{variant:"destructive",className:"mx-6 mb-3",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs(R,{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Compilation Errors:"}),e.jsx("ul",{className:"list-disc list-inside text-sm",children:l.map((f,y)=>e.jsx("li",{children:f},y))})]})]}),t.length>0&&e.jsxs(V,{className:"mx-6 mb-3",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs(R,{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Warnings:"}),e.jsx("ul",{className:"list-disc list-inside text-sm",children:t.map((f,y)=>e.jsx("li",{children:f},y))})]})]}),l.length===0&&t.length===0&&m===!1&&n==="JAVA"&&e.jsxs(V,{className:"mx-6 mb-3 border-green-200 bg-green-50 text-success",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(R,{children:"Code compiled successfully!"})]}),e.jsx("div",{className:"flex-1 border-t",children:e.jsx(Re,{height:"100%",language:T(n),value:u,onChange:f=>r(f||""),options:{readOnly:c,minimap:{enabled:!1},fontSize:14,lineNumbers:"on",renderLineHighlight:"all",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:4,wordWrap:"on",theme:"vs-light"}})})]})]})}function pe(a){try{const u=a.match(/^(\w+)\s*\((.*)\)$/);if(!u)return null;const n=u[1],r=u[2].trim();if(!r)return{functionName:n,parameters:[]};const g=[];let h="",x=0;for(let c=0;c<r.length;c++){const l=r[c];if(l==="("?x++:l===")"&&x--,l===","&&x===0){const t=je(h.trim());t&&g.push(t),h=""}else h+=l}if(h.trim()){const c=je(h.trim());c&&g.push(c)}return{functionName:n,parameters:g}}catch(u){return H.error(Q.ERROR,"Error parsing function signature",{error:u}),null}}function je(a){if(!a)return null;const u=a.match(/^(\w+)\s*:\s*(\w+)$/);if(u){const[,n,r]=u;return{name:n,type:De(r),required:!0}}return{name:a,type:"any",required:!0}}function De(a){return{string:"string",number:"number",boolean:"boolean",array:"array",bool:"boolean",int:"number",float:"number",double:"number",text:"string",str:"string"}[a.toLowerCase()]||"any"}function ge(a,u){return u.map(n=>{const r=n.name;return a.includes(`${r} +`)||a.includes(`${r} -`)||a.includes(`${r} *`)||a.includes(`${r} /`)||a.includes("Math.")&&a.includes(r)?{...n,type:"number"}:a.includes(`${r}.length`)||a.includes(`${r}.substring`)||a.includes(`${r}.indexOf`)||a.includes(`${r}.toUpperCase`)||a.includes(`${r}.toLowerCase`)?{...n,type:"string"}:a.includes(`!${r}`)||a.includes(`${r} &&`)||a.includes(`${r} ||`)||a.includes(`${r} ?`)?{...n,type:"boolean"}:a.includes(`${r}.length`)||a.includes(`${r}[`)||a.includes(`${r}.map`)||a.includes(`${r}.filter`)||a.includes(`${r}.reduce`)?{...n,type:"array"}:n})}const We=[{value:"string",label:"String"},{value:"number",label:"Number (int/double/float)"},{value:"boolean",label:"Boolean"},{value:"array",label:"Array/List"},{value:"any",label:"Any (Object)"}];function He({parameters:a,onChange:u,readOnly:n=!1}){const r=()=>{const c={name:`param${a.length+1}`,type:"string",required:!0};u([...a,c])},g=c=>{const l=a.filter((t,m)=>m!==c);u(l)},h=(c,l,t)=>{const m=[...a];m[c]={...m[c],[l]:t},u(m)},x=()=>a.length===0?"functionName()":`functionName(${a.map(l=>`${l.type} ${l.name}`).join(", ")})`;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{children:"Function Parameters"}),";",!n&&e.jsxs(F,{type:"button",variant:"outline",size:"sm",onClick:r,className:"h-8",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"Add Parameter"]})]}),a.length===0?e.jsx(k,{className:"p-4 border-dashed",children:e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:'No parameters defined. Click "Add Parameter" to add one.'})}):e.jsx("div",{className:"space-y-2",children:a.map((c,l)=>e.jsxs(k,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Parameter Name"}),e.jsx(G,{value:c.name,onChange:t=>h(l,"name",t.target.value),placeholder:"paramName",disabled:n,className:"h-8 text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Java Type"}),e.jsxs(J,{value:c.type,onValueChange:t=>h(l,"type",t),disabled:n,children:[e.jsx(q,{className:"h-8 text-sm",children:e.jsx(z,{})}),e.jsx(B,{children:We.map(t=>e.jsx(p,{value:t.value,className:"text-sm",children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-xs",children:"Required"}),e.jsxs(J,{value:c.required?"true":"false",onValueChange:t=>h(l,"required",t==="true"),disabled:n,children:[e.jsx(q,{className:"h-8 text-sm",children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(p,{value:"true",className:"text-sm",children:"Required"}),e.jsx(p,{value:"false",className:"text-sm",children:"Optional"})]})]})]})]}),!n&&e.jsx(F,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(l),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:e.jsx(be,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-2",children:e.jsx(G,{value:c.description||"",onChange:t=>h(l,"description",t.target.value),placeholder:"Parameter description (optional)",disabled:n,className:"h-8 text-sm"})})]},l))}),e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded-md",children:[e.jsx(w,{className:"text-xs text-muted-foreground mb-1 block",children:"Generated Signature Preview"}),e.jsx("code",{className:"text-sm font-mono",children:x()})]})]})}function Qe({functionId:a,functionName:u,parameters:n,onTest:r}){const[g,h]=j.useState({}),[x,c]=j.useState(!1),[l,t]=j.useState(null),m=(i,v)=>{h(b=>({...b,[i]:v}))},C=(i,v)=>{if(!i&&v!=="String")return null;try{switch(v){case"int":case"Integer":return parseInt(i,10);case"long":case"Long":return parseInt(i,10);case"double":case"Double":return parseFloat(i);case"float":case"Float":return parseFloat(i);case"boolean":case"Boolean":return i.toLowerCase()==="true";case"List":try{const b=JSON.parse(i);return Array.isArray(b)?b:[i]}catch{return i.split(",").map(b=>b.trim())}case"Map":case"Object":try{return JSON.parse(i)}catch{return i}default:return i}}catch(b){return H.error(Q.UI,`Error parsing ${v}`,{value:i,error:b}),i}},T=async()=>{c(!0),t(null);try{const i={};for(const E of n){const O=g[E.name]||"";i[E.name]=C(O,E.type)}const v=Date.now(),b=await r(a,i),M=Date.now()-v;t({...b,executionTime:M})}catch(i){t({success:!1,error:i instanceof Error?i.message:"Test execution failed"})}finally{c(!1)}},f=i=>{switch(i.type){case"number":return"e.g., 42 or 3.14";case"boolean":return"true or false";case"array":return"e.g., [1, 2, 3] or 1,2,3";case"any":return'e.g., {"key": "value"} or any value';case"string":default:return"Enter value..."}},y=i=>{if(i==null)return"null";if(typeof i=="object")try{return JSON.stringify(i,null,2)}catch{return String(i)}return String(i)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(w,{children:"Test Inputs"}),";",n.length===0?e.jsxs(V,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(R,{children:'This function has no parameters. Click "Run Test" to execute it.'})]}):e.jsx("div",{className:"space-y-3",children:n.map(i=>e.jsx(k,{className:"p-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs(w,{className:"text-sm",children:[i.name,i.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-mono bg-muted px-1 py-0.5 rounded",children:i.type}),i.description&&e.jsx("span",{children:i.description})]})]})}),e.jsx(G,{value:g[i.name]||"",onChange:v=>m(i.name,v.target.value),placeholder:f(i),className:"font-mono text-sm"})]})},i.name))})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(F,{onClick:T,disabled:x,className:"w-full sm:w-auto",children:x?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Running Test..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Run Test"]})})}),l&&e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:l.success?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-5 w-5 text-success"}),e.jsx("span",{className:"font-semibold text-success",children:"Test Passed"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-5 w-5 text-destructive"}),e.jsx("span",{className:"font-semibold text-destructive",children:"Test Failed"})]})}),l.executionTime!==void 0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[l.executionTime,"ms"]})]}),l.success&&l.output!==void 0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm",children:"Output"}),e.jsx("pre",{className:"bg-muted p-3 rounded text-sm overflow-x-auto",children:e.jsx("code",{children:y(l.output)})})]}),!l.success&&l.error&&e.jsxs(V,{variant:"destructive",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(R,{className:"font-mono text-sm",children:l.error})]})]})})]})}function Ge({open:a,onOpenChange:u,function:n,mode:r,onSave:g,onCompile:h,onTest:x,isBuiltIn:c=!1,developmentMode:l=!1}){const[t,m]=j.useState({name:"",description:"",category:"general",language:"JAVA",functionSignature:"",functionBody:"",isSafe:!0,isPublic:!0,performanceClass:"NORMAL"}),[C,T]=j.useState([]),[f,y]=j.useState([]),[i,v]=j.useState([]),[b,M]=j.useState(!1),[E,O]=j.useState(!1),[K,L]=j.useState(!1),[oe,P]=j.useState([]);j.useEffect(()=>{if(n){if(m({name:n.name||"",description:n.description||"",category:n.category||"general",language:n.language||"JAVA",functionSignature:n.functionSignature||"",functionBody:n.functionBody||"",isSafe:n.isSafe??!0,isPublic:n.isPublic??!0,performanceClass:n.performanceClass||"NORMAL"}),L(!1),y([]),v([]),n.parameters)try{const o=typeof n.parameters=="string"?JSON.parse(n.parameters):n.parameters;T(o),P(o)}catch(o){if(H.error(Q.UI,"Failed to parse parameters",{error:o}),n.functionSignature){const S=pe(n.functionSignature);if(S){const s=ge(n.functionBody||"",S.parameters);T(s),P(s)}}}else if(n.functionSignature){const o=pe(n.functionSignature);if(o){const S=ge(n.functionBody||"",o.parameters);T(S),P(S)}}}},[n]);const se=async()=>{if(!(!h||t.language!=="JAVA")){M(!0),y([]),v([]);try{const o=await h(t.functionBody);o.success?(L(!0),v(o.warnings||[])):y(o.errors||["Compilation failed"])}catch(o){y(["Failed to compile: "+o])}finally{M(!1)}}},Y=async()=>{if(g){if(t.language==="JAVA"&&!K&&r!=="view"){y(["Please compile the Java code before saving"]);return}O(!0);try{const o=ne(t.name,C),S={...t,functionSignature:o,parameters:C};await g(S),u(!1)}catch(o){H.error(Q.UI,"Failed to save",{error:o})}finally{O(!1)}}},A=r==="edit"||r==="create",ae=A&&l,te=o=>{T(o),P(o),L(!1)},ne=(o,S)=>{if(S.length===0)return`${o}()`;const s=S.map(d=>`${d.type} ${d.name}`).join(", ");return`${o}(${s})`};return e.jsx(Ae,{open:a,onOpenChange:u,children:e.jsxs(Ie,{className:"max-w-6xl max-h-[90vh] p-0",children:[e.jsxs(Le,{className:"px-6 pt-6",children:[e.jsx($e,{children:r==="create"?"Create New Function":r==="edit"?"Edit Function":"View Function"}),e.jsx(Ee,{children:r==="create"?"Create a new transformation function":r==="edit"?"Modify the function implementation":"View function details and implementation"})]}),e.jsxs(fe,{defaultValue:"details",className:"flex-1",children:[e.jsxs(ve,{className:"mx-6",children:[e.jsx(U,{value:"details",children:"Details"}),e.jsx(U,{value:"code",children:"Code"}),n&&e.jsx(U,{value:"test",children:"Test"})]}),e.jsxs(le,{className:"h-[60vh]",children:[e.jsx(D,{value:"details",className:"px-6 space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"name",children:"Function Name"}),e.jsx(G,{id:"name",value:t.name,onChange:o=>m({...t,name:o.target.value}),readOnly:!A||c&&r==="edit",placeholder:"e.g., calculateTax"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"category",children:"Category"}),e.jsxs(J,{value:t.category,onValueChange:o=>m({...t,category:o}),disabled:!A,children:[e.jsx(q,{id:"category",children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(p,{value:"math",children:"Math"}),e.jsx(p,{value:"text",children:"Text"}),e.jsx(p,{value:"date",children:"Date"}),e.jsx(p,{value:"boolean",children:"Boolean"}),e.jsx(p,{value:"conversion",children:"Conversion"}),e.jsx(p,{value:"node",children:"Node"}),e.jsx(p,{value:"constants",children:"Constants"}),e.jsx(p,{value:"general",children:"General"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"description",children:"Description"}),e.jsx(Ve,{id:"description",value:t.description,onChange:o=>m({...t,description:o.target.value}),readOnly:!A,placeholder:"Describe what this function does...",rows:3})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(He,{parameters:C,onChange:te,readOnly:!A||c&&!l}),A&&r==="create"&&e.jsxs(V,{children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx(R,{className:"text-xs",children:"Define your function parameters above. The signature will be generated automatically."})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"language",children:"Language"}),e.jsxs(J,{value:t.language,onValueChange:o=>{m({...t,language:o}),L(!1),y([]),v([])},disabled:!A||c&&r==="edit",children:[e.jsx(q,{id:"language",children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(p,{value:"JAVA",children:"Java"}),!c&&e.jsxs(e.Fragment,{children:[e.jsx(p,{value:"GROOVY",children:"Groovy"}),e.jsx(p,{value:"JAVASCRIPT",children:"JavaScript"}),e.jsx(p,{value:"PYTHON",children:"Python"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"performance",children:"Performance Class"}),e.jsxs(J,{value:t.performanceClass,onValueChange:o=>m({...t,performanceClass:o}),disabled:!A,children:[e.jsx(q,{id:"performance",children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(p,{value:"FAST",children:"Fast"}),e.jsx(p,{value:"NORMAL",children:"Normal"}),e.jsx(p,{value:"SLOW",children:"Slow"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Flags"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[t.isPublic&&e.jsx(I,{variant:"secondary",children:"Public"}),t.isSafe&&e.jsx(I,{variant:"secondary",children:"Safe"}),c&&e.jsx(I,{children:"Built-in"})]})]})]})]})}),e.jsx(D,{value:"code",className:"h-full",children:e.jsx("div",{className:"h-[50vh] px-6",children:e.jsx(Ue,{functionName:t.name,code:t.functionBody,language:t.language,onChange:o=>{m({...t,functionBody:o}),L(!1)},onCompile:t.language==="JAVA"?se:void 0,readOnly:!A,errors:f,warnings:i,isCompiling:b})})}),e.jsx(D,{value:"test",className:"px-6",children:e.jsx(Qe,{functionId:n?.functionId||"",functionName:t.name,parameters:C,onTest:x||(async()=>({success:!1,error:"Test handler not provided"}))})})]})]}),e.jsxs(ke,{className:"px-6 pb-6",children:[e.jsx(F,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),ae&&e.jsx(F,{onClick:Y,disabled:E||f.length>0,children:E?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Function"})]})]})})}const js=()=>{const{toast:a}=Se(),[u,n]=j.useState(""),[r,g]=j.useState("all"),[h,x]=j.useState(!1),[c,l]=j.useState(null),[t,m]=j.useState("view"),C=Fe(),{data:T}=de({queryKey:["development-mode"],queryFn:async()=>await $.get("/development/functions/development-mode")}),{data:f,isLoading:y}=de({queryKey:["development-functions"],queryFn:async()=>await $.get("/development/functions")}),i=async s=>await $.get(`/development/functions/${s}`),v=re({mutationFn:async s=>await $.post("/development/functions",s),onSuccess:()=>{C.invalidateQueries({queryKey:["development-functions"]}),a({title:"Success",description:"Function created successfully"}),x(!1)},onError:s=>{a({title:"Error",description:s.response?.data?.message||"Failed to create function",variant:"destructive"})}}),b=re({mutationFn:async({functionId:s,data:d})=>await $.put(`/development/functions/${s}`,d),onSuccess:()=>{C.invalidateQueries({queryKey:["development-functions"]}),a({title:"Success",description:"Function updated successfully"}),x(!1)},onError:s=>{a({title:"Error",description:s.response?.data?.message||"Failed to update function",variant:"destructive"})}}),M=re({mutationFn:async s=>{await $.delete(`/development/functions/${s}`)},onSuccess:()=>{C.invalidateQueries({queryKey:["development-functions"]}),a({title:"Success",description:"Function deleted successfully"})},onError:s=>{a({title:"Error",description:s.response?.data?.message||"Failed to delete function",variant:"destructive"})}}),E=async s=>{try{return await $.post("/development/functions/compile",{functionName:c?.name||"TestFunction",code:s})}catch(d){throw d.response?.data||d}},O=async(s,d)=>{try{return await $.post(`/development/functions/${s}/test`,d)}catch(N){throw N.response?.data||N}},K=f?.builtInFunctions.filter(s=>{const d=s.name.toLowerCase().includes(u.toLowerCase())||s.description.toLowerCase().includes(u.toLowerCase()),N=r==="all"||s.category===r;return d&&N})||[],L=f?.customFunctions.content.filter(s=>{const d=s.name.toLowerCase().includes(u.toLowerCase())||s.description.toLowerCase().includes(u.toLowerCase()),N=r==="all"||s.category===r;return d&&N})||[],oe=["all",...new Set(f?.builtInFunctions.map(s=>s.category)||[])],P=T?.developmentMode||!1,se=()=>{l(null),m("create"),x(!0)},Y=async(s,d=!1)=>{try{const N=await i(s);l(N),m("view"),x(!0)}catch{a({title:"Error",description:"Failed to load function details",variant:"destructive"})}},A=async(s,d=!1)=>{try{const N=await i(s);l(N),m("edit"),x(!0)}catch{a({title:"Error",description:"Failed to load function details",variant:"destructive"})}},ae=async s=>{t==="create"?v.mutate(s):t==="edit"&&c&&b.mutate({functionId:c.functionId,data:s})},te=async s=>{confirm("Are you sure you want to delete this function?")&&M.mutate(s)},ne=s=>{switch(s){case"FAST":return e.jsx(Be,{className:"h-3 w-3 text-green-500"});case"SLOW":return e.jsx(Pe,{className:"h-3 w-3 text-orange-500"});default:return e.jsx(ce,{className:"h-3 w-3 text-blue-500"})}},o=async s=>{try{return await $.get(`/development/functions/built-in/${s}`)}catch(d){return H.error(Q.ERROR,"Error finding built-in function",{error:d}),null}},S=async s=>{try{const d=await o(s.name);d?(l(d),m(P?"edit":"view"),x(!0)):a({title:"Error",description:"Function details not found",variant:"destructive"})}catch{a({title:"Error",description:"Failed to load function details",variant:"destructive"})}};return y?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-64 bg-muted rounded"})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(ie,{className:"h-8 w-8"}),"Development Functions"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and test transformation functions for visual flow and orchestration editors"})]}),P&&e.jsxs(F,{className:"gap-2",onClick:se,children:[e.jsx(ye,{className:"h-4 w-4"}),"Create Function"]})]}),!P&&e.jsxs(V,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(Te,{children:"Read-Only Mode"}),e.jsxs(R,{children:["Function creation and editing is only available in development mode. Current profile: ",T?.developmentMode===!1?"Production/QA":"Unknown"]})]}),e.jsxs(k,{children:[e.jsx(X,{children:e.jsx(Z,{children:"Search Functions"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search by name or description...",value:u,onChange:s=>n(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:oe.map(s=>e.jsx(I,{variant:r===s?"default":"outline",className:"cursor-pointer",onClick:()=>g(s),children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})]}),e.jsxs(fe,{defaultValue:"builtin",className:"space-y-4",children:[e.jsxs(ve,{children:[e.jsxs(U,{value:"builtin",children:["Built-in Functions (",K.length,")"]}),e.jsxs(U,{value:"custom",children:["Custom Functions (",L.length,")"]})]}),e.jsx(D,{value:"builtin",className:"space-y-4",children:e.jsxs(k,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Built-in Functions"}),e.jsx(me,{children:"Pre-configured functions available in all environments"})]}),e.jsx(_,{children:e.jsx(le,{className:"h-[600px]",children:e.jsx("div",{className:"space-y-2",children:K.map((s,d)=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-accent/50 transition-colors cursor-pointer",onClick:()=>S(s),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx(I,{variant:"secondary",className:"text-xs",children:s.category}),e.jsx(I,{className:"text-xs",children:"Built-in"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.signature})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(F,{size:"sm",variant:"ghost",onClick:N=>{N.stopPropagation(),S(s)},children:P?e.jsx(he,{className:"h-4 w-4"}):e.jsx(xe,{className:"h-4 w-4"})})})]})},`${s.category}-${s.name}`))})})})]})}),e.jsx(D,{value:"custom",className:"space-y-4",children:e.jsxs(k,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Custom Functions"}),e.jsx(me,{children:"User-defined functions for specialized transformations"})]}),e.jsx(_,{children:e.jsx(le,{className:"h-[600px]",children:e.jsxs("div",{className:"space-y-2",children:[L.filter(s=>!s.isBuiltIn).map(s=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-accent/50 transition-colors cursor-pointer",onClick:()=>Y(s.functionId),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx(I,{variant:"secondary",className:"text-xs",children:s.language}),e.jsxs("div",{className:"flex items-center gap-1",children:[ne(s.performanceClass),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.performanceClass})]}),s.isSafe?e.jsxs(I,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),"Safe"]}):e.jsxs(I,{variant:"destructive",className:"text-xs gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),"Unsafe"]}),s.isPublic?e.jsxs(I,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(Je,{className:"h-3 w-3"}),"Public"]}):e.jsxs(I,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(qe,{className:"h-3 w-3"}),"Private"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.functionSignature}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Version ",s.version," • Created by ",s.createdBy]})]}),P&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{size:"sm",variant:"ghost",onClick:d=>{d.stopPropagation(),Y(s.functionId)},children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(F,{size:"sm",variant:"ghost",onClick:d=>{d.stopPropagation(),A(s.functionId)},children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(F,{size:"sm",variant:"ghost",onClick:d=>{d.stopPropagation(),te(s.functionId)},children:e.jsx(ze,{className:"h-4 w-4"})})]})]})},s.functionId)),L.filter(s=>!s.isBuiltIn).length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No custom functions found"})]})})})]})})]}),e.jsx(Ge,{open:h,onOpenChange:x,function:c,mode:t,onSave:ae,onCompile:E,onTest:O,isBuiltIn:c?.isBuiltIn||!1,developmentMode:P})]})};export{js as DevelopmentFunctions};
