# ProGuard configuration for Integrix Flow Bridge
# Optimized for Spring Boot applications

# Basic obfuscation settings
-verbose
-dontshrink
-dontoptimize
-dontwarn

# Keep main application class
-keep public class com.integrixs.backend.BackendApplication {
    public static void main(java.lang.String[]);
}

# Keep Spring Boot configuration classes
-keep @org.springframework.boot.autoconfigure.SpringBootApplication class *
-keep @org.springframework.context.annotation.Configuration class *
-keep @org.springframework.stereotype.Component class *
-keep @org.springframework.stereotype.Service class *
-keep @org.springframework.stereotype.Repository class *
-keep @org.springframework.web.bind.annotation.RestController class *
-keep @org.springframework.web.bind.annotation.Controller class *

# Keep Spring Boot auto-configuration
-keep class org.springframework.boot.autoconfigure.** { *; }
-keep class org.springframework.boot.context.properties.** { *; }

# Keep all Spring annotation classes and their methods
-keepclassmembers class * {
    @org.springframework.beans.factory.annotation.Autowired *;
    @org.springframework.beans.factory.annotation.Value *;
    @org.springframework.web.bind.annotation.RequestMapping *;
    @org.springframework.web.bind.annotation.GetMapping *;
    @org.springframework.web.bind.annotation.PostMapping *;
    @org.springframework.web.bind.annotation.PutMapping *;
    @org.springframework.web.bind.annotation.DeleteMapping *;
    @org.springframework.web.bind.annotation.PatchMapping *;
    @org.springframework.context.annotation.Bean *;
}

# Keep REST controller methods and parameters
-keepclassmembers @org.springframework.web.bind.annotation.RestController class * {
    public *;
}

# Keep validation annotations
-keep class javax.validation.** { *; }
-keep class jakarta.validation.** { *; }
-keepclassmembers class * {
    @javax.validation.* *;
    @jakarta.validation.* *;
}

# Keep JPA/Hibernate entities and their properties
-keep @javax.persistence.Entity class *
-keep @jakarta.persistence.Entity class *
-keepclassmembers @javax.persistence.Entity class * {
    <fields>;
    <methods>;
}
-keepclassmembers @jakarta.persistence.Entity class * {
    <fields>;
    <methods>;
}

# Keep getter and setter methods (important for Spring and Jackson)
-keepclassmembers class * {
    public void set*(***);
    public void set*(int, ***);
    public boolean is*();
    public boolean is*(int);
    public *** get*();
    public *** get*(int);
}

# Keep Jackson/JSON serialization
-keep class com.fasterxml.jackson.** { *; }
-keep @com.fasterxml.jackson.annotation.JsonIgnoreProperties class *
-keep @com.fasterxml.jackson.annotation.JsonProperty class *
-keepclassmembers class * {
    @com.fasterxml.jackson.annotation.* *;
}

# Keep model classes (DTOs, entities, etc.)
-keep class com.integrixs.data.model.** { *; }
-keep class **.dto.** { *; }
-keep class **.model.** { *; }
-keep class **.entity.** { *; }

# Keep adapter configuration classes
-keep class com.integrixs.adapters.config.** { *; }

# Keep Camunda BPM classes
-keep class org.camunda.bpm.** { *; }

# Keep reflection-based classes
-keepclassmembers class * {
    @java.lang.reflect.* *;
}

# Keep serialization
-keepclassmembers class * implements java.io.Serializable {
    static final long serialVersionUID;
    private static final java.io.ObjectStreamField[] serialPersistentFields;
    private void writeObject(java.io.ObjectOutputStream);
    private void readObject(java.io.ObjectInputStream);
    java.lang.Object writeReplace();
    java.lang.Object readResolve();
}

# Keep native methods
-keepclasseswithmembernames class * {
    native <methods>;
}

# Keep enums
-keepclassmembers enum * {
    public static **[] values();
    public static ** valueOf(java.lang.String);
}

# Keep exception classes
-keep public class * extends java.lang.Exception

# Don't obfuscate stack traces
-keepattributes SourceFile,LineNumberTable

# Keep annotations for runtime use
-keepattributes RuntimeVisibleAnnotations,RuntimeInvisibleAnnotations
-keepattributes RuntimeVisibleParameterAnnotations,RuntimeInvisibleParameterAnnotations

# Keep generic signatures for reflection
-keepattributes Signature

# Keep inner classes
-keepattributes InnerClasses,EnclosingMethod

# Preserve method parameter names for Spring
-keepparameternames

# Aggressive obfuscation settings
-obfuscationdictionary proguard-dictionary.txt
-classobfuscationdictionary proguard-dictionary.txt
-packageobfuscationdictionary proguard-dictionary.txt

# Don't warn about missing classes (common in Spring Boot fat jars)
-dontwarn org.springframework.**
-dontwarn org.apache.**
-dontwarn com.sun.**
-dontwarn javax.**
-dontwarn jakarta.**
-dontwarn org.slf4j.**
-dontwarn ch.qos.logback.**
-dontwarn net.sf.cglib.**
-dontwarn org.objectweb.asm.**