import { useState, useEffect } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Switch } from '@/components/ui/switch';
import { Separator } from '@/components/ui/separator';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { PageContainer } from '@/components/ui/page-container';
import { PageHeader } from '@/components/common/PageHeader';
import { useToast } from '@/hooks/use-toast';
import { useAuth } from '@/hooks/useAuth';
import { useDocumentTitle } from '@/hooks/useDocumentTitle';
import { useMetaDescription } from '@/hooks/useMetaDescription';
import { useUIStore } from '@/stores/ui-store';
import {
 Settings as SettingsIcon,
 Save,
 RefreshCw,
 Bell,
 Palette,
 Globe,
 Key,
 User,
 Lock,
 Mail,
 Clock,
 Info
} from 'lucide-react';

export const Settings = () => {
 useDocumentTitle('Settings');
 useMetaDescription('Configure your Integrix Flow Bridge preferences, manage security settings, customize notifications, and control system-wide configurations.');
 const { user } = useAuth();
 const { toast } = useToast();
 const { theme, setTheme, compactMode, setCompactMode } = useUIStore();
 const [activeTab, setActiveTab] = useState('profile');
 const [isLoading, setIsLoading] = useState(false);
 const [isSaving, setIsSaving] = useState(false);

 // User preferences state
 const [preferences, setPreferences] = useState({
 language: 'en',
 timezone: 'UTC',
 dateFormat: 'MM/DD/YYYY',
 timeFormat: '12h',
 emailNotifications: true,
 browserNotifications: false,
 soundAlerts: true,
 showHelperText: true
 });

 // Profile state
 const [profile, setProfile] = useState({
 firstName: user?.first_name || '',
 lastName: user?.last_name || '',
 email: user?.email || '',
 phone: '',
 department: '',
 title: ''
 });

 // Password change state
 const [passwordForm, setPasswordForm] = useState({
 currentPassword: '',
 newPassword: '',
 confirmPassword: ''
 });


 const handleSaveProfile = async () => {
    try {
 setIsSaving(true);
 // API call to save profile
 toast({
 title: "Profile Updated",
 description: "Your profile has been updated successfully",
 });
 } catch (error) {
 toast({
 title: "Error",
 description: "Failed to update profile",
 variant: "destructive",
 });
 } finally {
 setIsSaving(false);
 }
 };

 const handleSavePreferences = async () => {
    try {
 setIsSaving(true);
 // API call to save preferences
 localStorage.setItem('userPreferences', JSON.stringify(preferences));
 toast({
 title: "Preferences Saved",
 description: "Your preferences have been saved successfully",
 });
 } catch (error) {
 toast({
 title: "Error",
 description: "Failed to save preferences",
 variant: "destructive",
 });
 } finally {
 setIsSaving(false);
 }
 };

 const handleChangePassword = async () => {
 if (passwordForm.newPassword !== passwordForm.confirmPassword) {
 toast({
 title: "Error",
 description: "New passwords do not match",
 variant: "destructive",
 });
 return;
 }

 try {
 setIsSaving(true);
 // API call to change password
 toast({
 title: "Password Changed",
 description: "Your password has been changed successfully",
 });
 setPasswordForm({
 currentPassword: '',
 newPassword: '',
 confirmPassword: ''
 });
 } catch (error) {
 toast({
 title: "Error",
 description: "Failed to change password",
 variant: "destructive",
 });
 } finally {
 setIsSaving(false);
 }
 };

 // Load preferences on mount
 useEffect(() => {
 const savedPreferences = localStorage.getItem('userPreferences');
 if (savedPreferences) {
 setPreferences(JSON.parse(savedPreferences));
 }
 }, []);

 return (
 <PageContainer>
 <PageHeader
 title="User Settings"
 description="Manage your profile and personal preferences"
 icon={<SettingsIcon />}
 />

 <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
 <TabsList className="grid grid-cols-4 w-full max-w-2xl">
 <TabsTrigger value="profile" className="flex items-center gap-2">
 <User className="h-4 w-4" />
 Profile
 </TabsTrigger>
 <TabsTrigger value="preferences" className="flex items-center gap-2">
 <Palette className="h-4 w-4" />
 Preferences
 </TabsTrigger>
 <TabsTrigger value="notifications" className="flex items-center gap-2">
 <Bell className="h-4 w-4" />
 Notifications
 </TabsTrigger>
 <TabsTrigger value="security" className="flex items-center gap-2">
 <Lock className="h-4 w-4" />
 Security
 </TabsTrigger>
 </TabsList>

 {/* Profile Tab */}
 <TabsContent value="profile" className="space-y-6">
 <Card>
 <CardHeader>
 <CardTitle>Profile Information</CardTitle>
 <CardDescription>Update your personal information and contact details</CardDescription>
 </CardHeader>
 <CardContent className="space-y-6">
 <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
 <div className="space-y-2">
 <Label htmlFor="firstName">First Name</Label>
 <Input
 id="firstName"
 value={profile.firstName}
 onChange={(e) => setProfile({...profile, firstName: e.target.value})}
 placeholder="Enter first name"
 />
 </div>
 <div className="space-y-2">
 <Label htmlFor="lastName">Last Name</Label>
 <Input
 id="lastName"
 value={profile.lastName}
 onChange={(e) => setProfile({...profile, lastName: e.target.value})}
 placeholder="Enter last name"
 />
 </div>
 <div className="space-y-2">
 <Label htmlFor="email">Email</Label>
 <Input
 id="email"
 type="email"
 value={profile.email}
 onChange={(e) => setProfile({...profile, email: e.target.value})}
 placeholder="Enter email"
 />
 </div>
 <div className="space-y-2">
 <Label htmlFor="phone">Phone</Label>
 <Input
 id="phone"
 value={profile.phone}
 onChange={(e) => setProfile({...profile, phone: e.target.value})}
 placeholder="Enter phone number"
 />
 </div>
 <div className="space-y-2">
 <Label htmlFor="department">Department</Label>
 <Input
 id="department"
 value={profile.department}
 onChange={(e) => setProfile({...profile, department: e.target.value})}
 placeholder="Enter department"
 />
 </div>
 <div className="space-y-2">
 <Label htmlFor="title">Job Title</Label>
 <Input
 id="title"
 value={profile.title}
 onChange={(e) => setProfile({...profile, title: e.target.value})}
 placeholder="Enter job title"
 />
 </div>
 </div>

 <div className="flex justify-end">
 <Button onClick={handleSaveProfile} disabled={isSaving}>
 {isSaving ? (
 <>
 <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
 Saving...
 </>
 ) : (
 <>
 <Save className="h-4 w-4 mr-2" />
 Save Profile
 </>
 )}
 </Button>
 </div>
 </CardContent>
 </Card>
 </TabsContent>

 {/* Preferences Tab */}
 <TabsContent value="preferences" className="space-y-6">
 <Card>
 <CardHeader>
 <CardTitle>Display Preferences</CardTitle>
 <CardDescription>Customize how the application looks and behaves for you</CardDescription>
 </CardHeader>
 <CardContent className="space-y-6">
 <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
 <div className="space-y-2">
 <Label htmlFor="theme">Theme</Label>
 <Select
 value={theme}
 onValueChange={setTheme}
 >
 <SelectTrigger>
 <SelectValue />
 </SelectTrigger>
 <SelectContent>
 <SelectItem value="light">Light</SelectItem>
 <SelectItem value="dark">Dark</SelectItem>
 <SelectItem value="system">System</SelectItem>
 </SelectContent>
 </Select>
 </div>
 <div className="space-y-2">
 <Label htmlFor="language">Language</Label>
 <Select
 value={preferences.language}
 onValueChange={(value) => setPreferences({...preferences, language: value})}
 >
 <SelectTrigger>
 <SelectValue />
 </SelectTrigger>
 <SelectContent>
 <SelectItem value="en">English</SelectItem>
 <SelectItem value="es">Spanish</SelectItem>
 <SelectItem value="fr">French</SelectItem>
 <SelectItem value="de">German</SelectItem>
 </SelectContent>
 </Select>
 </div>
 <div className="space-y-2">
 <Label htmlFor="timezone">Timezone</Label>
 <Select
 value={preferences.timezone}
 onValueChange={(value) => setPreferences({...preferences, timezone: value})}
 >
 <SelectTrigger>
 <SelectValue />
 </SelectTrigger>
 <SelectContent>
 <SelectItem value="UTC">UTC</SelectItem>
 <SelectItem value="America/New_York">Eastern Time</SelectItem>
 <SelectItem value="America/Chicago">Central Time</SelectItem>
 <SelectItem value="America/Denver">Mountain Time</SelectItem>
 <SelectItem value="America/Los_Angeles">Pacific Time</SelectItem>
 <SelectItem value="Europe/London">London</SelectItem>
 <SelectItem value="Europe/Paris">Paris</SelectItem>
 <SelectItem value="Asia/Tokyo">Tokyo</SelectItem>
 </SelectContent>
 </Select>
 </div>
 <div className="space-y-2">
 <Label htmlFor="dateFormat">Date Format</Label>
 <Select
 value={preferences.dateFormat}
 onValueChange={(value) => setPreferences({...preferences, dateFormat: value})}
 >
 <SelectTrigger>
 <SelectValue />
 </SelectTrigger>
 <SelectContent>
 <SelectItem value="MM/DD/YYYY">MM/DD/YYYY</SelectItem>
 <SelectItem value="DD/MM/YYYY">DD/MM/YYYY</SelectItem>
 <SelectItem value="YYYY-MM-DD">YYYY-MM-DD</SelectItem>
 </SelectContent>
 </Select>
 </div>
 <div className="space-y-2">
 <Label htmlFor="timeFormat">Time Format</Label>
 <Select
 value={preferences.timeFormat}
 onValueChange={(value) => setPreferences({...preferences, timeFormat: value})}
 >
 <SelectTrigger>
 <SelectValue />
 </SelectTrigger>
 <SelectContent>
 <SelectItem value="12h">12 Hour</SelectItem>
 <SelectItem value="24h">24 Hour</SelectItem>
 </SelectContent>
 </Select>
 </div>
 </div>

 <Separator />

 <div className="space-y-4">
 <h3 className="text-lg font-semibold">Interface Options</h3>
 <div className="space-y-4">
 <div className="flex items-center justify-between">
 <div className="space-y-0.5">
 <Label htmlFor="compactView">Compact View</Label>
 <p className="text-sm text-muted-foreground">
 Use a more condensed layout
 </p>
 </div>
 <Switch
 id="compactView"
 checked={compactMode}
 onCheckedChange={setCompactMode}
 />
 </div>
 <div className="flex items-center justify-between">
 <div className="space-y-0.5">
 <Label htmlFor="showHelperText">Show Helper Text</Label>
 <p className="text-sm text-muted-foreground">
 Display helpful tooltips and descriptions
 </p>
 </div>
 <Switch
 id="showHelperText"
 checked={preferences.showHelperText}
 onCheckedChange={(checked) => setPreferences({...preferences, showHelperText: checked})}
 />
 </div>
 </div>
 </div>

 <div className="flex justify-end">
 <Button onClick={handleSavePreferences} disabled={isSaving}>
 {isSaving ? (
 <>
 <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
 Saving...
 </>
 ) : (
 <>
 <Save className="h-4 w-4 mr-2" />
 Save Preferences
 </>
 )}
 </Button>
 </div>
 </CardContent>
 </Card>
 </TabsContent>

 {/* Notifications Tab */}
 <TabsContent value="notifications" className="space-y-6">
 <Card>
 <CardHeader>
 <CardTitle>Notification Preferences</CardTitle>
 <CardDescription>Choose how you want to be notified about important events</CardDescription>
 </CardHeader>
 <CardContent className="space-y-6">
 <Alert>
 <Info className="h-4 w-4" />
 <AlertDescription>
 These settings control personal notifications. System-wide notification settings are managed by administrators.
 </AlertDescription>
 </Alert>

 <div className="space-y-4">
 <div className="flex items-center justify-between">
 <div className="space-y-0.5">
 <Label htmlFor="emailNotifications">Email Notifications</Label>
 <p className="text-sm text-muted-foreground">
 Receive notifications via email
 </p>
 </div>
 <Switch
 id="emailNotifications"
 checked={preferences.emailNotifications}
 onCheckedChange={(checked) => setPreferences({...preferences, emailNotifications: checked})}
 />
 </div>
 <div className="flex items-center justify-between">
 <div className="space-y-0.5">
 <Label htmlFor="browserNotifications">Browser Notifications</Label>
 <p className="text-sm text-muted-foreground">
 Show desktop notifications
 </p>
 </div>
 <Switch
 id="browserNotifications"
 checked={preferences.browserNotifications}
 onCheckedChange={(checked) => setPreferences({...preferences, browserNotifications: checked})}
 />
 </div>
 <div className="flex items-center justify-between">
 <div className="space-y-0.5">
 <Label htmlFor="soundAlerts">Sound Alerts</Label>
 <p className="text-sm text-muted-foreground">
 Play sounds for important events
 </p>
 </div>
 <Switch
 id="soundAlerts"
 checked={preferences.soundAlerts}
 onCheckedChange={(checked) => setPreferences({...preferences, soundAlerts: checked})}
 />
 </div>
 </div>

 <div className="flex justify-end">
 <Button onClick={handleSavePreferences} disabled={isSaving}>
 {isSaving ? (
 <>
 <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
 Saving...
 </>
 ) : (
 <>
 <Save className="h-4 w-4 mr-2" />
 Save Preferences
 </>
 )}
 </Button>
 </div>
 </CardContent>
 </Card>
 </TabsContent>

 {/* Security Tab */}
 <TabsContent value="security" className="space-y-6">
 <Card>
 <CardHeader>
 <CardTitle>Change Password</CardTitle>
 <CardDescription>Update your account password</CardDescription>
 </CardHeader>
 <CardContent className="space-y-6">
 <div className="space-y-4 max-w-md">
 <div className="space-y-2">
 <Label htmlFor="currentPassword">Current Password</Label>
 <Input
 id="currentPassword"
 type="password"
 value={passwordForm.currentPassword}
 onChange={(e) => setPasswordForm({...passwordForm, currentPassword: e.target.value})}
 placeholder="Enter current password"
 />
 </div>
 <div className="space-y-2">
 <Label htmlFor="newPassword">New Password</Label>
 <Input
 id="newPassword"
 type="password"
 value={passwordForm.newPassword}
 onChange={(e) => setPasswordForm({...passwordForm, newPassword: e.target.value})}
 placeholder="Enter new password"
 />
 </div>
 <div className="space-y-2">
 <Label htmlFor="confirmPassword">Confirm New Password</Label>
 <Input
 id="confirmPassword"
 type="password"
 value={passwordForm.confirmPassword}
 onChange={(e) => setPasswordForm({...passwordForm, confirmPassword: e.target.value})}
 placeholder="Confirm new password"
 />
 </div>
 </div>

 <div className="flex justify-end">
 <Button onClick={handleChangePassword} disabled={isSaving}>
 {isSaving ? (
 <>
 <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
 Changing...
 </>
 ) : (
 <>
 <Lock className="h-4 w-4 mr-2" />
 Change Password
 </>
 )}
 </Button>
 </div>
 </CardContent>
 </Card>

 <Card>
 <CardHeader>
 <CardTitle>Active Sessions</CardTitle>
 <CardDescription>Manage your active login sessions</CardDescription>
 </CardHeader>
 <CardContent>
 <div className="space-y-4">
 <div className="flex items-center justify-between p-4 border rounded-lg">
 <div>
 <p className="font-medium">Current Session</p>
 <p className="text-sm text-muted-foreground">
 <Clock className="h-3 w-3 inline mr-1" />
 Last active: Just now
 </p>
 </div>
 <Badge variant="secondary">Active</Badge>
 </div>
 </div>
 </CardContent>
 </Card>

 <Card>
 <CardHeader>
 <CardTitle>API Keys</CardTitle>
 <CardDescription>Manage your personal API keys for integrations</CardDescription>
 </CardHeader>
 <CardContent>
 <Alert>
 <Key className="h-4 w-4" />
 <AlertDescription>
 No API keys generated yet. Contact your administrator if you need API access.
 </AlertDescription>
 </Alert>
 </CardContent>
 </Card>
 </TabsContent>
 </Tabs>
 </PageContainer>
 );
};